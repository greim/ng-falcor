(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ngFalcor=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=extract;function extract(obj,path){var idx=arguments.length<=2||arguments[2]===undefined?0:arguments[2];var root=arguments.length<=3||arguments[3]===undefined?obj:arguments[3];var isRef=obj&&obj.$type==="ref";if(isRef){var newPath=obj.value.concat(path.slice(idx));return extract(root,newPath)}else if(path.length-idx===0){return obj&&obj.$type?obj.value:obj}else if(obj===null||obj===undefined){return obj}else{var step=path[idx];return extract(obj[step],path,idx+1,root)}}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.create=undefined;var _falcor=require("falcor");var _falcorHttpDatasource=require("falcor-http-datasource");var _falcorHttpDatasource2=_interopRequireDefault(_falcorHttpDatasource);var _extract=require("./extract");var _extract2=_interopRequireDefault(_extract);var _falcorPathSyntax=require("falcor-path-syntax");var _falcorPathSyntax2=_interopRequireDefault(_falcorPathSyntax);var _thenify=require("./thenify");var _thenify2=_interopRequireDefault(_thenify);var _memoize=require("./memoize");var _memoize2=_interopRequireDefault(_memoize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var parse=(0,_memoize2.default)(_falcorPathSyntax2.default.fromPath);function create(_ref){var router=_ref.router;var timeout=_ref.timeout;var headers=_ref.headers;var cache=_ref.cache;function factory($rootScope){var onChange=function onChange(){$rootScope.$evalAsync()};var source=router&&new _falcorHttpDatasource2.default(router,{timeout:timeout,headers:headers});var model=new _falcor.Model({source:source,onChange:onChange,cache:cache}).batch();var graph=model._root.cache;var ngf=function ngf(path){if(arguments.length>1){path=Array.from(arguments)}else if(typeof path==="string"){path=parse(path)}var result=(0,_extract2.default)(graph,path);if(result===undefined){ngf.getValue(path)}return result};ngf.get=(0,_thenify2.default)(model.get.bind(model));ngf.getValue=(0,_thenify2.default)(model.getValue.bind(model));ngf.set=(0,_thenify2.default)(model.set.bind(model));ngf.call=(0,_thenify2.default)(model.call.bind(model));ngf.twoWay=function(path){path=parse(path);return function(newValue){var isSet=arguments.length>0;if(isSet){ngf.setValue(path,newValue)}else{return(0,_extract2.default)(graph,path)}}};return ngf}factory.$inject=["$rootScope"];return factory}exports.create=create},{"./extract":1,"./memoize":3,"./thenify":4,falcor:63,"falcor-http-datasource":7,"falcor-path-syntax":16}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(fn){var cache=new Map;return function(arg){if(cache.has(arg)){return cache.get(arg)}else{var value=fn.call(this,arg);cache.set(arg,value);return value}}}},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(fn){return function(){var prom=fn.apply(null,arguments);prom.then(noop);return prom}};function noop(){}},{}],5:[function(require,module,exports){"use strict";var rawAsap=require("./raw");var freeTasks=[];var pendingErrors=[];var requestErrorThrow=rawAsap.makeRequestCallFromTimer(throwFirstError);function throwFirstError(){if(pendingErrors.length){throw pendingErrors.shift()}}module.exports=asap;function asap(task){var rawTask;if(freeTasks.length){rawTask=freeTasks.pop()}else{rawTask=new RawTask}rawTask.task=task;rawAsap(rawTask)}function RawTask(){this.task=null}RawTask.prototype.call=function(){try{this.task.call()}catch(error){if(asap.onerror){asap.onerror(error)}else{pendingErrors.push(error);requestErrorThrow()}}finally{this.task=null;freeTasks[freeTasks.length]=this}}},{"./raw":6}],6:[function(require,module,exports){(function(global){"use strict";module.exports=rawAsap;function rawAsap(task){if(!queue.length){requestFlush();flushing=true}queue[queue.length]=task}var queue=[];var flushing=false;var requestFlush;var index=0;var capacity=1024;function flush(){while(index<queue.length){var currentIndex=index;index=index+1;queue[currentIndex].call();if(index>capacity){for(var scan=0,newLength=queue.length-index;scan<newLength;scan++){queue[scan]=queue[scan+index]}queue.length-=index;index=0}}queue.length=0;index=0;flushing=false}var BrowserMutationObserver=global.MutationObserver||global.WebKitMutationObserver;if(typeof BrowserMutationObserver==="function"){requestFlush=makeRequestCallFromMutationObserver(flush)}else{requestFlush=makeRequestCallFromTimer(flush)}rawAsap.requestFlush=requestFlush;function makeRequestCallFromMutationObserver(callback){var toggle=1;var observer=new BrowserMutationObserver(callback);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function requestCall(){toggle=-toggle;node.data=toggle}}function makeRequestCallFromTimer(callback){return function requestCall(){var timeoutHandle=setTimeout(handleTimer,0);var intervalHandle=setInterval(handleTimer,50);function handleTimer(){clearTimeout(timeoutHandle);clearInterval(intervalHandle);callback()}}}rawAsap.makeRequestCallFromTimer=makeRequestCallFromTimer}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],7:[function(require,module,exports){"use strict";var request=require("./request");var buildQueryObject=require("./buildQueryObject");var isArray=Array.isArray;function simpleExtend(obj,obj2){var prop;for(prop in obj2){obj[prop]=obj2[prop]}return obj}function XMLHttpSource(jsongUrl,config){this._jsongUrl=jsongUrl;if(typeof config==="number"){var newConfig={timeout:config};config=newConfig}this._config=simpleExtend({timeout:15e3,headers:{}},config||{})}XMLHttpSource.prototype={constructor:XMLHttpSource,buildQueryObject:buildQueryObject,get:function httpSourceGet(pathSet){var method="GET";var queryObject=this.buildQueryObject(this._jsongUrl,method,{paths:pathSet,method:"get"});var config=simpleExtend(queryObject,this._config);var context=this;return request(method,config,context)},set:function httpSourceSet(jsongEnv){var method="POST";var queryObject=this.buildQueryObject(this._jsongUrl,method,{jsonGraph:jsongEnv,method:"set"});var config=simpleExtend(queryObject,this._config);config.headers["Content-Type"]="application/x-www-form-urlencoded";var context=this;return request(method,config,context)},call:function httpSourceCall(callPath,args,pathSuffix,paths){args=args||[];pathSuffix=pathSuffix||[];paths=paths||[];var method="POST";var queryData=[];queryData.push("method=call");queryData.push("callPath="+encodeURIComponent(JSON.stringify(callPath)));queryData.push("arguments="+encodeURIComponent(JSON.stringify(args)));queryData.push("pathSuffixes="+encodeURIComponent(JSON.stringify(pathSuffix)));queryData.push("paths="+encodeURIComponent(JSON.stringify(paths)));var queryObject=this.buildQueryObject(this._jsongUrl,method,queryData.join("&"));var config=simpleExtend(queryObject,this._config);config.headers["Content-Type"]="application/x-www-form-urlencoded";var context=this;return request(method,config,context)}};XMLHttpSource.XMLHttpSource=XMLHttpSource;XMLHttpSource["default"]=XMLHttpSource;module.exports=XMLHttpSource},{"./buildQueryObject":8,"./request":11}],8:[function(require,module,exports){"use strict";module.exports=function buildQueryObject(url,method,queryData){var qData=[];var keys;var data={url:url};var isQueryParamUrl=url.indexOf("?")!==-1;var startUrl=isQueryParamUrl?"&":"?";if(typeof queryData==="string"){qData.push(queryData)}else{keys=Object.keys(queryData);keys.forEach(function(k){var value=typeof queryData[k]==="object"?JSON.stringify(queryData[k]):queryData[k];qData.push(k+"="+value)})}if(method==="GET"){data.url+=startUrl+qData.join("&")}else{data.data=qData.join("&")}return data}},{}],9:[function(require,module,exports){(function(global){"use strict";module.exports=function getCORSRequest(){var xhr=new global.XMLHttpRequest;if("withCredentials"in xhr){return xhr}else if(!!global.XDomainRequest){return new XDomainRequest}else{throw new Error("CORS is not supported by your browser")}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(require,module,exports){(function(global){"use strict";module.exports=function getXMLHttpRequest(){var progId,progIds,i;if(global.XMLHttpRequest){return new global.XMLHttpRequest}else{try{progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(i=0;i<3;i++){try{progId=progIds[i];if(new global.ActiveXObject(progId)){break}}catch(e){}}return new global.ActiveXObject(progId)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],11:[function(require,module,exports){"use strict";var getXMLHttpRequest=require("./getXMLHttpRequest");var getCORSRequest=require("./getCORSRequest");var hasOwnProp=Object.prototype.hasOwnProperty;var noop=function(){};function Observable(){}Observable.create=function(subscribe){var o=new Observable;o.subscribe=function(onNext,onError,onCompleted){var observer;var disposable;if(typeof onNext==="function"){observer={onNext:onNext,onError:onError||noop,onCompleted:onCompleted||noop}}else{observer=onNext}disposable=subscribe(observer);if(typeof disposable==="function"){return{dispose:disposable}}else{return disposable}};return o};function request(method,options,context){return Observable.create(function requestObserver(observer){var config={method:method||"GET",crossDomain:false,async:true,headers:{},responseType:"json"};var xhr,isDone,headers,header,prop;for(prop in options){if(hasOwnProp.call(options,prop)){config[prop]=options[prop]}}if(!config.crossDomain&&!config.headers["X-Requested-With"]){config.headers["X-Requested-With"]="XMLHttpRequest"}if(context.onBeforeRequest!=null){context.onBeforeRequest(config)}try{xhr=config.crossDomain?getCORSRequest():getXMLHttpRequest()}catch(err){observer.onError(err)}try{if(config.user){xhr.open(config.method,config.url,config.async,config.user,config.password)}else{xhr.open(config.method,config.url,config.async)}xhr.timeout=config.timeout;xhr.withCredentials=config.withCredentials!==false;headers=config.headers;for(header in headers){if(hasOwnProp.call(headers,header)){xhr.setRequestHeader(header,headers[header])}}if(config.responseType){try{xhr.responseType=config.responseType}catch(e){if(config.responseType!=="json"){throw e}}}xhr.onreadystatechange=function onreadystatechange(e){if(xhr.readyState===4){if(!isDone){isDone=true;onXhrLoad(observer,xhr,e)}}};xhr.ontimeout=function ontimeout(e){if(!isDone){isDone=true;onXhrError(observer,xhr,"timeout error",e)}};xhr.send(config.data)}catch(e){observer.onError(e)}return function dispose(){if(!isDone&&xhr.readyState!==4){isDone=true;xhr.abort()}}})}function _handleXhrError(observer,textStatus,errorThrown){if(!errorThrown){errorThrown=new Error(textStatus)}observer.onError(errorThrown)}function onXhrLoad(observer,xhr,e){var responseData,responseObject,responseType;if(xhr&&observer){responseType=xhr.responseType;responseData="response"in xhr?xhr.response:xhr.responseText;var status=xhr.status===1223?204:xhr.status;if(status>=200&&status<=399){try{if(responseType!=="json"){responseData=JSON.parse(responseData||"")}if(typeof responseData==="string"){responseData=JSON.parse(responseData||"")}}catch(e){_handleXhrError(observer,"invalid json",e)}observer.onNext(responseData);observer.onCompleted();return}else if(status===401||status===403||status===407){return _handleXhrError(observer,responseData)}else if(status===410){return _handleXhrError(observer,responseData)}else if(status===408||status===504){return _handleXhrError(observer,responseData)}else{return _handleXhrError(observer,responseData||"Response code "+status)}}}function onXhrError(observer,xhr,status,e){_handleXhrError(observer,status||xhr.statusText||"request error",e)}module.exports=request},{"./getCORSRequest":9,"./getXMLHttpRequest":10}],12:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");function sentinel(type,value,props){var copy=Object.create(null);if(props!=null){for(var key in props){copy[key]=props[key]}copy["$type"]=type;copy.value=value;return copy}else{return{$type:type,value:value}}}module.exports={ref:function ref(path,props){return sentinel("ref",pathSyntax.fromPath(path),props)},atom:function atom(value,props){return sentinel("atom",value,props)},undefined:function(){return sentinel("atom")},error:function error(errorValue,props){return sentinel("error",errorValue,props)},pathValue:function pathValue(path,value){return{path:pathSyntax.fromPath(path),value:value}},pathInvalidation:function pathInvalidation(path){return{path:pathSyntax.fromPath(path),invalidated:true}}}},{"falcor-path-syntax":16}],13:[function(require,module,exports){module.exports={integers:"integers",ranges:"ranges",keys:"keys"}},{}],14:[function(require,module,exports){var TokenTypes={token:"token",dotSeparator:".",commaSeparator:",",openingBracket:"[",closingBracket:"]",openingBrace:"{",closingBrace:"}",escape:"\\",space:" ",colon:":",quote:"quote",unknown:"unknown"};module.exports=TokenTypes},{}],15:[function(require,module,exports){module.exports={indexer:{nested:"Indexers cannot be nested.",needQuotes:"unquoted indexers must be numeric.",empty:"cannot have empty indexers.",leadingDot:"Indexers cannot have leading dots.",leadingComma:"Indexers cannot have leading comma.",requiresComma:"Indexers require commas between indexer args.",routedTokens:"Only one token can be used per indexer when specifying routed tokens."},range:{precedingNaN:"ranges must be preceded by numbers.",suceedingNaN:"ranges must be suceeded by numbers."},routed:{invalid:"Invalid routed token.  only integers|ranges|keys are supported."},quote:{empty:"cannot have empty quoted keys.",illegalEscape:"Invalid escape character.  Only quotes are escapable."},unexpectedToken:"Unexpected token.",invalidIdentifier:"Invalid Identifier.",invalidPath:"Please provide a valid path.",throwError:function(err,tokenizer,token){if(token){throw err+" -- "+tokenizer.parseString+" with next token: "+token}throw err+" -- "+tokenizer.parseString}}},{}],16:[function(require,module,exports){var Tokenizer=require("./tokenizer");var head=require("./parse-tree/head");var RoutedTokens=require("./RoutedTokens");var parser=function parser(string,extendedRules){return head(new Tokenizer(string,extendedRules))};module.exports=parser;parser.fromPathsOrPathValues=function(paths,ext){if(!paths){return[]}var out=[];for(var i=0,len=paths.length;i<len;i++){if(typeof paths[i]==="string"){out[i]=parser(paths[i],ext)}else if(typeof paths[i].path==="string"){out[i]={path:parser(paths[i].path,ext),value:paths[i].value}}else{out[i]=paths[i]}}return out};parser.fromPath=function(path,ext){if(!path){return[]}if(typeof path==="string"){return parser(path,ext)}return path};parser.RoutedTokens=RoutedTokens},{"./RoutedTokens":13,"./parse-tree/head":17,"./tokenizer":22}],17:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var indexer=require("./indexer");module.exports=function head(tokenizer){var token=tokenizer.next();var state={};var out=[];while(!token.done){switch(token.type){case TokenTypes.token:var first=+token.token[0];if(!isNaN(first)){E.throwError(E.invalidIdentifier,tokenizer)}out[out.length]=token.token;break;case TokenTypes.dotSeparator:if(out.length===0){E.throwError(E.unexpectedToken,tokenizer)}break;case TokenTypes.space:break;case TokenTypes.openingBracket:indexer(tokenizer,token,state,out);break;default:E.throwError(E.unexpectedToken,tokenizer);break}token=tokenizer.next()}if(out.length===0){E.throwError(E.invalidPath,tokenizer)}return out}},{"./../TokenTypes":14,"./../exceptions":15,"./indexer":18}],18:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var idxE=E.indexer;var range=require("./range");var quote=require("./quote");var routed=require("./routed");module.exports=function indexer(tokenizer,openingToken,state,out){var token=tokenizer.next();var done=false;var allowedMaxLength=1;var routedIndexer=false;state.indexer=[];while(!token.done){switch(token.type){case TokenTypes.token:case TokenTypes.quote:if(state.indexer.length===allowedMaxLength){E.throwError(idxE.requiresComma,tokenizer)}break}switch(token.type){case TokenTypes.openingBrace:routedIndexer=true;routed(tokenizer,token,state,out);break;case TokenTypes.token:var t=+token.token;if(isNaN(t)){E.throwError(idxE.needQuotes,tokenizer)}state.indexer[state.indexer.length]=t;break;case TokenTypes.dotSeparator:if(!state.indexer.length){E.throwError(idxE.leadingDot,tokenizer)}range(tokenizer,token,state,out);break;case TokenTypes.space:break;case TokenTypes.closingBracket:done=true;break;case TokenTypes.quote:quote(tokenizer,token,state,out);break;case TokenTypes.openingBracket:E.throwError(idxE.nested,tokenizer);break;case TokenTypes.commaSeparator:++allowedMaxLength;break;default:E.throwError(E.unexpectedToken,tokenizer);break}if(done){break}token=tokenizer.next()}if(state.indexer.length===0){E.throwError(idxE.empty,tokenizer)}if(state.indexer.length>1&&routedIndexer){E.throwError(idxE.routedTokens,tokenizer)}if(state.indexer.length===1){state.indexer=state.indexer[0]}out[out.length]=state.indexer;state.indexer=undefined}},{"./../TokenTypes":14,"./../exceptions":15,"./quote":19,"./range":20,"./routed":21}],19:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");var quoteE=E.quote;module.exports=function quote(tokenizer,openingToken,state,out){var token=tokenizer.next();var innerToken="";var openingQuote=openingToken.token;var escaping=false;var done=false;while(!token.done){switch(token.type){case TokenTypes.token:case TokenTypes.space:case TokenTypes.dotSeparator:case TokenTypes.commaSeparator:case TokenTypes.openingBracket:case TokenTypes.closingBracket:case TokenTypes.openingBrace:case TokenTypes.closingBrace:if(escaping){E.throwError(quoteE.illegalEscape,tokenizer)}innerToken+=token.token;break;case TokenTypes.quote:if(escaping){innerToken+=token.token;escaping=false}else if(token.token!==openingQuote){innerToken+=token.token}else{done=true}break;case TokenTypes.escape:escaping=true;break;default:E.throwError(E.unexpectedToken,tokenizer)}if(done){break}token=tokenizer.next()}if(innerToken.length===0){E.throwError(quoteE.empty,tokenizer)}state.indexer[state.indexer.length]=innerToken}},{"./../TokenTypes":14,"./../exceptions":15}],20:[function(require,module,exports){var Tokenizer=require("./../tokenizer");var TokenTypes=require("./../TokenTypes");var E=require("./../exceptions");module.exports=function range(tokenizer,openingToken,state,out){var token=tokenizer.peek();var dotCount=1;var done=false;var inclusive=true;var idx=state.indexer.length-1;var from=Tokenizer.toNumber(state.indexer[idx]);var to;if(isNaN(from)){E.throwError(E.range.precedingNaN,tokenizer)}while(!done&&!token.done){switch(token.type){case TokenTypes.dotSeparator:if(dotCount===3){E.throwError(E.unexpectedToken,tokenizer)}++dotCount;if(dotCount===3){inclusive=false}break;case TokenTypes.token:to=Tokenizer.toNumber(tokenizer.next().token);if(isNaN(to)){E.throwError(E.range.suceedingNaN,tokenizer)}done=true;break;default:done=true;break}if(!done){tokenizer.next();token=tokenizer.peek()}else{break}}state.indexer[idx]={from:from,to:inclusive?to:to-1}}},{"./../TokenTypes":14,"./../exceptions":15,"./../tokenizer":22}],21:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var RoutedTokens=require("./../RoutedTokens");var E=require("./../exceptions");var routedE=E.routed;module.exports=function routed(tokenizer,openingToken,state,out){var routeToken=tokenizer.next();var named=false;var name="";switch(routeToken.token){case RoutedTokens.integers:case RoutedTokens.ranges:case RoutedTokens.keys:break;default:E.throwError(routedE.invalid,tokenizer);break}var next=tokenizer.next();if(next.type===TokenTypes.colon){named=true;next=tokenizer.next();if(next.type!==TokenTypes.token){E.throwError(routedE.invalid,tokenizer)}name=next.token;next=tokenizer.next()}if(next.type===TokenTypes.closingBrace){var outputToken={type:routeToken.token,named:named,name:name};state.indexer[state.indexer.length]=outputToken}else{E.throwError(routedE.invalid,tokenizer)}}},{"./../RoutedTokens":13,"./../TokenTypes":14,"./../exceptions":15}],22:[function(require,module,exports){var TokenTypes=require("./../TokenTypes");var DOT_SEPARATOR=".";var COMMA_SEPARATOR=",";var OPENING_BRACKET="[";var CLOSING_BRACKET="]";var OPENING_BRACE="{";var CLOSING_BRACE="}";var COLON=":";var ESCAPE="\\";var DOUBLE_OUOTES='"';var SINGE_OUOTES="'";var SPACE=" ";var SPECIAL_CHARACTERS="\\'\"[]., ";var EXT_SPECIAL_CHARACTERS="\\{}'\"[]., :";var Tokenizer=module.exports=function(string,ext){this._string=string;this._idx=-1;this._extended=ext;this.parseString=""};Tokenizer.prototype={next:function(){var nextToken=this._nextToken?this._nextToken:getNext(this._string,this._idx,this._extended);this._idx=nextToken.idx;this._nextToken=false;this.parseString+=nextToken.token.token;return nextToken.token},peek:function(){var nextToken=this._nextToken?this._nextToken:getNext(this._string,this._idx,this._extended);this._nextToken=nextToken;return nextToken.token}};Tokenizer.toNumber=function toNumber(x){if(!isNaN(+x)){return+x}return NaN};function toOutput(token,type,done){return{token:token,done:done,type:type}}function getNext(string,idx,ext){var output=false;var token="";var specialChars=ext?EXT_SPECIAL_CHARACTERS:SPECIAL_CHARACTERS;var done;do{done=idx+1>=string.length;if(done){break}var character=string[idx+1];if(character!==undefined&&specialChars.indexOf(character)===-1){token+=character;++idx;continue}else if(token.length){break}++idx;var type;switch(character){case DOT_SEPARATOR:type=TokenTypes.dotSeparator;break;case COMMA_SEPARATOR:type=TokenTypes.commaSeparator;break;case OPENING_BRACKET:type=TokenTypes.openingBracket;break;case CLOSING_BRACKET:type=TokenTypes.closingBracket;break;case OPENING_BRACE:type=TokenTypes.openingBrace;break;case CLOSING_BRACE:type=TokenTypes.closingBrace;break;case SPACE:type=TokenTypes.space;break;case DOUBLE_OUOTES:case SINGE_OUOTES:type=TokenTypes.quote;break;case ESCAPE:type=TokenTypes.escape;break;case COLON:type=TokenTypes.colon;break;default:type=TokenTypes.unknown;break}output=toOutput(character,type,false);break}while(!done);if(!output&&token.length){output=toOutput(token,TokenTypes.token,false)}if(!output){output={done:true}}return{token:output,idx:idx}}},{"./../TokenTypes":14}],23:[function(require,module,exports){var toPaths=require("./toPaths");var toTree=require("./toTree");module.exports=function collapse(paths){var collapseMap=paths.reduce(function(acc,path){var len=path.length;if(!acc[len]){acc[len]=[]}acc[len].push(path);return acc},{});Object.keys(collapseMap).forEach(function(collapseKey){collapseMap[collapseKey]=toTree(collapseMap[collapseKey])});return toPaths(collapseMap)}},{"./toPaths":29,"./toTree":30}],24:[function(require,module,exports){var iterateKeySet=require("./iterateKeySet");module.exports=function hasIntersection(tree,path,depth){var current=tree;var intersects=true;for(;intersects&&depth<path.length;++depth){var key=path[depth];var keyType=typeof key;if(key&&keyType==="object"){var note={};var innerKey=iterateKeySet(key,note);var nextDepth=depth+1;do{var next=current[innerKey];intersects=next!==undefined;if(intersects){intersects=hasIntersection(next,path,nextDepth)}innerKey=iterateKeySet(key,note)}while(intersects&&!note.done);break}current=current[key];intersects=current!==undefined}return intersects}},{"./iterateKeySet":26}],25:[function(require,module,exports){module.exports={iterateKeySet:require("./iterateKeySet"),toTree:require("./toTree"),toTreeWithUnion:require("./toTreeWithUnion"),pathsComplementFromTree:require("./pathsComplementFromTree"),pathsComplementFromLengthTree:require("./pathsComplementFromLengthTree"),hasIntersection:require("./hasIntersection"),toPaths:require("./toPaths"),collapse:require("./collapse")}},{"./collapse":23,"./hasIntersection":24,"./iterateKeySet":26,"./pathsComplementFromLengthTree":27,"./pathsComplementFromTree":28,"./toPaths":29,"./toTree":30,"./toTreeWithUnion":31}],26:[function(require,module,exports){var isArray=Array.isArray;module.exports=function iterateKeySet(keySet,note){if(note.isArray===undefined){initializeNote(keySet,note)}if(note.isArray){var nextValue;do{if(note.loaded&&note.rangeOffset>note.to){++note.arrayOffset;note.loaded=false}var idx=note.arrayOffset,length=keySet.length;if(idx>=length){note.done=true;break}var el=keySet[note.arrayOffset];var type=typeof el;if(type==="object"){if(!note.loaded){initializeRange(el,note)}if(note.empty){continue}nextValue=note.rangeOffset++}else{++note.arrayOffset;nextValue=el}}while(nextValue===undefined);return nextValue}else if(note.isObject){if(!note.loaded){initializeRange(keySet,note)}if(note.rangeOffset>note.to){note.done=true;return undefined}return note.rangeOffset++}else{note.done=true;return keySet}};function initializeRange(key,memo){var from=memo.from=key.from||0;var to=memo.to=key.to||(typeof key.length==="number"&&memo.from+key.length-1||0);memo.rangeOffset=memo.from;memo.loaded=true;if(from>to){memo.empty=true}}function initializeNote(key,note){note.done=false;var isObject=note.isObject=!!(key&&typeof key==="object");note.isArray=isObject&&isArray(key);note.arrayOffset=0}},{}],27:[function(require,module,exports){var hasIntersection=require("./hasIntersection");module.exports=function pathsComplementFromLengthTree(paths,tree){var out=[];var outLength=-1;for(var i=0,len=paths.length;i<len;++i){var path=paths[i];if(!hasIntersection(tree[path.length],path,0)){out[++outLength]=path}}return out}},{"./hasIntersection":24}],28:[function(require,module,exports){var hasIntersection=require("./hasIntersection");module.exports=function pathsComplementFromTree(paths,tree){var out=[];var outLength=-1;for(var i=0,len=paths.length;i<len;++i){if(!hasIntersection(tree,paths[i],0)){out[++outLength]=paths[i]}}return out}},{"./hasIntersection":24}],29:[function(require,module,exports){var isArray=Array.isArray;var typeOfObject="object";module.exports=function toPaths(lengths){var pathmap;var allPaths=[];var allPathsLength=0;for(var length in lengths){if(isNumber(length)&&isObject(pathmap=lengths[length])){var paths=collapsePathMap(pathmap,0,parseInt(length,10)).sets;var pathsIndex=-1;var pathsCount=paths.length;while(++pathsIndex<pathsCount){allPaths[allPathsLength++]=collapsePathSetIndexes(paths[pathsIndex])}}}return allPaths};function isObject(value){return value!==null&&typeof value===typeOfObject}function collapsePathMap(pathmap,depth,length){var key;var code=getHashCode(String(depth));var subs=Object.create(null);var codes=[];var codesIndex=-1;var codesCount=0;var pathsets=[];var pathsetsCount=0;var subPath,subCode,subKeys,subKeysIndex,subKeysCount,subSets,subSetsIndex,subSetsCount,pathset,pathsetIndex,pathsetCount,firstSubKey,pathsetClone;subKeys=[];subKeysIndex=-1;if(depth<length-1){subKeysCount=getSortedKeys(pathmap,subKeys);while(++subKeysIndex<subKeysCount){key=subKeys[subKeysIndex];subPath=collapsePathMap(pathmap[key],depth+1,length);subCode=subPath.code;if(subs[subCode]){subPath=subs[subCode]}else{codes[codesCount++]=subCode;subPath=subs[subCode]={keys:[],sets:subPath.sets}}code=getHashCode(code+key+subCode);isNumber(key)&&subPath.keys.push(parseInt(key,10))||subPath.keys.push(key)}while(++codesIndex<codesCount){key=codes[codesIndex];subPath=subs[key];subKeys=subPath.keys;subKeysCount=subKeys.length;if(subKeysCount>0){subSets=subPath.sets;subSetsIndex=-1;subSetsCount=subSets.length;firstSubKey=subKeys[0];while(++subSetsIndex<subSetsCount){pathset=subSets[subSetsIndex];pathsetIndex=-1;pathsetCount=pathset.length;pathsetClone=new Array(pathsetCount+1);pathsetClone[0]=subKeysCount>1&&subKeys||firstSubKey;while(++pathsetIndex<pathsetCount){pathsetClone[pathsetIndex+1]=pathset[pathsetIndex]}pathsets[pathsetsCount++]=pathsetClone}}}}else{subKeysCount=getSortedKeys(pathmap,subKeys);if(subKeysCount>1){pathsets[pathsetsCount++]=[subKeys]}else{pathsets[pathsetsCount++]=subKeys}while(++subKeysIndex<subKeysCount){code=getHashCode(code+subKeys[subKeysIndex])}}return{code:code,sets:pathsets}}function collapsePathSetIndexes(pathset){var keysetIndex=-1;var keysetCount=pathset.length;while(++keysetIndex<keysetCount){var keyset=pathset[keysetIndex];if(isArray(keyset)){pathset[keysetIndex]=collapseIndex(keyset)}}return pathset}function collapseIndex(keyset){var keyIndex=-1;var keyCount=keyset.length-1;var isSparseRange=keyCount>0;while(++keyIndex<=keyCount){var key=keyset[keyIndex];if(!isNumber(key)){isSparseRange=false;break}keyset[keyIndex]=parseInt(key,10)}if(isSparseRange===true){keyset.sort(sortListAscending);var from=keyset[0];var to=keyset[keyCount];if(to-from<=keyCount){return{from:from,to:to}}}return keyset}function sortListAscending(a,b){return a-b}function getSortedKeys(map,keys,sort){var len=0;for(var key in map){keys[len++]=key}if(len>1){keys.sort(sort)}return len}function getHashCode(key){var code=5381;var index=-1;var count=key.length;while(++index<count){code=(code<<5)+code+key.charCodeAt(index)}return String(code)}function isNumber(val){return!isArray(val)&&val-parseFloat(val)+1>=0}},{}],30:[function(require,module,exports){var iterateKeySet=require("./../lib/iterateKeySet");var isArray=Array.isArray;module.exports=function toTree(paths){return paths.reduce(function(acc,path){innerToTree(acc,path,0);return acc},{})};function innerToTree(seed,path,depth){var keySet=path[depth];var iteratorNote={};var key;var nextDepth=depth+1;key=iterateKeySet(keySet,iteratorNote);do{var next=seed[key];if(!next){if(nextDepth===path.length){seed[key]=null}else{next=seed[key]={}}}if(nextDepth<path.length){innerToTree(next,path,nextDepth)}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done)}},{"./../lib/iterateKeySet":26}],31:[function(require,module,exports){},{}],32:[function(require,module,exports){var ModelRoot=require("./ModelRoot");var ModelDataSourceAdapter=require("./ModelDataSourceAdapter");var RequestQueue=require("./request/RequestQueueRx");var ModelResponse=require("./response/ModelResponse");var SetResponse=require("./response/SetResponse");var CallResponse=require("./response/CallResponse");var InvalidateResponse=require("./response/InvalidateResponse");var ASAPScheduler=require("./schedulers/ASAPScheduler");var TimeoutScheduler=require("./schedulers/TimeoutScheduler");var ImmediateScheduler=require("./schedulers/ImmediateScheduler");var arrayClone=require("./support/array-clone");var arraySlice=require("./support/array-slice");var collectLru=require("./lru/collect");var pathSyntax=require("falcor-path-syntax");var getSize=require("./support/getSize");var isObject=require("./support/isObject");
var isFunction=require("./support/isFunction");var isPrimitive=require("./support/isPrimitive");var isJSONEnvelope=require("./support/isJSONEnvelope");var isJSONGraphEnvelope=require("./support/isJSONGraphEnvelope");var setCache=require("./set/setPathMaps");var setJSONGraphs=require("./set/setJSONGraphs");var jsong=require("falcor-json-graph");var ID=0;var validateInput=require("./support/validateInput");var noOp=function(){};var getCache=require("./get/getCache");var get=require("./get");var SET_VALID_INPUT={pathValue:true,pathSyntax:true,json:true,jsonGraph:true};var GET_VALID_INPUT=require("./response/get/validInput");module.exports=Model;Model.ref=jsong.ref;Model.atom=jsong.atom;Model.error=jsong.error;Model.pathValue=jsong.pathValue;function Model(o){var options=o||{};this._root=options._root||new ModelRoot(options);this._path=options.path||options._path||[];this._scheduler=options.scheduler||options._scheduler||new ImmediateScheduler;this._source=options.source||options._source;this._request=options.request||options._request||new RequestQueue(this,this._scheduler);this._ID=ID++;if(typeof options.maxSize==="number"){this._maxSize=options.maxSize}else{this._maxSize=options._maxSize||Model.prototype._maxSize}if(typeof options.collectRatio==="number"){this._collectRatio=options.collectRatio}else{this._collectRatio=options._collectRatio||Model.prototype._collectRatio}if(options.boxed||options.hasOwnProperty("_boxed")){this._boxed=options.boxed||options._boxed}if(options.materialized||options.hasOwnProperty("_materialized")){this._materialized=options.materialized||options._materialized}if(typeof options.treatErrorsAsValues==="boolean"){this._treatErrorsAsValues=options.treatErrorsAsValues}else if(options.hasOwnProperty("_treatErrorsAsValues")){this._treatErrorsAsValues=options._treatErrorsAsValues}if(options.cache){this.setCache(options.cache)}}Model.prototype.constructor=Model;Model.prototype._materialized=false;Model.prototype._boxed=false;Model.prototype._progressive=false;Model.prototype._treatErrorsAsValues=false;Model.prototype._maxSize=Math.pow(2,53)-1;Model.prototype._collectRatio=.75;Model.prototype.get=require("./response/get");Model.prototype._getWithPaths=require("./response/get/getWithPaths");Model.prototype.set=function set(){var out=validateInput(arguments,SET_VALID_INPUT,"set");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}return this._set.apply(this,arguments)};Model.prototype.preload=function preload(){var out=validateInput(arguments,GET_VALID_INPUT,"preload");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var args=Array.prototype.slice.call(arguments);var self=this;return new ModelResponse(function(obs){return self.get.apply(self,args).subscribe(function(){},function(err){obs.onError(err)},function(){obs.onCompleted()})})};Model.prototype._set=function _set(){var args;var argsIdx=-1;var argsLen=arguments.length;var selector=arguments[argsLen-1];if(isFunction(selector)){argsLen=argsLen-1}else{selector=void 0}args=new Array(argsLen);while(++argsIdx<argsLen){args[argsIdx]=arguments[argsIdx]}return SetResponse.create(this,args,selector)};Model.prototype.call=function call(){var args;var argsIdx=-1;var argsLen=arguments.length;args=new Array(argsLen);while(++argsIdx<argsLen){var arg=arguments[argsIdx];args[argsIdx]=arg;var argType=typeof arg;if(argsIdx>1&&!Array.isArray(arg)||argsIdx===0&&!Array.isArray(arg)&&argType!=="string"||argsIdx===1&&!Array.isArray(arg)&&!isPrimitive(arg)){return new ModelResponse(function(o){o.onError(new Error("Invalid argument"))})}}return CallResponse.create(this,args)};Model.prototype.invalidate=function invalidate(){var args;var argsIdx=-1;var argsLen=arguments.length;var selector=arguments[argsLen-1];args=new Array(argsLen);while(++argsIdx<argsLen){args[argsIdx]=pathSyntax.fromPath(arguments[argsIdx]);if(typeof args[argsIdx]!=="object"){throw new Error("Invalid argument")}}InvalidateResponse.create(this,args,selector).subscribe(noOp,function(e){throw e})};Model.prototype.deref=require("./deref");Model.prototype.getValue=require("./get/getValue");Model.prototype.setValue=require("./set/setValue");Model.prototype._getValueSync=require("./get/sync");Model.prototype._setValueSync=require("./set/sync");Model.prototype._derefSync=require("./deref/sync");Model.prototype.setCache=function modelSetCache(cacheOrJSONGraphEnvelope){var cache=this._root.cache;if(cacheOrJSONGraphEnvelope!==cache){var modelRoot=this._root;var boundPath=this._path;this._path=[];this._root.cache={};if(typeof cache!=="undefined"){collectLru(modelRoot,modelRoot.expired,getSize(cache),0)}if(isJSONGraphEnvelope(cacheOrJSONGraphEnvelope)){setJSONGraphs(this,[cacheOrJSONGraphEnvelope])}else if(isJSONEnvelope(cacheOrJSONGraphEnvelope)){setCache(this,[cacheOrJSONGraphEnvelope])}else if(isObject(cacheOrJSONGraphEnvelope)){setCache(this,[{json:cacheOrJSONGraphEnvelope}])}this._path=boundPath}else if(typeof cache==="undefined"){this._root.cache={}}return this};Model.prototype.getCache=function _getCache(){var paths=arraySlice(arguments);if(paths.length===0){return getCache(this._root.cache)}var result=[{}];var path=this._path;get.getWithPathsAsJSONGraph(this,paths,result);this._path=path;return result[0].jsonGraph};Model.prototype.getVersion=function getVersion(pathArg){var path=pathArg&&pathSyntax.fromPath(pathArg)||[];if(Array.isArray(path)===false){throw new Error("Model#getVersion must be called with an Array path.")}if(this._path.length){path=this._path.concat(path)}return this._getVersion(this,path)};Model.prototype._syncCheck=function syncCheck(name){if(Boolean(this._source)&&this._root.syncRefCount<=0&&this._root.unsafeMode===false){throw new Error("Model#"+name+" may only be called within the context of a request selector.")}return true};Model.prototype._clone=function cloneModel(opts){var clone=new Model(this);for(var key in opts){var value=opts[key];if(value==="delete"){delete clone[key]}else{clone[key]=value}}clone.setCache=void 0;return clone};Model.prototype.batch=function batch(schedulerOrDelayArg){var schedulerOrDelay=schedulerOrDelayArg;if(typeof schedulerOrDelay==="number"){schedulerOrDelay=new TimeoutScheduler(Math.round(Math.abs(schedulerOrDelay)))}else if(!schedulerOrDelay||!schedulerOrDelay.schedule){schedulerOrDelay=new ASAPScheduler}var clone=this._clone();clone._request=new RequestQueue(clone,schedulerOrDelay);return clone};Model.prototype.unbatch=function unbatch(){var clone=this._clone();clone._request=new RequestQueue(clone,new ImmediateScheduler);return clone};Model.prototype.treatErrorsAsValues=function treatErrorsAsValues(){return this._clone({_treatErrorsAsValues:true})};Model.prototype.asDataSource=function asDataSource(){return new ModelDataSourceAdapter(this)};Model.prototype._materialize=function materialize(){return this._clone({_materialized:true})};Model.prototype._dematerialize=function dematerialize(){return this._clone({_materialized:"delete"})};Model.prototype.boxValues=function boxValues(){return this._clone({_boxed:true})};Model.prototype.unboxValues=function unboxValues(){return this._clone({_boxed:"delete"})};Model.prototype.withoutDataSource=function withoutDataSource(){return this._clone({_source:"delete"})};Model.prototype.toJSON=function toJSON(){return{$type:"ref",value:this._path}};Model.prototype.getPath=function getPath(){return arrayClone(this._path)};Model.prototype._getBoundValue=require("./get/getBoundValue");Model.prototype._getVersion=require("./get/getVersion");Model.prototype._getValueSync=require("./get/getValueSync");Model.prototype._getPathValuesAsPathMap=get.getWithPathsAsPathMap;Model.prototype._getPathValuesAsJSONG=get.getWithPathsAsJSONGraph;Model.prototype._setPathValuesAsJSON=require("./set/setPathValues");Model.prototype._setPathValuesAsJSONG=require("./set/setPathValues");Model.prototype._setPathValuesAsPathMap=require("./set/setPathValues");Model.prototype._setPathValuesAsValues=require("./set/setPathValues");Model.prototype._setPathMapsAsJSON=require("./set/setPathMaps");Model.prototype._setPathMapsAsJSONG=require("./set/setPathMaps");Model.prototype._setPathMapsAsPathMap=require("./set/setPathMaps");Model.prototype._setPathMapsAsValues=require("./set/setPathMaps");Model.prototype._setJSONGsAsJSON=require("./set/setJSONGraphs");Model.prototype._setJSONGsAsJSONG=require("./set/setJSONGraphs");Model.prototype._setJSONGsAsPathMap=require("./set/setJSONGraphs");Model.prototype._setJSONGsAsValues=require("./set/setJSONGraphs");Model.prototype._setCache=require("./set/setPathMaps");Model.prototype._invalidatePathValuesAsJSON=require("./invalidate/invalidatePathSets");Model.prototype._invalidatePathMapsAsJSON=require("./invalidate/invalidatePathMaps")},{"./ModelDataSourceAdapter":33,"./ModelRoot":34,"./deref":35,"./deref/sync":36,"./get":50,"./get/getBoundValue":44,"./get/getCache":45,"./get/getValue":47,"./get/getValueSync":48,"./get/getVersion":49,"./get/sync":55,"./invalidate/invalidatePathMaps":78,"./invalidate/invalidatePathSets":79,"./lru/collect":80,"./request/RequestQueueRx":86,"./response/CallResponse":92,"./response/InvalidateResponse":94,"./response/ModelResponse":95,"./response/SetResponse":96,"./response/get":102,"./response/get/getWithPaths":101,"./response/get/validInput":103,"./schedulers/ASAPScheduler":104,"./schedulers/ImmediateScheduler":105,"./schedulers/TimeoutScheduler":106,"./set/setJSONGraphs":107,"./set/setPathMaps":108,"./set/setPathValues":109,"./set/setValue":110,"./set/sync":111,"./support/array-clone":112,"./support/array-slice":115,"./support/getSize":119,"./support/isFunction":127,"./support/isJSONEnvelope":128,"./support/isJSONGraphEnvelope":129,"./support/isObject":130,"./support/isPrimitive":132,"./support/validateInput":145,"falcor-json-graph":12,"falcor-path-syntax":16}],33:[function(require,module,exports){function ModelDataSourceAdapter(model){this._model=model._materialize().boxValues().treatErrorsAsValues()}ModelDataSourceAdapter.prototype.get=function get(pathSets){return this._model.get.apply(this._model,pathSets)._toJSONG()};ModelDataSourceAdapter.prototype.set=function set(jsongResponse){return this._model.set(jsongResponse)._toJSONG()};ModelDataSourceAdapter.prototype.call=function call(path,args,suffixes,paths){var params=[path,args,suffixes].concat(paths);return this._model.call.apply(this._model,params)._toJSONG()};module.exports=ModelDataSourceAdapter},{}],34:[function(require,module,exports){var isFunction=require("./support/isFunction");var hasOwn=require("./support/hasOwn");var ImmediateScheduler=require("./schedulers/ImmediateScheduler");function ModelRoot(o){var options=o||{};this.syncRefCount=0;this.expired=options.expired||[];this.unsafeMode=options.unsafeMode||false;this.collectionScheduler=options.collectionScheduler||new ImmediateScheduler;this.cache={};if(isFunction(options.comparator)){this.comparator=options.comparator}if(isFunction(options.errorSelector)){this.errorSelector=options.errorSelector}if(isFunction(options.onChange)){this.onChange=options.onChange}}ModelRoot.prototype.errorSelector=function errorSelector(x,y){return y};ModelRoot.prototype.comparator=function comparator(a,b){if(hasOwn(a,"value")&&hasOwn(b,"value")){return a.value===b.value}return a===b};module.exports=ModelRoot},{"./schedulers/ImmediateScheduler":105,"./support/hasOwn":122,"./support/isFunction":127}],35:[function(require,module,exports){var Rx=require("rx/dist/rx");var pathSyntax=require("falcor-path-syntax");module.exports=function deref(boundPathArg){var model=this;var modelRoot=model._root;var pathsIndex=-1;var pathsCount=arguments.length-1;var paths=new Array(pathsCount);var boundPath=pathSyntax.fromPath(boundPathArg);while(++pathsIndex<pathsCount){paths[pathsIndex]=pathSyntax.fromPath(arguments[pathsIndex+1])}if(modelRoot.syncRefCount<=0&&pathsCount===0){throw new Error("Model#deref requires at least one value path.")}return Rx.Observable.defer(function(){var value;var errorHappened=false;try{++modelRoot.syncRefCount;value=model._derefSync(boundPath)}catch(e){value=e;errorHappened=true}finally{--modelRoot.syncRefCount;return errorHappened?Rx.Observable.throw(value):Rx.Observable.return(value)}}).flatMap(function(boundModel){if(Boolean(boundModel)){if(pathsCount>0){return boundModel.get.apply(boundModel,paths).map(function(){return boundModel}).catch(Rx.Observable.empty())}return Rx.Observable.return(boundModel)}else if(pathsCount>0){return model.get.apply(model,paths.map(function(path){return boundPath.concat(path)})).map(function(){return model.deref(boundPath)}).mergeAll()}return Rx.Observable.empty()})}},{"falcor-path-syntax":16,"rx/dist/rx":161}],36:[function(require,module,exports){var $error=require("./../types/error");var pathSyntax=require("falcor-path-syntax");var getBoundValue=require("./../get/getBoundValue");var getType=require("./../support/getType");module.exports=function derefSync(boundPathArg){var boundPath=pathSyntax.fromPath(boundPathArg);if(!Array.isArray(boundPath)){throw new Error("Model#derefSync must be called with an Array path.")}var boundValue=getBoundValue(this,this._path.concat(boundPath));var path=boundValue.path;var node=boundValue.value;var found=boundValue.found;if(!found){return void 0}var type=getType(node);if(Boolean(node)&&Boolean(type)){if(type===$error){if(this._boxed){throw node}throw node.value}else if(node.value===void 0){return void 0}}return this._clone({_path:path})}},{"./../get/getBoundValue":44,"./../support/getType":121,"./../types/error":148,"falcor-path-syntax":16}],37:[function(require,module,exports){function BoundJSONGraphModelError(){this.message=BoundJSONGraphModelError.message;this.stack=(new Error).stack}BoundJSONGraphModelError.prototype=new Error;BoundJSONGraphModelError.prototype.name="BoundJSONGraphModelError";BoundJSONGraphModelError.message="It is not legal to use the JSON Graph "+"format from a bound Model. JSON Graph format"+" can only be used from a root model.";module.exports=BoundJSONGraphModelError},{}],38:[function(require,module,exports){var NAME="InvalidModelError";var MESSAGE="The boundPath of the model is not valid since a value or error was found before the path end.";function InvalidModelError(boundPath,shortedPath){this.message=MESSAGE;this.stack=(new Error).stack;this.boundPath=boundPath;this.shortedPath=shortedPath}InvalidModelError.prototype=new Error;InvalidModelError.prototype.name=NAME;InvalidModelError.message=MESSAGE;module.exports=InvalidModelError},{}],39:[function(require,module,exports){var NAME="InvalidSourceError";function InvalidSourceError(error){this.message="An exception was thrown when making a request.";this.stack=(new Error).stack;this.innerError=error}InvalidSourceError.prototype=new Error;InvalidSourceError.prototype.name=NAME;InvalidSourceError.is=function(e){return e&&e.name===NAME};module.exports=InvalidSourceError},{}],40:[function(require,module,exports){var NAME="MaxRetryExceededError";function MaxRetryExceededError(){this.message="The allowed number of retries have been exceeded.";this.stack=(new Error).stack}MaxRetryExceededError.prototype=new Error;MaxRetryExceededError.prototype.name=NAME;MaxRetryExceededError.is=function(e){return e&&e.name===NAME};module.exports=MaxRetryExceededError},{}],41:[function(require,module,exports){module.exports=1},{}],42:[function(require,module,exports){var hardLink=require("./../get/util/hardlink");var createHardlink=hardLink.create;var onValue=require("./../get/onValue");var isExpired=require("./../get/util/isExpired");var $ref=require("./../types/ref");var __context=require("./../internal/context");var promote=require("./../get/util/lru").promote;function followReference(model,root,nodeArg,referenceContainerArg,referenceArg,seed,isJSONG){var node=nodeArg;var reference=referenceArg;var referenceContainer=referenceContainerArg;var depth=0;var k,next;while(true){if(depth===0&&referenceContainer[__context]){depth=reference.length;next=referenceContainer[__context]}else{k=reference[depth++];next=node[k]}if(next){var type=next.$type;var value=type&&next.value||next;if(depth<reference.length){if(type){node=next;break}node=next;continue}else{node=next;if(type&&isExpired(next)){break}if(!referenceContainer[__context]){createHardlink(referenceContainer,next)}if(type===$ref){if(isJSONG){onValue(model,next,seed,null,null,null,reference,reference.length,isJSONG)}else{promote(model,next)}depth=0;reference=value;referenceContainer=next;node=root;continue}break}}else{node=void 0}break}if(depth<reference.length&&node!==void 0){var ref=[];for(var i=0;i<depth;i++){ref[i]=reference[i]}reference=ref}return[node,reference]}module.exports=followReference},{"./../get/onValue":53,"./../get/util/hardlink":57,"./../get/util/isExpired":58,"./../get/util/lru":60,"./../internal/context":64,"./../types/ref":149}],43:[function(require,module,exports){var getCachePosition=require("./../get/getCachePosition");var InvalidModelError=require("./../errors/InvalidModelError");var BoundJSONGraphModelError=require("./../errors/BoundJSONGraphModelError");var SHORTED=require("./SHORTED");module.exports=function get(walk,isJSONG){return function innerGet(model,paths,seed){var valueNode=seed[0];var results={values:seed,optimizedPaths:[]};var cache=model._root.cache;var boundPath=model._path;var currentCachePosition=cache;var optimizedPath,optimizedLength=boundPath.length;var i,len;var requestedPath=[];if(optimizedLength){if(isJSONG){return{criticalError:new BoundJSONGraphModelError}}currentCachePosition=getCachePosition(model,boundPath);if(currentCachePosition===SHORTED){return{criticalError:new InvalidModelError(boundPath,boundPath)}}optimizedPath=[];for(i=0;i<optimizedLength;++i){optimizedPath[i]=boundPath[i]}}else{optimizedPath=[];optimizedLength=0}for(i=0,len=paths.length;i<len;i++){walk(model,cache,currentCachePosition,paths[i],0,valueNode,results,requestedPath,optimizedPath,optimizedLength,isJSONG)}return results}}},{"./../errors/BoundJSONGraphModelError":37,"./../errors/InvalidModelError":38,"./../get/getCachePosition":46,"./SHORTED":41}],44:[function(require,module,exports){var getValueSync=require("./../get/getValueSync");var InvalidModelError=require("./../errors/InvalidModelError");module.exports=function getBoundValue(model,pathArg){var path=pathArg;var boundPath=pathArg;var boxed,materialized,treatErrorsAsValues,value,shorted,found;boxed=model._boxed;materialized=model._materialized;treatErrorsAsValues=model._treatErrorsAsValues;model._boxed=true;model._materialized=true;model._treatErrorsAsValues=true;value=getValueSync(model,path.concat(null),true);model._boxed=boxed;model._materialized=materialized;model._treatErrorsAsValues=treatErrorsAsValues;path=value.optimizedPath;shorted=value.shorted;found=value.found;value=value.value;while(path.length&&path[path.length-1]===null){path.pop()}if(found&&shorted){throw new InvalidModelError(boundPath,path)}return{path:path,value:value,shorted:shorted,found:found}}},{"./../errors/InvalidModelError":38,"./../get/getValueSync":48}],45:[function(require,module,exports){var $modelCreated=require("./../internal/model-created");var clone=require("./util/clone");var prefix=require("./../internal/prefix");module.exports=function getCache(cache){var out={};_copyCache(cache,out);return out};function _copyCache(node,out,fromKey){Object.keys(node).filter(function(k){return k[0]!==prefix&&k!=="$size"}).forEach(function(key){var cacheNext=node[key];var outNext=out[key];if(!outNext){outNext=out[key]={}}if(cacheNext.$type){var isObject=cacheNext.value&&typeof cacheNext.value==="object";var isUserCreatedcacheNext=!node[$modelCreated];var value;if(isObject||isUserCreatedcacheNext){value=clone(cacheNext)}else{value=cacheNext.value}out[key]=value;return}_copyCache(cacheNext,outNext,key)})}},{"./../internal/model-created":68,"./../internal/prefix":71,"./util/clone":56}],46:[function(require,module,exports){var SHORTED=require("./SHORTED");module.exports=function getCachePosition(model,path){var currentCachePosition=model._root.cache;var depth=-1;var maxDepth=path.length;while(++depth<maxDepth&&currentCachePosition&&!currentCachePosition.$type){currentCachePosition=currentCachePosition[path[depth]]}if(depth!==maxDepth&&currentCachePosition){return SHORTED}return currentCachePosition}},{"./SHORTED":41}],47:[function(require,module,exports){var ModelResponse=require("./../response/ModelResponse");var pathSyntax=require("falcor-path-syntax");module.exports=function getValue(path){var parsedPath=pathSyntax.fromPath(path);var pathIdx=0;var pathLen=parsedPath.length;while(++pathIdx<pathLen){if(typeof parsedPath[pathIdx]==="object"){return new ModelResponse(function(o){o.onError(new Error("Paths must be simple paths"))})}}var self=this;return new ModelResponse(function(obs){return self.get(parsedPath).subscribe(function(data){var curr=data.json;var depth=-1;var length=parsedPath.length;while(curr&&++depth<length){curr=curr[parsedPath[depth]]}obs.onNext(curr)},function(err){obs.onError(err)},function(){obs.onCompleted()})})}},{"./../response/ModelResponse":95,"falcor-path-syntax":16}],48:[function(require,module,exports){var followReference=require("./../get/followReference");var clone=require("./../get/util/clone");var isExpired=require("./../get/util/isExpired");var promote=require("./../get/util/lru").promote;var $ref=require("./../types/ref");var $atom=require("./../types/atom");var $error=require("./../types/error");module.exports=function getValueSync(model,simplePath,noClone){var root=model._root.cache;var len=simplePath.length;var optimizedPath=[];var shorted=false,shouldShort=false;var depth=0;var key,i,next=root,curr=root,out=root,type,ref,refNode;var found=true;while(next&&depth<len){key=simplePath[depth++];if(key!==null){next=curr[key];optimizedPath[optimizedPath.length]=key}if(!next){out=void 0;shorted=true;found=false;break}type=next.$type;if(depth<len){if(type===$ref){ref=followReference(model,root,root,next,next.value);refNode=ref[0];if(!refNode){out=void 0;next=void 0;break}type=refNode.$type;next=refNode;optimizedPath=ref[1].slice(0)}if(type){break}}else{out=next}curr=next}if(depth<len){for(i=depth;i<len;++i){if(simplePath[depth]!==null){shouldShort=true;break}}if(shouldShort){shorted=true;out=void 0}else{out=next}for(i=depth;i<len;++i){optimizedPath[optimizedPath.length]=simplePath[i]}}if(out&&type){if(isExpired(out)){out=void 0}else{promote(model,out)}}if(out&&type===$error&&!model._treatErrorsAsValues){throw{path:depth===len?simplePath:simplePath.slice(0,depth),value:out.value}}else if(out&&model._boxed){out=Boolean(type)&&!noClone?clone(out):out}else if(!out&&model._materialized){out={$type:$atom}}else if(out){out=out.value}return{value:out,shorted:shorted,optimizedPath:optimizedPath,found:found}}},{"./../get/followReference":42,"./../get/util/clone":56,"./../get/util/isExpired":58,"./../get/util/lru":60,"./../types/atom":147,"./../types/error":148,"./../types/ref":149}],49:[function(require,module,exports){var __version=require("./../internal/version");module.exports=function _getVersion(model,path){var gen=model._getValueSync({_boxed:true,_root:model._root,_treatErrorsAsValues:model._treatErrorsAsValues},path,true).value;var version=gen&&gen[__version];return version==null?-1:version}},{"./../internal/version":77}],50:[function(require,module,exports){var get=require("./get");var walkPath=require("./walkPath");var getWithPathsAsPathMap=get(walkPath,false);var getWithPathsAsJSONGraph=get(walkPath,true);module.exports={getValueSync:require("./../get/getValueSync"),getBoundValue:require("./../get/getBoundValue"),getWithPathsAsPathMap:getWithPathsAsPathMap,getWithPathsAsJSONGraph:getWithPathsAsJSONGraph}},{"./../get/getBoundValue":44,"./../get/getValueSync":48,"./get":43,"./walkPath":62}],51:[function(require,module,exports){var lru=require("./../get/util/lru");var clone=require("./../get/util/clone");var promote=lru.promote;module.exports=function onError(model,node,depth,requestedPath,outerResults){var value=node.value;if(!outerResults.errors){outerResults.errors=[]}if(model._boxed){value=clone(node)}outerResults.errors.push({path:requestedPath.slice(0,depth+1),value:value});promote(model,node)}},{"./../get/util/clone":56,"./../get/util/lru":60}],52:[function(require,module,exports){var support=require("./util/support");var fastCopy=support.fastCopy;module.exports=function onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength){var pathSlice;if(!outerResults.requestedMissingPaths){outerResults.requestedMissingPaths=[];outerResults.optimizedMissingPaths=[]}if(depth<path.length){pathSlice=fastCopy(path,depth)}else{pathSlice=[]}concatAndInsertMissing(model,pathSlice,depth,requestedPath,optimizedPath,optimizedLength,outerResults)};function concatAndInsertMissing(model,remainingPath,depth,requestedPath,optimizedPath,optimizedLength,results){results.requestedMissingPaths.push(requestedPath.slice(0,depth).concat(remainingPath));results.optimizedMissingPaths.push(optimizedPath.slice(0,optimizedLength).concat(remainingPath))}},{"./util/support":61}],53:[function(require,module,exports){var lru=require("./util/lru");var clone=require("./util/clone");var promote=lru.promote;var $ref=require("./../types/ref");var $atom=require("./../types/atom");var $error=require("./../types/error");var $modelCreated=require("./../internal/model-created");module.exports=function onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference){if(!seed){return}var i,len,k,key,curr,prev,prevK;var materialized=false,valueNode;if(node){promote(model,node)}if(!node||node.value===undefined){materialized=model._materialized}if(materialized){valueNode={$type:$atom}}else if(model._boxed){valueNode=clone(node)}else if(node.$type===$ref||node.$type===$error){if(isJSONG){valueNode=clone(node)}else{valueNode=node.value}}else if(isJSONG){var isObject=node.value&&typeof node.value==="object";var isUserCreatedNode=!node[$modelCreated];if(isObject||isUserCreatedNode){valueNode=clone(node)}else{valueNode=node.value}}else{valueNode=node.value}if(outerResults){outerResults.hasValue=true}if(isJSONG){curr=seed.jsonGraph;if(!curr){curr=seed.jsonGraph={};seed.paths=[]}for(i=0,len=optimizedLength-1;i<len;i++){key=optimizedPath[i];if(!curr[key]){curr[key]={}}curr=curr[key]}key=optimizedPath[i];curr[key]=materialized?{$type:$atom}:valueNode;if(requestedPath){seed.paths.push(requestedPath.slice(0,depth))}}else if(depth===0){seed.json=valueNode}else{curr=seed.json;if(!curr){curr=seed.json={}}for(i=0;i<depth-1;i++){k=requestedPath[i];if(!curr[k]){curr[k]={}}prev=curr;prevK=k;curr=curr[k]}k=requestedPath[i];if(k!==null){curr[k]=valueNode}else{prev[prevK]=valueNode}}}},{"./../internal/model-created":68,"./../types/atom":147,"./../types/error":148,"./../types/ref":149,"./util/clone":56,"./util/lru":60}],54:[function(require,module,exports){var isExpired=require("./util/isExpired");var hardLink=require("./util/hardlink");var lru=require("./util/lru");var removeHardlink=hardLink.remove;var splice=lru.splice;var $error=require("./../types/error");var onError=require("./onError");var onValue=require("./onValue");var onMissing=require("./onMissing");var isMaterialized=require("./util/isMaterialzed");var __invalidated=require("./../internal/invalidated");module.exports=function onValueType(model,node,path,depth,seed,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference){var currType=node&&node.$type;var requiresMaterializedToReport=node&&node.value===undefined;if(!node||!currType){if(isMaterialized(model)){onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference)}else{onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength)}return}else if(isExpired(node)){if(!node[__invalidated]){splice(model,node);removeHardlink(node)}onMissing(model,path,depth,outerResults,requestedPath,optimizedPath,optimizedLength)}else if(currType===$error){if(fromReference){requestedPath[depth]=null}if(isJSONG||model._treatErrorsAsValues){onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference)}else{onError(model,node,depth,requestedPath,outerResults)}}else{if(fromReference){requestedPath[depth]=null}if(!requiresMaterializedToReport||requiresMaterializedToReport&&isMaterialized(model)){onValue(model,node,seed,depth,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference)}}}},{"./../internal/invalidated":66,"./../types/error":148,"./onError":51,"./onMissing":52,"./onValue":53,"./util/hardlink":57,"./util/isExpired":58,"./util/isMaterialzed":59,"./util/lru":60}],55:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");module.exports=function getValueSync(pathArg){var path=pathSyntax.fromPath(pathArg);if(Array.isArray(path)===false){throw new Error("Model#getValueSync must be called with an Array path.")}if(this._path.length){path=this._path.concat(path)}return this._syncCheck("getValueSync")&&this._getValueSync(this,path).value}},{"falcor-path-syntax":16}],56:[function(require,module,exports){var prefix=require("./../../internal/prefix");module.exports=function clone(node){var outValue,i,len;var keys=Object.keys(node);outValue={};for(i=0,len=keys.length;i<len;i++){var k=keys[i];if(k[0]===prefix){continue}outValue[k]=node[k]}return outValue}},{"./../../internal/prefix":71}],57:[function(require,module,exports){var __ref=require("./../../internal/ref");var __context=require("./../../internal/context");var __refIndex=require("./../../internal/ref-index");var __refsLength=require("./../../internal/refs-length");function createHardlink(from,to){var backRefs=to[__refsLength]||0;to[__ref+backRefs]=from;to[__refsLength]=backRefs+1;from[__refIndex]=backRefs;from[__context]=to}function removeHardlink(cacheObject){var context=cacheObject[__context];if(context){var idx=cacheObject[__refIndex];var len=context[__refsLength];while(idx<len){context[__ref+idx]=context[__ref+idx+1];++idx}context[__refsLength]=len-1;cacheObject[__context]=void 0;cacheObject[__refIndex]=void 0}}module.exports={create:createHardlink,remove:removeHardlink}},{"./../../internal/context":64,"./../../internal/ref":74,"./../../internal/ref-index":73,"./../../internal/refs-length":75}],58:[function(require,module,exports){var now=require("./../../support/now");module.exports=function isExpired(node){var $expires=node.$expires===void 0&&-1||node.$expires;return $expires!==-1&&$expires!==1&&($expires===0||$expires<now())}},{"./../../support/now":136}],59:[function(require,module,exports){module.exports=function isMaterialized(model){return model._materialized&&!model._source}},{}],60:[function(require,module,exports){var __head=require("./../../internal/head");var __tail=require("./../../internal/tail");var __next=require("./../../internal/next");var __prev=require("./../../internal/prev");var __invalidated=require("./../../internal/invalidated");function lruPromote(model,object){var root=model._root;var head=root[__head];if(head===object){return}var prev=object[__prev];var next=object[__next];if(next){next[__prev]=prev}if(prev){prev[__next]=next}object[__prev]=void 0;root[__head]=object;object[__next]=head;head[__prev]=object}function lruSplice(model,object){var root=model._root;var prev=object[__prev];var next=object[__next];if(next){next[__prev]=prev}if(prev){prev[__next]=next}object[__prev]=void 0;if(object===root[__head]){root[__head]=void 0}if(object===root[__tail]){root[__tail]=void 0}object[__invalidated]=true;root.expired.push(object)}module.exports={promote:lruPromote,splice:lruSplice}},{"./../../internal/head":65,"./../../internal/invalidated":66,"./../../internal/next":69,"./../../internal/prev":72,"./../../internal/tail":76}],61:[function(require,module,exports){function fastCopy(arr,iArg){var a=[],len,j,i;for(j=0,i=iArg||0,len=arr.length;i<len;j++,i++){a[j]=arr[i]}return a}function fastCatSkipNulls(arr1,arr2){var a=[],i,len,j;for(i=0,
len=arr1.length;i<len;i++){a[i]=arr1[i]}for(j=0,len=arr2.length;j<len;j++){if(arr2[j]!==null){a[i++]=arr2[j]}}return a}function fastCat(arr1,arr2){var a=[],i,len,j;for(i=0,len=arr1.length;i<len;i++){a[i]=arr1[i]}for(j=0,len=arr2.length;j<len;j++){a[i++]=arr2[j]}return a}module.exports={fastCat:fastCat,fastCatSkipNulls:fastCatSkipNulls,fastCopy:fastCopy}},{}],62:[function(require,module,exports){var followReference=require("./followReference");var onValueType=require("./onValueType");var isExpired=require("./util/isExpired");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var $ref=require("./../types/ref");module.exports=function walkPath(model,root,curr,path,depth,seed,outerResults,requestedPath,optimizedPathArg,optimizedLength,isJSONG,fromReferenceArg){var fromReference=fromReferenceArg;var optimizedPath=optimizedPathArg;if(!curr||curr&&curr.$type||depth===path.length){onValueType(model,curr,path,depth,seed,outerResults,requestedPath,optimizedPath,optimizedLength,isJSONG,fromReference);return}var keySet,i;keySet=path[depth];var isKeySet=typeof keySet==="object";var nextDepth=depth+1;var iteratorNote=false;var key=keySet;if(isKeySet){iteratorNote={};key=iterateKeySet(keySet,iteratorNote)}if(key===undefined&&iteratorNote.done){return}var optimizedLengthPlus1=optimizedLength+1;do{fromReference=false;var next;if(key===null){next=curr}else{next=curr[key];optimizedPath[optimizedLength]=key;requestedPath[depth]=key}var nextOptimizedPath=optimizedPath;var nextOptimizedLength=optimizedLengthPlus1;if(next){var nType=next.$type;var value=nType&&next.value||next;if(nextDepth<path.length&&nType&&nType===$ref&&!isExpired(next)){if(isJSONG){onValueType(model,next,path,nextDepth,seed,outerResults,null,optimizedPath,nextOptimizedLength,isJSONG,fromReference)}var ref=followReference(model,root,root,next,value,seed,isJSONG);fromReference=true;next=ref[0];var refPath=ref[1];nextOptimizedPath=[];nextOptimizedLength=refPath.length;for(i=0;i<nextOptimizedLength;++i){nextOptimizedPath[i]=refPath[i]}}}walkPath(model,root,next,path,nextDepth,seed,outerResults,requestedPath,nextOptimizedPath,nextOptimizedLength,isJSONG,fromReference);if(iteratorNote&&!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(iteratorNote&&!iteratorNote.done)}},{"./../types/ref":149,"./followReference":42,"./onValueType":54,"./util/isExpired":58,"falcor-path-utils":25}],63:[function(require,module,exports){"use strict";function falcor(opts){return new falcor.Model(opts)}if(typeof Promise==="function"){falcor.Promise=Promise}else{falcor.Promise=require("promise")}module.exports=falcor;falcor.Model=require("./Model")},{"./Model":32,promise:153}],64:[function(require,module,exports){module.exports=require("./../internal/prefix")+"context"},{"./../internal/prefix":71}],65:[function(require,module,exports){module.exports=require("./../internal/prefix")+"head"},{"./../internal/prefix":71}],66:[function(require,module,exports){module.exports=require("./../internal/prefix")+"invalidated"},{"./../internal/prefix":71}],67:[function(require,module,exports){module.exports=require("./../internal/prefix")+"key"},{"./../internal/prefix":71}],68:[function(require,module,exports){module.exports="$modelCreated"},{}],69:[function(require,module,exports){module.exports=require("./../internal/prefix")+"next"},{"./../internal/prefix":71}],70:[function(require,module,exports){module.exports=require("./../internal/prefix")+"parent"},{"./../internal/prefix":71}],71:[function(require,module,exports){module.exports=String.fromCharCode(30)},{}],72:[function(require,module,exports){module.exports=require("./../internal/prefix")+"prev"},{"./../internal/prefix":71}],73:[function(require,module,exports){module.exports=require("./../internal/prefix")+"ref-index"},{"./../internal/prefix":71}],74:[function(require,module,exports){module.exports=require("./../internal/prefix")+"ref"},{"./../internal/prefix":71}],75:[function(require,module,exports){module.exports=require("./../internal/prefix")+"refs-length"},{"./../internal/prefix":71}],76:[function(require,module,exports){module.exports=require("./../internal/prefix")+"tail"},{"./../internal/prefix":71}],77:[function(require,module,exports){module.exports=require("./../internal/prefix")+"version"},{"./../internal/prefix":71}],78:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __prefix=require("./../internal/prefix");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var getSize=require("./../support/getSize");var hasOwn=require("./../support/hasOwn");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var incrementVersion=require("./../support/incrementVersion");var updateNodeAncestors=require("./../support/updateNodeAncestors");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function invalidatePathMaps(model,pathMapEnvelopes){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var comparator=modelRoot._comparator;var errorSelector=modelRoot._errorSelector;var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var pathMapIndex=-1;var pathMapCount=pathMapEnvelopes.length;while(++pathMapIndex<pathMapCount){var pathMapEnvelope=pathMapEnvelopes[pathMapIndex];invalidatePathMap(pathMapEnvelope.json,0,cache,parent,node,version,expired,lru,comparator,errorSelector)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}};function invalidatePathMap(pathMap,depth,root,parent,node,version,expired,lru,comparator,errorSelector){if(isPrimitive(pathMap)||pathMap.$type){return}for(var key in pathMap){if(key[0]!==__prefix&&key[0]!=="$"&&hasOwn(pathMap,key)){var child=pathMap[key];var branch=isObject(child)&&!child.$type;var results=invalidateNode(root,parent,node,key,child,branch,false,version,expired,lru,comparator,errorSelector);var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){invalidatePathMap(child,depth+1,root,nextParent,nextNode,version,expired,lru,comparator,errorSelector)}else if(removeNodeAndDescendants(nextNode,nextParent,key,lru)){updateNodeAncestors(nextParent,getSize(nextNode),lru,version)}}}}}function invalidateReference(value,root,node,version,expired,lru,comparator,errorSelector){if(isExpired(node)){expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var reference=node.value;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=invalidateNode(root,parent,node,key,value,branch,true,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1]}while(index++<count);if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function invalidateNode(root,parent,node,key,value,branch,reference,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=invalidateReference(value,root,node,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node&&node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}return[node,parent]}},{"./../get/getBoundValue":44,"./../internal/context":64,"./../internal/key":67,"./../internal/parent":70,"./../internal/prefix":71,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75,"./../internal/version":77,"./../lru/promote":81,"./../support/expireNode":117,"./../support/getSize":119,"./../support/hasOwn":122,"./../support/incrementVersion":123,"./../support/isExpired":126,"./../support/isFunction":127,"./../support/isObject":130,"./../support/isPrimitive":132,"./../support/removeNodeAndDescendants":138,"./../support/updateNodeAncestors":144,"./../types/ref":149}],79:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var getSize=require("./../support/getSize");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var updateNodeAncestors=require("./../support/updateNodeAncestors");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function invalidatePathSets(model,paths){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var pathIndex=-1;var pathCount=paths.length;while(++pathIndex<pathCount){var path=paths[pathIndex];invalidatePathSet(path,0,cache,parent,node,version,expired,lru)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}};function invalidatePathSet(path,depth,root,parent,node,version,expired,lru){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);do{var results=invalidateNode(root,parent,node,key,branch,false,version,expired,lru);var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){invalidatePathSet(path,depth+1,root,nextParent,nextNode,version,expired,lru)}else if(removeNodeAndDescendants(nextNode,nextParent,key,lru)){updateNodeAncestors(nextParent,getSize(nextNode),lru,version)}}key=iterateKeySet(keySet,note)}while(!note.done)}function invalidateReference(root,node,version,expired,lru){if(isExpired(node)){expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var reference=node.value;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=invalidateNode(root,parent,node,key,branch,true,version,expired,lru);node=results[0];if(isPrimitive(node)){return results}parent=results[1]}while(index++<count);if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function invalidateNode(root,parent,node,key,branch,reference,version,expired,lru){var type=node.$type;while(type===$ref){var results=invalidateReference(root,node,version,expired,lru);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}return[node,parent]}},{"./../get/getBoundValue":44,"./../internal/context":64,"./../internal/key":67,"./../internal/parent":70,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75,"./../internal/version":77,"./../lru/promote":81,"./../support/expireNode":117,"./../support/getSize":119,"./../support/incrementVersion":123,"./../support/isExpired":126,"./../support/isFunction":127,"./../support/isPrimitive":132,"./../support/removeNodeAndDescendants":138,"./../support/updateNodeAncestors":144,"./../types/ref":149,"falcor-path-utils":25}],80:[function(require,module,exports){var __key=require("./../internal/key");var __parent=require("./../internal/parent");var __head=require("./../internal/head");var __tail=require("./../internal/tail");var __next=require("./../internal/next");var __prev=require("./../internal/prev");var removeNode=require("./../support/removeNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");module.exports=function collect(lru,expired,totalArg,max,ratioArg,version){var total=totalArg;var ratio=ratioArg;if(typeof ratio!=="number"){ratio=.75}var shouldUpdate=typeof version==="number";var targetSize=max*ratio;var parent,node,size;node=expired.pop();while(node){size=node.$size||0;total-=size;if(shouldUpdate===true){updateNodeAncestors(node,size,lru,version)}else if(parent=node[__parent]){removeNode(node,parent,node[__key],lru)}node=expired.pop()}if(total>=max){var prev=lru[__tail];node=prev;while(total>=targetSize&&node){prev=prev[__prev];size=node.$size||0;total-=size;if(shouldUpdate===true){updateNodeAncestors(node,size,lru,version)}node=prev}lru[__tail]=lru[__prev]=node;if(node==null){lru[__head]=lru[__next]=void 0}else{node[__next]=void 0}}}},{"./../internal/head":65,"./../internal/key":67,"./../internal/next":69,"./../internal/parent":70,"./../internal/prev":72,"./../internal/tail":76,"./../support/removeNode":137,"./../support/updateNodeAncestors":144}],81:[function(require,module,exports){var $expiresNever=require("./../values/expires-never");var __head=require("./../internal/head");var __tail=require("./../internal/tail");var __next=require("./../internal/next");var __prev=require("./../internal/prev");var isObject=require("./../support/isObject");module.exports=function lruPromote(root,node){if(isObject(node)&&node.$expires!==$expiresNever){var head=root[__head],tail=root[__tail],next=node[__next],prev=node[__prev];if(node!==head){if(next!=null&&typeof next==="object"){next[__prev]=prev}if(prev!=null&&typeof prev==="object"){prev[__next]=next}next=head;if(head!=null&&typeof head==="object"){head[__prev]=node}root[__head]=root[__next]=head=node;head[__next]=next;head[__prev]=void 0}if(tail==null||node===tail){root[__tail]=root[__prev]=tail=prev||node}}return node}},{"./../internal/head":65,"./../internal/next":69,"./../internal/prev":72,"./../internal/tail":76,"./../support/isObject":130,"./../values/expires-never":150}],82:[function(require,module,exports){var __head=require("./../internal/head");var __tail=require("./../internal/tail");var __next=require("./../internal/next");var __prev=require("./../internal/prev");module.exports=function lruSplice(root,node){var head=root[__head],tail=root[__tail],next=node[__next],prev=node[__prev];if(next!=null&&typeof next==="object"){next[__prev]=prev}if(prev!=null&&typeof prev==="object"){prev[__next]=next}if(node===head){root[__head]=root[__next]=next}if(node===tail){root[__tail]=root[__prev]=prev}node[__next]=node[__prev]=void 0;head=tail=next=prev=void 0}},{"./../internal/head":65,"./../internal/next":69,"./../internal/prev":72,"./../internal/tail":76}],83:[function(require,module,exports){var complement=require("./complement");var flushGetRequest=require("./flushGetRequest");var REQUEST_ID=0;var GetRequestType=require("./RequestTypes").GetRequest;var setJSONGraphs=require("./../set/setJSONGraphs");var setPathValues=require("./../set/setPathValues");var $error=require("./../types/error");var emptyArray=[];var GetRequestV2=function(scheduler,requestQueue){this.sent=false;this.scheduled=false;this.requestQueue=requestQueue;this.id=++REQUEST_ID;this.type=GetRequestType;this._scheduler=scheduler;this._pathMap={};this._optimizedPaths=[];this._requestedPaths=[];this._callbacks=[];this._count=0;this._disposable=null;this._collapsed=null;this._disposed=false};GetRequestV2.prototype={batch:function(requestedPaths,optimizedPaths,callback){var self=this;var oPaths=self._optimizedPaths;var rPaths=self._requestedPaths;var callbacks=self._callbacks;var idx=oPaths.length;oPaths[idx]=optimizedPaths;rPaths[idx]=requestedPaths;callbacks[idx]=callback;++self._count;if(!self.scheduled){self.scheduled=true;self._disposable=self._scheduler.schedule(function(){flushGetRequest(self,oPaths,function(err,data){self.requestQueue.removeRequest(self);self._disposed=true;if(self._count){self._merge(rPaths,err,data);for(var i=0,len=callbacks.length;i<len;++i){var fn=callbacks[i];if(fn){fn(err,data)}}}})})}return createDisposable(self,idx)},add:function(requested,optimized,callback){var self=this;var complementTuple=complement(requested,optimized,self._pathMap);var optimizedComplement;var requestedComplement;if(complementTuple){requestedComplement=complementTuple[2];optimizedComplement=complementTuple[1]}else{requestedComplement=requested;optimizedComplement=optimized}var inserted=false;var disposable=false;if(optimizedComplement.length<optimized.length){inserted=true;var idx=self._callbacks.length;self._callbacks[idx]=callback;self._requestedPaths[idx]=complementTuple[0];self._optimizedPaths[idx]=[];++self._count;disposable=createDisposable(self,idx)}return[inserted,requestedComplement,optimizedComplement,disposable]},_merge:function(requested,err,data){var self=this;var model=self.requestQueue.model;var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var comparator=modelRoot.comparator;var boundPath=model._path;model._path=emptyArray;var nextPaths=flattenRequestedPaths(requested);if(err){var error=err;if(error instanceof Error){error={message:error.message}}if(!error.$type){error={$type:$error,value:error}}var pathValues=nextPaths.map(function(x){return{path:x,value:error}});setPathValues(model,pathValues,null,errorSelector,comparator)}else{setJSONGraphs(model,[{paths:nextPaths,jsonGraph:data.jsonGraph}],null,errorSelector,comparator)}model._path=boundPath}};function createDisposable(request,idx){var disposed=false;return function(){if(disposed||request._disposed){return}disposed=true;request._callbacks[idx]=null;request._optimizedPaths[idx]=[];request._requestedPaths[idx]=[];var count=--request._count;if(count===0&&!request.sent){request._disposable.dispose();request.requestQueue.removeRequest(request)}}}function flattenRequestedPaths(requested){var out=[];var outLen=-1;for(var i=0,len=requested.length;i<len;++i){var paths=requested[i];for(var j=0,innerLen=paths.length;j<innerLen;++j){out[++outLen]=paths[j]}}return out}module.exports=GetRequestV2},{"./../set/setJSONGraphs":107,"./../set/setPathValues":109,"./../types/error":148,"./RequestTypes":88,"./complement":90,"./flushGetRequest":91}],84:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observer=Rx.Observer;var Observable=Rx.Observable;var Disposable=Rx.Disposable;var SerialDisposable=Rx.SerialDisposable;var CompositeDisposable=Rx.CompositeDisposable;var InvalidSourceError=require("./../errors/InvalidSourceError");var falcorPathUtils=require("falcor-path-utils");var iterateKeySet=falcorPathUtils.iterateKeySet;function Request(){this.length=0;this.pending=false;this.pathmaps=[];Observable.call(this,this._subscribe)}Request.create=function create(queue,model,index){var request=new this;request.queue=queue;request.model=model;request.index=index;return request};Request.prototype=Object.create(Observable.prototype);Request.prototype.constructor=Request;Request.prototype.insertPath=function insertPathIntoRequest(path,union,parentArg,indexArg,countArg){var index=indexArg||0;var count=countArg||path.length-1;var parent=parentArg||this.pathmaps[count+1]||(this.pathmaps[count+1]=Object.create(null));if(parent===void 0||parent===null){return false}var key,node;var keySet=path[index];var iteratorNote={};key=iterateKeySet(keySet,iteratorNote);do{node=parent[key];if(index<count){if(node==null){if(union){return false}node=parent[key]=Object.create(null)}if(this.insertPath(path,union,node,index+1,count)===false){return false}}else{parent[key]=(node||0)+1;this.length+=1}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done);return true};Request.prototype.removePath=function removePathFromRequest(path,parentArg,indexArg,countArg){var index=indexArg||0;var count=countArg||path.length-1;var parent=parentArg||this.pathmaps[count+1];if(parent===void 0||parent===null){return true}var key,node,deleted=0;var keySet=path[index];var iteratorNote={};key=iterateKeySet(keySet,iteratorNote);do{node=parent[key];if(node===void 0||node===null){continue}else if(index<count){deleted+=this.removePath(path,node,index+1,count);var emptyNodeKey=void 0;for(emptyNodeKey in node){break}if(emptyNodeKey===void 0){delete parent[key]}}else{node=parent[key]=(node||1)-1;if(node===0){delete parent[key]}deleted+=1;this.length-=1}if(!iteratorNote.done){key=iterateKeySet(keySet,iteratorNote)}}while(!iteratorNote.done);return deleted};Request.prototype.getSourceObserver=function getSourceObserver(observer){var request=this;return Observer.create(function onNext(envelope){envelope.jsonGraph=envelope.jsonGraph||envelope.jsong||envelope.values||envelope.value;envelope.index=request.index;observer.onNext(envelope)},function onError(e){observer.onError(e)},function onCompleted(){observer.onCompleted()})};Request.prototype._subscribe=function _subscribe(observer){var request=this;var queue=this.queue;request.pending=true;var isDisposed=false;var sourceSubscription=new SerialDisposable;var queueDisposable=Disposable.create(function(){if(!isDisposed){isDisposed=true;if(queue){queue._remove(request)}}});var disposables=new CompositeDisposable(sourceSubscription,queueDisposable);try{sourceSubscription.setDisposable(this.model._source[this.method](this.getSourceArgs()).subscribe(this.getSourceObserver(observer)))}catch(e){throw new InvalidSourceError(e)}return disposables};module.exports=Request},{"./../errors/InvalidSourceError":39,"falcor-path-utils":25,"rx/dist/rx":161}],85:[function(require,module,exports){var SetRequest=require("./../request/SetRequest");var prefix=require("./../internal/prefix");var getType=require("./../support/getType");var isObject=require("./../support/isObject");var falcorPathUtils=require("falcor-path-utils");function RequestQueue(model,scheduler){this.total=0;this.model=model;this.requests=[];this.scheduler=scheduler}RequestQueue.prototype.set=function setRequest(jsonGraphEnvelope){jsonGraphEnvelope.paths=falcorPathUtils.collapse(jsonGraphEnvelope.paths);return SetRequest.create(this.model,jsonGraphEnvelope)};RequestQueue.prototype._remove=function removeRequest(request){var requests=this.requests;var index=requests.indexOf(request);if(index!==-1){requests.splice(index,1)}};RequestQueue.prototype.distributePaths=function distributePathsAcrossRequests(paths,requests,RequestType){var model=this.model;var pathsIndex=-1;var pathsCount=paths.length;var requestIndex=-1;var requestCount=requests.length;var participatingRequests=[];var pendingRequest;var request;insertPath:while(++pathsIndex<pathsCount){var path=paths[pathsIndex];requestIndex=-1;while(++requestIndex<requestCount){request=requests[requestIndex];if(request.insertPath(path,request.pending)){participatingRequests[requestIndex]=request;continue insertPath}}if(!pendingRequest){pendingRequest=RequestType.create(this,model,this.total++);requests[requestIndex]=pendingRequest;participatingRequests[requestCount++]=pendingRequest}pendingRequest.insertPath(path,false)}var pathRequests=[];var pathRequestsIndex=-1;requestIndex=-1;while(++requestIndex<requestCount){request=participatingRequests[requestIndex];if(request!=null){pathRequests[++pathRequestsIndex]=request}}return pathRequests};RequestQueue.prototype.mergeJSONGraphs=function mergeJSONGraphs(aggregate,response){var depth=0;var contexts=[];var messages=[];var keystack=[];var latestIndex=aggregate.index;var responseIndex=response.index;aggregate.index=Math.max(latestIndex,responseIndex);contexts[-1]=aggregate.jsonGraph||{};messages[-1]=response.jsonGraph||{};recursing:while(depth>-1){var context=contexts[depth-1];var message=messages[depth-1];var keys=keystack[depth-1]||(keystack[depth-1]=Object.keys(message));while(keys.length>0){var key=keys.pop();if(key[0]===prefix){continue}if(context.hasOwnProperty(key)){var node=context[key];var nodeType=getType(node);var messageNode=message[key];var messageType=getType(messageNode);if(isObject(node)&&isObject(messageNode)&&!nodeType&&!messageType){contexts[depth]=node;messages[depth]=messageNode;depth+=1;continue recursing}else if(responseIndex>latestIndex){context[key]=messageNode}}else{context[key]=message[key]}}depth-=1}return aggregate};module.exports=RequestQueue},{"./../internal/prefix":71,"./../request/SetRequest":89,"./../support/getType":121,"./../support/isObject":130,"falcor-path-utils":25}],86:[function(require,module,exports){var RequestQueue=require("./RequestQueue");var RequestQueueV2=require("./RequestQueueV2");function RequestQueueRx(model,scheduler){this.model=model;this.scheduler=scheduler;this.requests=this._requests=[]}RequestQueueRx.prototype.get=RequestQueueV2.prototype.get;RequestQueueRx.prototype.removeRequest=RequestQueueV2.prototype.removeRequest;RequestQueueRx.prototype.set=RequestQueue.prototype.set;RequestQueueRx.prototype.call=RequestQueue.prototype.call;module.exports=RequestQueueRx},{"./RequestQueue":85,"./RequestQueueV2":87}],87:[function(require,module,exports){var RequestTypes=require("./RequestTypes");var GetRequest=require("./GetRequestV2");function RequestQueueV2(model,scheduler){this.model=model;this.scheduler=scheduler;this.requests=this._requests=[]}RequestQueueV2.prototype={setScheduler:function(scheduler){this.scheduler=scheduler},get:function(requestedPaths,optimizedPaths,cb){var self=this;var disposables=[];var count=0;var requests=self._requests;var i,len;var oRemainingPaths=optimizedPaths;var rRemainingPaths=requestedPaths;var disposed=false;var request;for(i=0,len=requests.length;i<len;++i){request=requests[i];if(request.type!==RequestTypes.GetRequest){continue}if(request.sent){var results=request.add(rRemainingPaths,oRemainingPaths,refCountCallback);if(results[0]){rRemainingPaths=results[1];oRemainingPaths=results[2];disposables[disposables.length]=results[3];++count}}else{request.batch(rRemainingPaths,oRemainingPaths,refCountCallback);oRemainingPaths=[];rRemainingPaths=[];++count}if(!oRemainingPaths.length){break}}if(oRemainingPaths.length){request=new GetRequest(self.scheduler,self);requests[requests.length]=request;++count;var disposable=request.batch(rRemainingPaths,oRemainingPaths,refCountCallback);disposables[disposables.length]=disposable}function refCountCallback(){if(disposed){return}--count;if(count===0){cb()}}return function(){if(disposed||count===0){return}disposed=true;var length=disposables.length;for(var idx=0;idx<length;++idx){disposables[idx]()}}},removeRequest:function(request){var requests=this._requests;var i=requests.length;while(--i>=0){if(requests[i].id===request.id){requests.splice(i,1);break}}}};module.exports=RequestQueueV2},{"./GetRequestV2":83,"./RequestTypes":88}],88:[function(require,module,exports){module.exports={GetRequest:"GET"}},{}],89:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observer=Rx.Observer;var Request=require("./../request/Request");var arrayMap=require("./../support/array-map");var setJSONGraphs=require("./../set/setJSONGraphs");var setPathValues=require("./../set/setPathValues");var emptyArray=new Array(0);function SetRequest(){Request.call(this)}SetRequest.create=function create(model,jsonGraphEnvelope){var request=new SetRequest;request.model=model;request.jsonGraphEnvelope=jsonGraphEnvelope;return request};SetRequest.prototype=Object.create(Request.prototype);SetRequest.prototype.constructor=SetRequest;SetRequest.prototype.method="set";SetRequest.prototype.insertPath=function(){return false};SetRequest.prototype.removePath=function(){return 0};SetRequest.prototype.getSourceArgs=function getSourceArgs(){return this.jsonGraphEnvelope};SetRequest.prototype.getSourceObserver=function getSourceObserver(observer){var model=this.model;var bound=model._path;var paths=this.jsonGraphEnvelope.paths;var modelRoot=model._root;var errorSelector=modelRoot.errorSelector;var comparator=modelRoot.comparator;return Request.prototype.getSourceObserver.call(this,Observer.create(function onNext(jsonGraphEnvelope){model._path=emptyArray;var successfulPaths=setJSONGraphs(model,[{paths:paths,jsonGraph:jsonGraphEnvelope.jsonGraph}],null,errorSelector,comparator);jsonGraphEnvelope.paths=successfulPaths[1];model._path=bound;observer.onNext(jsonGraphEnvelope)},function onError(error){model._path=emptyArray;setPathValues(model,arrayMap(paths,function(path){return{path:path,value:error}}),null,errorSelector,comparator);model._path=bound;observer.onError(error)},function onCompleted(){observer.onCompleted()}))};module.exports=SetRequest},{"./../request/Request":84,"./../set/setJSONGraphs":107,"./../set/setPathValues":109,"./../support/array-map":114,"rx/dist/rx":161}],90:[function(require,module,exports){var hasIntersection=require("falcor-path-utils").hasIntersection;var arraySlice=require("./../support/array-slice");module.exports=function complement(requested,optimized,tree){var optimizedComplement=[];var requestedComplement=[];var requestedIntersection=[];var intersectionLength=-1,complementLength=-1;var intersectionFound=false;for(var i=0,len=optimized.length;i<len;++i){var path=optimized[i];var subTree=tree[path.length];if(!subTree||!hasIntersection(subTree,path,0)){if(intersectionFound){optimizedComplement[++complementLength]=path;requestedComplement[complementLength]=requested[i]}}else{if(!intersectionFound&&i>0){requestedComplement=arraySlice(requested,0,i);optimizedComplement=arraySlice(optimized,0,i)}requestedIntersection[++intersectionLength]=requested[i];intersectionFound=true}}if(!intersectionFound){return null}return[requestedIntersection,optimizedComplement,requestedComplement]}},{"./../support/array-slice":115,"falcor-path-utils":25}],91:[function(require,module,exports){var pathUtils=require("falcor-path-utils");var toTree=pathUtils.toTree;var toPaths=pathUtils.toPaths;module.exports=function flushGetRequest(request,listOfPaths,callback){if(request._count===0){request.requestQueue.removeRequest(request);return}request.sent=true;request.scheduled=false;var pathMap=request._pathMap;var listKeys=Object.keys(listOfPaths);var listIdx=0,listLen=listKeys.length;for(;listIdx<listLen;++listIdx){var paths=listOfPaths[listIdx];for(var j=0,pathLen=paths.length;j<pathLen;++j){var pathSet=paths[j];var len=pathSet.length;if(!pathMap[len]){pathMap[len]=[pathSet]}else{var pathSetsByLength=pathMap[len];pathSetsByLength[pathSetsByLength.length]=pathSet}}}var pathMapKeys=Object.keys(pathMap);var pathMapIdx=0,pathMapLen=pathMapKeys.length;for(;pathMapIdx<pathMapLen;++pathMapIdx){var pathMapKey=pathMapKeys[pathMapIdx];pathMap[pathMapKey]=toTree(pathMap[pathMapKey])}var collapsedPaths=request._collasped=toPaths(pathMap);var jsonGraphData;request.requestQueue.model._source.get(collapsedPaths).subscribe(function(data){jsonGraphData=data;
},function(err){callback(err,jsonGraphData)},function(){callback(null,jsonGraphData)})}},{"falcor-path-utils":25}],92:[function(require,module,exports){var Rx=require("rx/dist/rx")&&require("rx/dist/rx.aggregates");var Observable=Rx.Observable;var CompositeDisposable=Rx.CompositeDisposable;var ModelResponse=require("./../response/ModelResponse");var InvalidSourceError=require("./../errors/InvalidSourceError");var pathSyntax=require("falcor-path-syntax");var $ref=require("./../types/ref");function CallResponse(subscribe){Observable.call(this,subscribe||subscribeToResponse)}CallResponse.create=ModelResponse.create;CallResponse.prototype=Object.create(Observable.prototype);CallResponse.prototype.constructor=CallResponse;CallResponse.prototype.invokeSourceRequest=function invokeSourceRequest(model){return this};CallResponse.prototype.ensureCollect=function ensureCollect(model){return this};CallResponse.prototype.initialize=function initializeResponse(){return this};function toObservable(x){return Rx.Observable.defer(function(){return x})}function subscribeToResponse(observer){var args=this.args;var model=this.model;var callPath=pathSyntax.fromPath(args[0]);var callArgs=args[1]||[];var suffixes=(args[2]||[]).map(pathSyntax.fromPath);var extraPaths=(args[3]||[]).map(pathSyntax.fromPath);var rootModel=model._clone({_path:[]});var localRoot=rootModel.withoutDataSource();var boundPath=model._path;var boundCallPath=boundPath.concat(callPath);var boundThisPath=boundCallPath.slice(0,-1);var setCallValuesObs=toObservable(model.withoutDataSource().get(callPath)).map(function(data){var curr=data.json;var depth=-1;var length=callPath.length;while(curr&&++depth<length){curr=curr[callPath[depth]]}var boundModel=rootModel._derefSync(boundThisPath).boxValues();return{model:boundModel,localFn:curr}}).flatMap(getLocalCallObs).defaultIfEmpty(getRemoteCallObs(model._source)).mergeAll().flatMap(setCallEnvelope);var disposables=new CompositeDisposable;disposables.add(setCallValuesObs.subscribe(function(envelope){var paths=envelope.paths;var invalidated=envelope.invalidated;var innerObs=model.get.apply(model,paths);if(observer.outputFormat==="AsJSONG"){innerObs=toObservable(innerObs._toJSONG()).doAction(function(envelope2){envelope2.invalidated=invalidated})}disposables.add(innerObs.subscribe(observer))},function(e){observer.onError(e)}));return disposables;function getLocalCallObs(tuple){var localFn=tuple&&tuple.localFn;if(typeof localFn==="function"){var localFnModel=tuple.model;var localThisPath=localFnModel._path;var remoteGetValues=localFn.apply(localFnModel,callArgs).reduce(aggregateFnResults,{values:[],references:[],invalidations:[],localThisPath:localThisPath}).flatMap(setLocalValues).flatMap(getRemoteValues);return Observable.return(remoteGetValues)}return Observable.empty();function aggregateFnResults(results,pathValue){if(Boolean(pathValue.invalidated)){results.invalidations.push(results.localThisPath.concat(pathValue.path))}else{var path=pathValue.path;var value=pathValue.value;if(Boolean(value)&&typeof value==="object"&&value.$type===$ref){results.references.push({path:prependThisPath(path),value:pathValue.value})}else{results.values.push({path:prependThisPath(path),value:pathValue.value})}}return results}function setLocalValues(results){var values=results.values.concat(results.references);if(values.length>0){return toObservable(localRoot.set.apply(localRoot,values)._toJSONG()).map(function(envelope){return{results:results,envelope:envelope}})}else{return Observable.return({results:results,envelope:{jsonGraph:{},paths:[]}})}}function getRemoteValues(tuple2){var envelope=tuple2.envelope;var results=tuple2.results;var values=results.values;var references=results.references;var invalidations=results.invalidations;var rootValues=values.map(pluckPath).map(prependThisPath);var rootSuffixes=references.reduce(prependRefToSuffixes,[]);var rootExtraPaths=extraPaths.map(prependThisPath);var rootPaths=rootSuffixes.concat(rootExtraPaths);var envelopeObs;if(rootPaths.length>0){envelopeObs=toObservable(rootModel.get.apply(rootModel,rootValues.concat(rootPaths))._toJSONG())}else{envelopeObs=Observable.return(envelope)}return envelopeObs.doAction(function(envelope2){envelope2.invalidated=invalidations})}function prependRefToSuffixes(refPaths,refPathValue){var refPath=refPathValue.path;refPaths.push.apply(refPaths,suffixes.map(function(pathSuffix){return refPath.concat(pathSuffix)}));return refPaths}function pluckPath(pathValue){return pathValue.path}}function getRemoteCallObs(dataSource){if(dataSource&&typeof dataSource==="object"){return Rx.Observable.defer(function(){var obs;try{obs=dataSource.call(boundCallPath,callArgs,suffixes,extraPaths)}catch(e){obs=Observable.throw(new InvalidSourceError(e))}return obs}).map(invalidateLocalValues)}return Observable.empty();function invalidateLocalValues(envelope){var invalidations=envelope.invalidated;if(invalidations&&invalidations.length){rootModel.invalidate.apply(rootModel,invalidations)}return envelope}}function setCallEnvelope(envelope){return toObservable(localRoot.set(envelope)).reduce(function(acc){return acc},null).map(function(){return{invalidated:envelope.invalidated,paths:envelope.paths.map(function(path){return path.slice(boundPath.length)})}})}function prependThisPath(path){return boundThisPath.concat(path)}}module.exports=CallResponse},{"./../errors/InvalidSourceError":39,"./../response/ModelResponse":95,"./../types/ref":149,"falcor-path-syntax":16,"rx/dist/rx":161,"rx/dist/rx.aggregates":160}],93:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observable=Rx.Observable;var ModelResponse=require("./../response/ModelResponse");var pathSyntax=require("falcor-path-syntax");var getSize=require("./../support/getSize");var collectLru=require("./../lru/collect");var arrayClone=require("./../support/array-clone");var __version=require("./../internal/version");var isArray=Array.isArray;var isPathValue=require("./../support/isPathValue");var isJSONEnvelope=require("./../support/isJSONEnvelope");var isJSONGraphEnvelope=require("./../support/isJSONGraphEnvelope");function IdempotentResponse(subscribe){Observable.call(this,subscribe)}IdempotentResponse.create=ModelResponse.create;IdempotentResponse.prototype=Object.create(Observable.prototype);IdempotentResponse.prototype.constructor=IdempotentResponse;IdempotentResponse.prototype.subscribeCount=0;IdempotentResponse.prototype.subscribeLimit=10;IdempotentResponse.prototype.initialize=function initializeResponse(){var model=this.model;var outputFormat=this.outputFormat||"AsPathMap";var isProgressive=this.isProgressive;var values=[{}];var groups=[];var args=this.args;var group,groupType;var argIndex=-1;var argCount=args.length;while(++argIndex<argCount){var arg=args[argIndex];var argType;if(isArray(arg)||typeof arg==="string"){arg=pathSyntax.fromPath(arg);argType="PathValues"}else if(isPathValue(arg)){arg.path=pathSyntax.fromPath(arg.path);argType="PathValues"}else if(isJSONGraphEnvelope(arg)){argType="JSONGs"}else if(isJSONEnvelope(arg)){argType="PathMaps"}if(groupType!==argType){groupType=argType;group={inputType:argType,arguments:[]};groups.push(group);group.values=values}group.arguments.push(arg)}this.boundPath=arrayClone(model._path);this.groups=groups;this.outputFormat=outputFormat;this.isProgressive=isProgressive;this.isCompleted=false;this.isMaster=model._source==null;this.values=values;return this};IdempotentResponse.prototype.invokeSourceRequest=function invokeSourceRequest(model){return this};IdempotentResponse.prototype.ensureCollect=function ensureCollect(model){var ensured=this.finally(function ensureCollect(){var modelRoot=model._root;var modelCache=modelRoot.cache;modelRoot.collectionScheduler.schedule(function collectThisPass(){collectLru(modelRoot,modelRoot.expired,getSize(modelCache),model._maxSize,model._collectRatio,modelCache[__version])})});return new this.constructor(function(observer){return ensured.subscribe(observer)})};module.exports=IdempotentResponse},{"./../internal/version":77,"./../lru/collect":80,"./../response/ModelResponse":95,"./../support/array-clone":112,"./../support/getSize":119,"./../support/isJSONEnvelope":128,"./../support/isJSONGraphEnvelope":129,"./../support/isPathValue":131,"falcor-path-syntax":16,"rx/dist/rx":161}],94:[function(require,module,exports){var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;var IdempotentResponse=require("./../response/IdempotentResponse");function InvalidateResponse(subscribe){IdempotentResponse.call(this,subscribe||subscribeToInvalidateResponse)}InvalidateResponse.create=IdempotentResponse.create;InvalidateResponse.prototype=Object.create(IdempotentResponse.prototype);InvalidateResponse.prototype.method="invalidate";InvalidateResponse.prototype.constructor=InvalidateResponse;function subscribeToInvalidateResponse(observer){var model=this.model;var method=this.method;var groups=this.groups;var groupIndex=-1;var groupCount=groups.length;while(++groupIndex<groupCount){var group=groups[groupIndex];var inputType=group.inputType;var methodArgs=group.arguments;if(methodArgs.length>0){var operationName="_"+method+inputType+"AsJSON";var operationFunc=model[operationName];operationFunc(model,methodArgs)}}observer.onCompleted();return Disposable.empty}module.exports=InvalidateResponse},{"./../response/IdempotentResponse":93,"rx/dist/rx":161}],95:[function(require,module,exports){var falcor=require("./../");var Rx=require("rx/dist/rx")&&require("rx/dist/rx.aggregates");var Observable=Rx.Observable;var arraySlice=require("./../support/array-slice");var noop=require("./../support/noop");var jsongMixin={outputFormat:{value:"AsJSONG"}};var progressiveMixin={isProgressive:{value:true}};function ModelResponse(subscribe){this._subscribe=subscribe}ModelResponse.create=function create(model,args){var response=new ModelResponse(subscribeToResponse);response.args=args;response.type=this;response.model=model;return response};ModelResponse.prototype=Object.create(Observable.prototype);ModelResponse.prototype.constructor=ModelResponse;ModelResponse.prototype._mixin=function mixin(){var self=this;var mixins=arraySlice(arguments);return new self.constructor(function(observer){return self.subscribe(mixins.reduce(function(proto,mixin2){return Object.create(proto,mixin2)},observer))})};ModelResponse.prototype._toJSONG=function toJSONG(){return this._mixin(jsongMixin)};ModelResponse.prototype.progressively=function progressively(){return this._mixin(progressiveMixin)};ModelResponse.prototype.subscribe=function subscribe(a,b,c){var observer=a;if(!observer||typeof observer!=="object"){observer={onNext:a||noop,onError:b||noop,onCompleted:c||noop}}var subscription=this._subscribe(observer);switch(typeof subscription){case"function":return{dispose:subscription};case"object":return subscription||{dispose:noop};default:return{dispose:noop}}};ModelResponse.prototype.then=function then(onNext,onError){var self=this;return new falcor.Promise(function(resolve,reject){var value,rejected=false;self.toArray().subscribe(function(values){if(values.length<=1){value=values[0]}else{value=values}},function(errors){rejected=true;reject(errors)},function(){if(rejected===false){resolve(value)}})}).then(onNext,onError)};function subscribeToResponse(observer){var model=this.model;var response=new this.type;response.model=model;response.args=this.args;response.outputFormat=observer.outputFormat||"AsPathMap";response.isProgressive=observer.isProgressive||false;response.subscribeCount=0;response.subscribeLimit=observer.retryLimit||10;return response.initialize().invokeSourceRequest(model).ensureCollect(model).subscribe(observer)}module.exports=ModelResponse},{"./../":63,"./../support/array-slice":115,"./../support/noop":135,"rx/dist/rx":161,"rx/dist/rx.aggregates":160}],96:[function(require,module,exports){var Rx=require("rx/dist/rx");var Observable=Rx.Observable;var Disposable=Rx.Disposable;var GetResponse=require("./get/GetResponse");var IdempotentResponse=require("./../response/IdempotentResponse");var InvalidSourceError=require("./../errors/InvalidSourceError");var arrayFlatMap=require("./../support/array-flat-map");var emptyArray=new Array(0);function SetResponse(subscribe){IdempotentResponse.call(this,subscribe||subscribeToSetResponse)}SetResponse.create=IdempotentResponse.create;SetResponse.prototype=Object.create(IdempotentResponse.prototype);SetResponse.prototype.method="set";SetResponse.prototype.constructor=SetResponse;SetResponse.prototype.invokeSourceRequest=function invokeSourceRequest(model){var source=this;var caught=this.catch(function setJSONGraph(results){var requestObs;if(results&&results.invokeSourceRequest===true){var envelope={};var boundPath=model._path;var optimizedPaths=results.optimizedPaths;model._path=emptyArray;model._getPathValuesAsJSONG(model._materialize().withoutDataSource(),optimizedPaths,[envelope]);model._path=boundPath;requestObs=model._request.set(envelope).do(function setResponseEnvelope(envelope2){source.isCompleted=optimizedPaths.length===envelope2.paths.length},function setResponseError(){source.isCompleted=true}).materialize().flatMap(function(notification){if(notification.kind==="C"){return Observable.empty()}if(notification.kind==="E"){var ex=notification.exception;if(InvalidSourceError.is(ex)){return Observable.throw(notification.exception)}}return caught})}else{requestObs=Observable.throw(results)}return requestObs});return new this.constructor(function(observer){return caught.subscribe(observer)})};function subscribeToSetResponse(observer){if(this.isCompleted){return subscribeToFollowupGet.call(this,observer)}return subscribeToLocalSet.call(this,observer)}function subscribeToLocalSet(observer){if(this.subscribeCount++>this.subscribeLimit){observer.onError("Loop kill switch thrown.");return Disposable.empty}var requestedPaths=[];var optimizedPaths=[];var model=this.model;var isMaster=this.isMaster;var modelRoot=model._root;var outputFormat=this.outputFormat;var errorSelector=modelRoot.errorSelector;var method=this.method;var groups=this.groups;var groupIndex=-1;var groupCount=groups.length;while(++groupIndex<groupCount){var group=groups[groupIndex];var inputType=group.inputType;var methodArgs=group.arguments;if(methodArgs.length>0){var operationName="_"+method+inputType+outputFormat;var operationFunc=model[operationName];var successfulPaths=operationFunc(model,methodArgs,null,errorSelector);optimizedPaths.push.apply(optimizedPaths,successfulPaths[1]);if(inputType==="PathValues"){requestedPaths.push.apply(requestedPaths,methodArgs.map(pluckPath))}else if(inputType==="JSONGs"){requestedPaths.push.apply(requestedPaths,arrayFlatMap(methodArgs,pluckEnvelopePaths))}else{requestedPaths.push.apply(requestedPaths,successfulPaths[0])}}}this.requestedPaths=requestedPaths;if(isMaster){this.isCompleted=true;return subscribeToFollowupGet.call(this,observer)}else{observer.onError({method:method,optimizedPaths:optimizedPaths,invokeSourceRequest:true})}}function subscribeToFollowupGet(observer){var response=new GetResponse(this.model,this.requestedPaths);if(this.outputFormat==="AsJSONG"){response=response._toJSONG()}if(this.isProgressive){response=response.progressively()}return response.subscribe(observer)}function pluckPath(pathValue){return pathValue.path}function pluckEnvelopePaths(jsonGraphEnvelope){return jsonGraphEnvelope.paths}module.exports=SetResponse},{"./../errors/InvalidSourceError":39,"./../response/IdempotentResponse":93,"./../support/array-flat-map":113,"./get/GetResponse":98,"rx/dist/rx":161}],97:[function(require,module,exports){var AssignableDisposable=function AssignableDisposable(disosableCallback){this.disposed=false;this.currentDisposable=disosableCallback};AssignableDisposable.prototype={dispose:function dispose(){if(this.disposed||!this.currentDisposable){return}this.disposed=true;var currentDisposable=this.currentDisposable;if(currentDisposable.dispose){currentDisposable.dispose()}else{currentDisposable()}}};module.exports=AssignableDisposable},{}],98:[function(require,module,exports){var ModelResponse=require("./../ModelResponse");var checkCacheAndReport=require("./checkCacheAndReport");var getRequestCycle=require("./getRequestCycle");var empty={dispose:function(){}};var Observable=require("rx/dist/rx").Observable;var GetResponse=module.exports=function GetResponse(model,paths,isJSONGraph,isProgressive){this.model=model;this.currentRemainingPaths=paths;this.isJSONGraph=isJSONGraph||false;this.isProgressive=isProgressive||false};GetResponse.prototype=Object.create(Observable.prototype);GetResponse.prototype.subscribe=ModelResponse.prototype.subscribe;GetResponse.prototype.then=ModelResponse.prototype.then;GetResponse.prototype._toJSONG=function _toJSONGraph(){return new GetResponse(this.model,this.currentRemainingPaths,true,this.isProgressive)};GetResponse.prototype.progressively=function progressively(){return new GetResponse(this.model,this.currentRemainingPaths,this.isJSONGraph,true)};GetResponse.prototype._subscribe=function _subscribe(observer){var seed=[{}];var errors=[];var isJSONG=observer.isJSONG=this.isJSONGraph;var isProgressive=this.isProgressive;var results=checkCacheAndReport(this.model,this.currentRemainingPaths,observer,isProgressive,isJSONG,seed,errors);if(!results){return empty}return getRequestCycle(this,this.model,results,observer,seed,errors,1)}},{"./../ModelResponse":95,"./checkCacheAndReport":99,"./getRequestCycle":100,"rx/dist/rx":161}],99:[function(require,module,exports){var gets=require("./../../get");var getWithPathsAsJSONGraph=gets.getWithPathsAsJSONGraph;var getWithPathsAsPathMap=gets.getWithPathsAsPathMap;module.exports=function checkCacheAndReport(model,requestedPaths,observer,progressive,isJSONG,seed,errors){var results;if(isJSONG){results=getWithPathsAsJSONGraph(model,requestedPaths,seed)}else{results=getWithPathsAsPathMap(model,requestedPaths,seed)}if(results.criticalError){observer.onError(results.criticalError);return null}var hasValues=results.hasValue;var completed=!results.requestedMissingPaths||!model._source;if(results.errors){var errs=results.errors;var errorsLength=errors.length;for(var i=0,len=errs.length;i<len;++i,++errorsLength){errors[errorsLength]=errs[i]}}if(hasValues&&(progressive||completed)){try{++model._root.syncRefCount;observer.onNext(seed[0])}catch(e){throw e}finally{--model._root.syncRefCount}}if(completed){if(errors.length){observer.onError(errors)}else{observer.onCompleted()}return null}return results}},{"./../../get":50}],100:[function(require,module,exports){var checkCacheAndReport=require("./checkCacheAndReport");var MaxRetryExceededError=require("./../../errors/MaxRetryExceededError");var fastCat=require("./../../get/util/support").fastCat;var collectLru=require("./../../lru/collect");var getSize=require("./../../support/getSize");var AssignableDisposable=require("./AssignableDisposable");var __version=require("./../../internal/version");module.exports=function getRequestCycle(getResponse,model,results,observer,seed,errors,count){if(count===10){throw new MaxRetryExceededError}var requestQueue=model._request;var requestedMissingPaths=results.requestedMissingPaths;var optimizedMissingPaths=results.optimizedMissingPaths;var disposable=new AssignableDisposable;var boundRequestedMissingPaths=[];var boundPath=model._path;if(boundPath.length){for(var i=0,len=requestedMissingPaths.length;i<len;++i){boundRequestedMissingPaths[i]=fastCat(boundPath,requestedMissingPaths[i])}}else{boundRequestedMissingPaths=requestedMissingPaths}var currentRequestDisposable=requestQueue.get(boundRequestedMissingPaths,optimizedMissingPaths,function(){var nextResults=checkCacheAndReport(model,requestedMissingPaths,observer,getResponse.isProgressive,getResponse.isJSONGraph,seed,errors);if(nextResults){disposable.currentDisposable=getRequestCycle(getResponse,model,nextResults,observer,seed,errors,count+1)}else{var modelRoot=model._root;var modelCache=modelRoot.cache;var currentVersion=modelCache[__version];collectLru(modelRoot,modelRoot.expired,getSize(modelCache),model._maxSize,model._collectRatio,currentVersion)}});disposable.currentDisposable=currentRequestDisposable;return disposable}},{"./../../errors/MaxRetryExceededError":40,"./../../get/util/support":61,"./../../internal/version":77,"./../../lru/collect":80,"./../../support/getSize":119,"./AssignableDisposable":97,"./checkCacheAndReport":99}],101:[function(require,module,exports){var GetResponse=require("./GetResponse");module.exports=function getWithPaths(paths){return new GetResponse(this,paths)}},{"./GetResponse":98}],102:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var ModelResponse=require("./../ModelResponse");var GET_VALID_INPUT=require("./validInput");var validateInput=require("./../../support/validateInput");var GetResponse=require("./GetResponse");module.exports=function get(){var out=validateInput(arguments,GET_VALID_INPUT,"get");if(out!==true){return new ModelResponse(function(o){o.onError(out)})}var paths=pathSyntax.fromPathsOrPathValues(arguments);return new GetResponse(this,paths)}},{"./../../support/validateInput":145,"./../ModelResponse":95,"./GetResponse":98,"./validInput":103,"falcor-path-syntax":16}],103:[function(require,module,exports){module.exports={path:true,pathSyntax:true}},{}],104:[function(require,module,exports){var asap=require("asap");var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;function ASAPScheduler(){}ASAPScheduler.prototype.schedule=function schedule(action){asap(action);return Disposable.empty};ASAPScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){var self=this;asap(function(){action(self,state)});return Disposable.empty};module.exports=ASAPScheduler},{asap:5,"rx/dist/rx":161}],105:[function(require,module,exports){var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;function ImmediateScheduler(){}ImmediateScheduler.prototype.schedule=function schedule(action){action();return Disposable.empty};ImmediateScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){action(this,state);return Disposable.empty};module.exports=ImmediateScheduler},{"rx/dist/rx":161}],106:[function(require,module,exports){var Rx=require("rx/dist/rx");var Disposable=Rx.Disposable;function TimeoutScheduler(delay){this.delay=delay}TimeoutScheduler.prototype.schedule=function schedule(action){var id=setTimeout(action,this.delay);return Disposable.create(function(){if(id!==void 0){clearTimeout(id);id=void 0}})};TimeoutScheduler.prototype.scheduleWithState=function scheduleWithState(state,action){var self=this;var id=setTimeout(function(){action(self,state)},this.delay);return Disposable.create(function(){if(id!==void 0){clearTimeout(id);id=void 0}})};module.exports=TimeoutScheduler},{"rx/dist/rx":161}],107:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var promote=require("./../lru/promote");var isExpired=require("./../support/isAlreadyExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var mergeJSONGraphNode=require("./../support/mergeJSONGraphNode");module.exports=function setJSONGraphs(model,jsonGraphEnvelopes,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var cache=modelRoot.cache;var initialVersion=cache[__version];var requestedPath=[];var optimizedPath=[];var requestedPaths=[];var optimizedPaths=[];var jsonGraphEnvelopeIndex=-1;var jsonGraphEnvelopeCount=jsonGraphEnvelopes.length;while(++jsonGraphEnvelopeIndex<jsonGraphEnvelopeCount){var jsonGraphEnvelope=jsonGraphEnvelopes[jsonGraphEnvelopeIndex];var paths=jsonGraphEnvelope.paths;var jsonGraph=jsonGraphEnvelope.jsonGraph;var pathIndex=-1;var pathCount=paths.length;while(++pathIndex<pathCount){var path=paths[pathIndex];optimizedPath.index=0;setJSONGraphPathSet(path,0,cache,cache,cache,jsonGraph,jsonGraph,jsonGraph,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setJSONGraphPathSet(path,depth,root,parent,node,messageRoot,messageParent,message,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);var optimizedIndex=optimizedPath.index;do{var results=setNode(root,parent,node,messageRoot,messageParent,message,key,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setJSONGraphPathSet(path,depth+1,root,nextParent,nextNode,messageRoot,results[3],results[2],requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{promote(lru,nextNode);requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}key=iterateKeySet(keySet,note);if(note.done){break}optimizedPath.index=optimizedIndex}while(true)}function setReference(root,node,messageRoot,message,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root,message,messageRoot]}promote(lru,node);var index=0;var container=node;var count=reference.length-1;var parent=node=root;var messageParent=message=messageRoot;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,messageRoot,messageParent,message,key,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1];message=results[2];messageParent=results[3]}while(index++<count);optimizedPath.index=index;if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}return[node,parent,message,messageParent]}function setNode(root,parent,node,messageRoot,messageParent,message,key,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(root,node,messageRoot,message,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];message=results[2];messageParent=results[3];type=node.$type}if(type!==void 0){return[node,parent,message,messageParent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;messageParent=message;node=parent[key];message=messageParent&&messageParent[key]}node=mergeJSONGraphNode(parent,node,message,key,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent,message,messageParent]}},{"./../internal/context":64,"./../internal/key":67,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75,"./../internal/version":77,"./../lru/promote":81,"./../support/expireNode":117,"./../support/incrementVersion":123,"./../support/isAlreadyExpired":125,"./../support/isFunction":127,"./../support/isPrimitive":132,"./../support/mergeJSONGraphNode":133,"./../types/ref":149,"falcor-path-utils":25}],108:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __prefix=require("./../internal/prefix");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var isArray=Array.isArray;var promote=require("./../lru/promote");var hasOwn=require("./../support/hasOwn");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var incrementVersion=require("./../support/incrementVersion");var mergeValueOrInsertBranch=require("./../support/mergeValueOrInsertBranch");module.exports=function setPathMaps(model,pathMapEnvelopes,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var requestedPath=[];var requestedPaths=[];var optimizedPaths=[];var optimizedIndex=bound.length;var pathMapIndex=-1;var pathMapCount=pathMapEnvelopes.length;while(++pathMapIndex<pathMapCount){var pathMapEnvelope=pathMapEnvelopes[pathMapIndex];var optimizedPath=bound.slice(0);optimizedPath.index=optimizedIndex;setPathMap(pathMapEnvelope.json,0,cache,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setPathMap(pathMap,depth,root,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var keys=getKeys(pathMap);if(keys&&keys.length){var keyIndex=0;var keyCount=keys.length;var optimizedIndex=optimizedPath.index;do{var key=keys[keyIndex];var child=pathMap[key];var branch=isObject(child)&&!child.$type;var results=setNode(root,parent,node,key,child,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setPathMap(child,depth+1,root,nextParent,nextNode,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{promote(lru,nextNode);requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}if(++keyIndex>=keyCount){break}optimizedPath.index=optimizedIndex}while(true)}}function setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root;optimizedPath.index=reference.length}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,key,value,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);
node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1]}while(index++<count);optimizedPath.index=index;if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function setNode(root,parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node&&node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}node=mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent]}function getKeys(pathMap){if(isObject(pathMap)&&!pathMap.$type){var keys=[];var itr=0;if(isArray(pathMap)){keys[itr++]="length"}for(var key in pathMap){if(key[0]===__prefix||key[0]==="$"||!hasOwn(pathMap,key)){continue}keys[itr++]=key}return keys}return void 0}},{"./../get/getBoundValue":44,"./../internal/context":64,"./../internal/key":67,"./../internal/parent":70,"./../internal/prefix":71,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75,"./../internal/version":77,"./../lru/promote":81,"./../support/expireNode":117,"./../support/hasOwn":122,"./../support/incrementVersion":123,"./../support/isExpired":126,"./../support/isFunction":127,"./../support/isObject":130,"./../support/isPrimitive":132,"./../support/mergeValueOrInsertBranch":134,"./../types/ref":149}],109:[function(require,module,exports){var __key=require("./../internal/key");var __ref=require("./../internal/ref");var __parent=require("./../internal/parent");var __context=require("./../internal/context");var __version=require("./../internal/version");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");var $ref=require("./../types/ref");var getBoundValue=require("./../get/getBoundValue");var promote=require("./../lru/promote");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var isPrimitive=require("./../support/isPrimitive");var expireNode=require("./../support/expireNode");var iterateKeySet=require("falcor-path-utils").iterateKeySet;var incrementVersion=require("./../support/incrementVersion");var mergeValueOrInsertBranch=require("./../support/mergeValueOrInsertBranch");module.exports=function setPathValues(model,pathValues,x,errorSelector,comparator){var modelRoot=model._root;var lru=modelRoot;var expired=modelRoot.expired;var version=incrementVersion();var bound=model._path;var cache=modelRoot.cache;var node=bound.length?getBoundValue(model,bound).value:cache;var parent=node[__parent]||cache;var initialVersion=cache[__version];var requestedPath=[];var requestedPaths=[];var optimizedPaths=[];var optimizedIndex=bound.length;var pathValueIndex=-1;var pathValueCount=pathValues.length;while(++pathValueIndex<pathValueCount){var pathValue=pathValues[pathValueIndex];var path=pathValue.path;var value=pathValue.value;var optimizedPath=bound.slice(0);optimizedPath.index=optimizedIndex;setPathSet(value,path,0,cache,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}var newVersion=cache[__version];var rootChangeHandler=modelRoot.onChange;if(isFunction(rootChangeHandler)&&initialVersion!==newVersion){rootChangeHandler()}return[requestedPaths,optimizedPaths]};function setPathSet(value,path,depth,root,parent,node,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var note={};var branch=depth<path.length-1;var keySet=path[depth];var key=iterateKeySet(keySet,note);var optimizedIndex=optimizedPath.index;do{var results=setNode(root,parent,node,key,value,branch,false,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);requestedPath[depth]=key;requestedPath.index=depth;optimizedPath[optimizedPath.index++]=key;var nextNode=results[0];var nextParent=results[1];if(nextNode){if(branch){setPathSet(value,path,depth+1,root,nextParent,nextNode,requestedPaths,optimizedPaths,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector)}else{promote(lru,nextNode);requestedPaths.push(requestedPath.slice(0,requestedPath.index+1));optimizedPaths.push(optimizedPath.slice(0,optimizedPath.index))}}key=iterateKeySet(keySet,note);if(note.done){break}optimizedPath.index=optimizedIndex}while(true)}function setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var reference=node.value;optimizedPath.splice(0,optimizedPath.length);optimizedPath.push.apply(optimizedPath,reference);if(isExpired(node)){optimizedPath.index=reference.length;expireNode(node,expired,lru);return[undefined,root]}promote(lru,node);var container=node;var parent=root;node=node[__context];if(node!=null){parent=node[__parent]||root;optimizedPath.index=reference.length}else{var index=0;var count=reference.length-1;parent=node=root;do{var key=reference[index];var branch=index<count;var results=setNode(root,parent,node,key,value,branch,true,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){optimizedPath.index=index;return results}parent=results[1]}while(index++<count);optimizedPath.index=index;if(container[__context]!==node){var backRefs=node[__refsLength]||0;node[__refsLength]=backRefs+1;node[__ref+backRefs]=container;container[__context]=node;container[__refIndex]=backRefs}}return[node,parent]}function setNode(root,parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=node.$type;while(type===$ref){var results=setReference(value,root,node,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);node=results[0];if(isPrimitive(node)){return results}parent=results[1];type=node.$type}if(type!==void 0){return[node,parent]}if(key==null){if(branch){throw new Error("`null` is not allowed in branch key positions.")}else if(node){key=node[__key]}}else{parent=node;node=parent[key]}node=mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector);return[node,parent]}},{"./../get/getBoundValue":44,"./../internal/context":64,"./../internal/key":67,"./../internal/parent":70,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75,"./../internal/version":77,"./../lru/promote":81,"./../support/expireNode":117,"./../support/incrementVersion":123,"./../support/isExpired":126,"./../support/isFunction":127,"./../support/isPrimitive":132,"./../support/mergeValueOrInsertBranch":134,"./../types/ref":149,"falcor-path-utils":25}],110:[function(require,module,exports){var jsong=require("falcor-json-graph");var ModelResponse=require("./../response/ModelResponse");var isPathValue=require("./../support/isPathValue");module.exports=function setValue(pathArg,valueArg){var value=isPathValue(pathArg)?pathArg:jsong.pathValue(pathArg,valueArg);var pathIdx=0;var path=value.path;var pathLen=path.length;while(++pathIdx<pathLen){if(typeof path[pathIdx]==="object"){return new ModelResponse(function(o){o.onError(new Error("Paths must be simple paths"))})}}var self=this;return new ModelResponse(function(obs){return self._set(value).subscribe(function(data){var curr=data.json;var depth=-1;var length=path.length;while(curr&&++depth<length){curr=curr[path[depth]]}obs.onNext(curr)},function(err){obs.onError(err)},function(){obs.onCompleted()})})}},{"./../response/ModelResponse":95,"./../support/isPathValue":131,"falcor-json-graph":12}],111:[function(require,module,exports){var pathSyntax=require("falcor-path-syntax");var isPathValue=require("./../support/isPathValue");var setPathValues=require("./../set/setPathValues");module.exports=function setValueSync(pathArg,valueArg,errorSelectorArg,comparatorArg){var path=pathSyntax.fromPath(pathArg);var value=valueArg;var errorSelector=errorSelectorArg;var comparator=comparatorArg;if(isPathValue(path)){comparator=errorSelector;errorSelector=value;value=path}else{value={path:path,value:value}}if(isPathValue(value)===false){throw new Error("Model#setValueSync must be called with an Array path.")}if(typeof errorSelector!=="function"){errorSelector=this._root._errorSelector}if(typeof comparator!=="function"){comparator=this._root._comparator}if(this._syncCheck("setValueSync")){setPathValues(this,[value]);return this._getValueSync(this,value.path).value}}},{"./../set/setPathValues":109,"./../support/isPathValue":131,"falcor-path-syntax":16}],112:[function(require,module,exports){module.exports=function arrayClone(array){if(!array){return array}var i=-1;var n=array.length;var array2=[];while(++i<n){array2[i]=array[i]}return array2}},{}],113:[function(require,module,exports){module.exports=function arrayFlatMap(array,selector){var index=-1;var i=-1;var n=array.length;var array2=new Array(n);while(++i<n){var array3=selector(array[i],i,array);var j=-1;var k=array3.length;while(++j<k){array2[++index]=array3[j]}}return array2}},{}],114:[function(require,module,exports){module.exports=function arrayMap(array,selector){var i=-1;var n=array.length;var array2=new Array(n);while(++i<n){array2[i]=selector(array[i],i,array)}return array2}},{}],115:[function(require,module,exports){module.exports=function arraySlice(array,indexArg,endArg){var index=indexArg||0;var i=-1;var n=array.length-index;if(n<0){n=0}if(endArg>0&&n>endArg){n=endArg}var array2=new Array(n);while(++i<n){array2[i]=array[i+index]}return array2}},{}],116:[function(require,module,exports){var prefix=require("./../internal/prefix");var hasOwn=require("./../support/hasOwn");var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function clone(value){var dest=value;if(isObject(dest)){dest=isArray(value)?[]:{};var src=value;for(var key in src){if(key[0]===prefix||!hasOwn(src,key)){continue}dest[key]=src[key]}}return dest}},{"./../internal/prefix":71,"./../support/hasOwn":122,"./../support/isObject":130}],117:[function(require,module,exports){var splice=require("./../lru/splice");var __invalidated=require("./../internal/invalidated");module.exports=function expireNode(node,expired,lru){if(!node[__invalidated]){node[__invalidated]=true;expired.push(node);splice(lru,node)}return node}},{"./../internal/invalidated":66,"./../lru/splice":82}],118:[function(require,module,exports){var isObject=require("./isObject");module.exports=function getSize(node){return isObject(node)&&node.$expires||undefined}},{"./isObject":130}],119:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getSize(node){return isObject(node)&&node.$size||0}},{"./../support/isObject":130}],120:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getTimestamp(node){return isObject(node)&&node.$timestamp||undefined}},{"./../support/isObject":130}],121:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function getType(node,anyType){var type=isObject(node)&&node.$type||void 0;if(anyType&&type){return"branch"}return type}},{"./../support/isObject":130}],122:[function(require,module,exports){var isObject=require("./isObject");var hasOwn=Object.prototype.hasOwnProperty;module.exports=function(obj,prop){return isObject(obj)&&hasOwn.call(obj,prop)}},{"./isObject":130}],123:[function(require,module,exports){var version=1;module.exports=function incrementVersion(){return version++}},{}],124:[function(require,module,exports){var __key=require("./../internal/key");var __parent=require("./../internal/parent");var __version=require("./../internal/version");module.exports=function insertNode(node,parent,key,version){node[__key]=key;node[__parent]=parent;node[__version]=version;parent[key]=node;return node}},{"./../internal/key":67,"./../internal/parent":70,"./../internal/version":77}],125:[function(require,module,exports){var now=require("./../support/now");var $now=require("./../values/expires-now");var $never=require("./../values/expires-never");module.exports=function isAlreadyExpired(node){var exp=node.$expires;return exp!=null&&exp!==$never&&exp!==$now&&exp<now()}},{"./../support/now":136,"./../values/expires-never":150,"./../values/expires-now":151}],126:[function(require,module,exports){var now=require("./../support/now");var $now=require("../values/expires-now");var $never=require("../values/expires-never");module.exports=function isExpired(node){var exp=node.$expires;return exp!=null&&exp!==$never&&(exp===$now||exp<now())}},{"../values/expires-never":150,"../values/expires-now":151,"./../support/now":136}],127:[function(require,module,exports){var functionTypeof="function";module.exports=function isFunction(func){return Boolean(func)&&typeof func===functionTypeof}},{}],128:[function(require,module,exports){var isObject=require("./../support/isObject");module.exports=function isJSONEnvelope(envelope){return isObject(envelope)&&"json"in envelope}},{"./../support/isObject":130}],129:[function(require,module,exports){var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function isJSONGraphEnvelope(envelope){return isObject(envelope)&&isArray(envelope.paths)&&(isObject(envelope.jsonGraph)||isObject(envelope.jsong)||isObject(envelope.json)||isObject(envelope.values)||isObject(envelope.value))}},{"./../support/isObject":130}],130:[function(require,module,exports){var objTypeof="object";module.exports=function isObject(value){return value!==null&&typeof value===objTypeof}},{}],131:[function(require,module,exports){var isArray=Array.isArray;var isObject=require("./../support/isObject");module.exports=function isPathValue(pathValue){return isObject(pathValue)&&(isArray(pathValue.path)||typeof pathValue.path==="string")}},{"./../support/isObject":130}],132:[function(require,module,exports){var objTypeof="object";module.exports=function isPrimitive(value){return value==null||typeof value!==objTypeof}},{}],133:[function(require,module,exports){var __key=require("./../internal/key");var __parent=require("./../internal/parent");var $ref=require("./../types/ref");var $error=require("./../types/error");var getSize=require("./../support/getSize");var getTimestamp=require("./../support/getTimestamp");var isObject=require("./../support/isObject");var isExpired=require("./../support/isExpired");var isFunction=require("./../support/isFunction");var promote=require("./../lru/promote");var wrapNode=require("./../support/wrapNode");var insertNode=require("./../support/insertNode");var expireNode=require("./../support/expireNode");var replaceNode=require("./../support/replaceNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");module.exports=function mergeJSONGraphNode(parent,node,message,key,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var sizeOffset;var cType,mType,cIsObject,mIsObject,cTimestamp,mTimestamp;if(node===message){if(message===null){node=wrapNode(message,undefined,message);parent=updateNodeAncestors(parent,-node.$size,lru,version);node=insertNode(node,parent,key);promote(lru,node);return node}else if(message===undefined){return message}else{cIsObject=isObject(node);if(cIsObject){cType=node.$type;if(cType==null){if(node[__parent]==null){node[__key]=key;node[__parent]=parent}return node}}}}else{cIsObject=isObject(node);if(cIsObject){cType=node.$type}}if(cType!==$ref){mIsObject=isObject(message);if(mIsObject){mType=message.$type}if(cIsObject&&!cType){if(message==null||mIsObject&&!mType){return node}}}else{if(message==null){if(isExpired(node)){expireNode(node,expired,lru);return void 0}return node}mIsObject=isObject(message);if(mIsObject){mType=message.$type;if(mType===$ref){if(node===message){if(node[__parent]!=null){return node}}else{cTimestamp=node.$timestamp;mTimestamp=message.$timestamp;if(!isExpired(node)&&!isExpired(message)&&mTimestamp<cTimestamp){return void 0}}}}}if(cType&&mIsObject&&!mType){return insertNode(replaceNode(node,message,parent,key,lru),parent,key)}else if(mType||!mIsObject){if(mType&&node===message){if(node[__parent]==null){node=wrapNode(node,cType,node.value);parent=updateNodeAncestors(parent,-node.$size,lru,version);node=insertNode(node,parent,key,version)}}else{var isDistinct=true;if(cType||!cIsObject){isDistinct=getTimestamp(message)<getTimestamp(node)===false;if((cType||mType)&&isFunction(comparator)){isDistinct=!comparator(node,message,optimizedPath.slice(0,optimizedPath.index))}}if(isDistinct){message=wrapNode(message,mType,mType?message.value:message);if(mType===$error&&isFunction(errorSelector)){message=errorSelector(requestedPath.slice(0,requestedPath.index),message)}sizeOffset=getSize(node)-getSize(message);node=replaceNode(node,message,parent,key,lru);parent=updateNodeAncestors(parent,sizeOffset,lru,version);node=insertNode(node,parent,key,version)}}if(isExpired(node)){expireNode(node,expired,lru)}else{promote(lru,node)}}else if(node==null){node=insertNode(message,parent,key)}return node}},{"./../internal/key":67,"./../internal/parent":70,"./../lru/promote":81,"./../support/expireNode":117,"./../support/getSize":119,"./../support/getTimestamp":120,"./../support/insertNode":124,"./../support/isExpired":126,"./../support/isFunction":127,"./../support/isObject":130,"./../support/replaceNode":139,"./../support/updateNodeAncestors":144,"./../support/wrapNode":146,"./../types/error":148,"./../types/ref":149}],134:[function(require,module,exports){var $ref=require("./../types/ref");var $error=require("./../types/error");var getType=require("./../support/getType");var getSize=require("./../support/getSize");var getTimestamp=require("./../support/getTimestamp");var isExpired=require("./../support/isExpired");var isPrimitive=require("./../support/isPrimitive");var isFunction=require("./../support/isFunction");var wrapNode=require("./../support/wrapNode");var expireNode=require("./../support/expireNode");var insertNode=require("./../support/insertNode");var replaceNode=require("./../support/replaceNode");var updateNodeAncestors=require("./../support/updateNodeAncestors");var updateBackReferenceVersions=require("./../support/updateBackReferenceVersions");module.exports=function mergeValueOrInsertBranch(parent,node,key,value,branch,reference,requestedPath,optimizedPath,version,expired,lru,comparator,errorSelector){var type=getType(node,reference);if(branch||reference){if(type&&isExpired(node)){type="expired";expireNode(node,expired,lru)}if(type&&type!==$ref||isPrimitive(node)){node=replaceNode(node,{},parent,key,lru);node=insertNode(node,parent,key,version);node=updateBackReferenceVersions(node,version)}}else{var message=value;var mType=getType(message);var isDistinct=getTimestamp(message)<getTimestamp(node)===false;if((type||mType)&&isFunction(comparator)){isDistinct=!comparator(node,message,optimizedPath.slice(0,optimizedPath.index))}if(isDistinct){message=wrapNode(message,mType,mType?message.value:message);if(mType===$error&&isFunction(errorSelector)){message=errorSelector(requestedPath.slice(0,requestedPath.index),message)}var sizeOffset=getSize(node)-getSize(message);node=replaceNode(node,message,parent,key,lru);parent=updateNodeAncestors(parent,sizeOffset,lru,version);node=insertNode(node,parent,key,version)}}return node}},{"./../support/expireNode":117,"./../support/getSize":119,"./../support/getTimestamp":120,"./../support/getType":121,"./../support/insertNode":124,"./../support/isExpired":126,"./../support/isFunction":127,"./../support/isPrimitive":132,"./../support/replaceNode":139,"./../support/updateBackReferenceVersions":143,"./../support/updateNodeAncestors":144,"./../support/wrapNode":146,"./../types/error":148,"./../types/ref":149}],135:[function(require,module,exports){module.exports=function noop(){}},{}],136:[function(require,module,exports){module.exports=Date.now},{}],137:[function(require,module,exports){var $ref=require("./../types/ref");var __parent=require("./../internal/parent");var splice=require("./../lru/splice");var isObject=require("./../support/isObject");var unlinkBackReferences=require("./../support/unlinkBackReferences");var unlinkForwardReference=require("./../support/unlinkForwardReference");module.exports=function removeNode(node,parent,key,lru){if(isObject(node)){var type=node.$type;if(Boolean(type)){if(type===$ref){unlinkForwardReference(node)}splice(lru,node)}unlinkBackReferences(node);parent[key]=node[__parent]=void 0;return true}return false}},{"./../internal/parent":70,"./../lru/splice":82,"./../support/isObject":130,"./../support/unlinkBackReferences":141,"./../support/unlinkForwardReference":142,"./../types/ref":149}],138:[function(require,module,exports){var hasOwn=require("./../support/hasOwn");var prefix=require("./../internal/prefix");var removeNode=require("./../support/removeNode");module.exports=function removeNodeAndDescendants(node,parent,key,lru){if(removeNode(node,parent,key,lru)){if(node.$type==null){for(var key2 in node){if(key2[0]!==prefix&&key2[0]!=="$"&&hasOwn(node,key2)){removeNodeAndDescendants(node[key2],node,key2,lru)}}}return true}return false}},{"./../internal/prefix":71,"./../support/hasOwn":122,"./../support/removeNode":137}],139:[function(require,module,exports){var isObject=require("./../support/isObject");var transferBackReferences=require("./../support/transferBackReferences");var removeNodeAndDescendants=require("./../support/removeNodeAndDescendants");module.exports=function replaceNode(node,replacement,parent,key,lru){if(node===replacement){return node}else if(isObject(node)){transferBackReferences(node,replacement);removeNodeAndDescendants(node,parent,key,lru)}parent[key]=replacement;return replacement}},{"./../support/isObject":130,"./../support/removeNodeAndDescendants":138,"./../support/transferBackReferences":140}],140:[function(require,module,exports){var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __refsLength=require("./../internal/refs-length");module.exports=function transferBackReferences(fromNode,destNode){var fromNodeRefsLength=fromNode[__refsLength]||0,destNodeRefsLength=destNode[__refsLength]||0,i=-1;while(++i<fromNodeRefsLength){var ref=fromNode[__ref+i];if(ref!==void 0){ref[__context]=destNode;destNode[__ref+(destNodeRefsLength+i)]=ref;fromNode[__ref+i]=void 0}}destNode[__refsLength]=fromNodeRefsLength+destNodeRefsLength;fromNode[__refsLength]=void 0;return destNode}},{"./../internal/context":64,"./../internal/ref":74,"./../internal/refs-length":75}],141:[function(require,module,exports){var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");module.exports=function unlinkBackReferences(node){var i=-1,n=node[__refsLength]||0;while(++i<n){var ref=node[__ref+i];if(ref!=null){ref[__context]=ref[__refIndex]=node[__ref+i]=void 0}}node[__refsLength]=void 0;return node}},{"./../internal/context":64,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75}],142:[function(require,module,exports){var __ref=require("./../internal/ref");var __context=require("./../internal/context");var __refIndex=require("./../internal/ref-index");var __refsLength=require("./../internal/refs-length");module.exports=function unlinkForwardReference(reference){var destination=reference[__context];if(destination){var i=(reference[__refIndex]||0)-1,n=(destination[__refsLength]||0)-1;while(++i<=n){destination[__ref+i]=destination[__ref+(i+1)]}destination[__refsLength]=n;reference[__refIndex]=reference[__context]=destination=void 0}return reference}},{"./../internal/context":64,"./../internal/ref":74,"./../internal/ref-index":73,"./../internal/refs-length":75}],143:[function(require,module,exports){var __ref=require("./../internal/ref");var __parent=require("./../internal/parent");var __version=require("./../internal/version");var __refsLength=require("./../internal/refs-length");module.exports=function updateBackReferenceVersions(nodeArg,version){var stack=[nodeArg];var count=0;do{var node=stack[count--];if(node&&node[__version]!==version){node[__version]=version;stack[count++]=node[__parent];var i=-1;var n=node[__refsLength]||0;while(++i<n){stack[count++]=node[__ref+i]}}}while(count>-1);return nodeArg}},{"./../internal/parent":70,"./../internal/ref":74,"./../internal/refs-length":75,"./../internal/version":77}],144:[function(require,module,exports){var __key=require("./../internal/key");var __version=require("./../internal/version");var __parent=require("./../internal/parent");var removeNode=require("./../support/removeNode");var updateBackReferenceVersions=require("./../support/updateBackReferenceVersions");module.exports=function updateNodeAncestors(nodeArg,offset,lru,version){var child=nodeArg;do{var node=child[__parent];var size=child.$size=(child.$size||0)-offset;if(size<=0&&node!=null){removeNode(child,node,child[__key],lru)}else if(child[__version]!==version){updateBackReferenceVersions(child,version)}child=node}while(child);return nodeArg}},{"./../internal/key":67,"./../internal/parent":70,"./../internal/version":77,"./../support/removeNode":137,"./../support/updateBackReferenceVersions":143}],145:[function(require,module,exports){var isArray=Array.isArray;var isPathValue=require("./../support/isPathValue");var isJSONGraphEnvelope=require("./../support/isJSONGraphEnvelope");var isJSONEnvelope=require("./../support/isJSONEnvelope");var pathSyntax=require("falcor-path-syntax");module.exports=function validateInput(args,allowedInput,method){for(var i=0,len=args.length;i<len;++i){var arg=args[i];var valid=false;if(isArray(arg)&&allowedInput.path){valid=true}else if(typeof arg==="string"&&allowedInput.pathSyntax){valid=true}else if(isPathValue(arg)&&allowedInput.pathValue){arg.path=pathSyntax.fromPath(arg.path);valid=true}else if(isJSONGraphEnvelope(arg)&&allowedInput.jsonGraph){valid=true}else if(isJSONEnvelope(arg)&&allowedInput.json){valid=true}else if(typeof arg==="function"&&i+1===len&&allowedInput.selector){valid=true}if(!valid){return new Error("Unrecognized argument "+typeof arg+" ["+String(arg)+"] "+"to Model#"+method+"")}}return true}},{"./../support/isJSONEnvelope":128,"./../support/isJSONGraphEnvelope":129,"./../support/isPathValue":131,"falcor-path-syntax":16}],146:[function(require,module,exports){var jsong=require("falcor-json-graph");var $atom=jsong.atom;var now=require("./../support/now");var expiresNow=require("../values/expires-now");var __modelCreated=require("./../internal/model-created");var atomSize=50;var clone=require("./../support/clone");var isArray=Array.isArray;var getSize=require("./../support/getSize");var getExpires=require("./../support/getExpires");module.exports=function wrapNode(nodeArg,typeArg,value){var size=0;var node=nodeArg;var type=typeArg;if(type){node=clone(node);size=getSize(node);node.$type=type}else{node=$atom(value);type=node.$type;node[__modelCreated]=true}if(value==null){size=atomSize+1}else if(size==null||size<=0){switch(typeof value){case"object":if(isArray(value)){size=atomSize+value.length}else{size=atomSize+1}break;case"string":size=atomSize+value.length;break;default:size=atomSize+1;break}}var expires=getExpires(node);if(typeof expires==="number"&&expires<expiresNow){node.$expires=now()+expires*-1}node.$size=size;return node}},{"../values/expires-now":151,"./../internal/model-created":68,"./../support/clone":116,"./../support/getExpires":118,"./../support/getSize":119,"./../support/now":136,"falcor-json-graph":12}],147:[function(require,module,exports){module.exports="atom"},{}],148:[function(require,module,exports){module.exports="error"},{}],149:[function(require,module,exports){module.exports="ref"},{}],150:[function(require,module,exports){module.exports=1},{}],151:[function(require,module,exports){module.exports=0},{}],152:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],153:[function(require,module,exports){"use strict";module.exports=require("./lib")},{"./lib":158}],154:[function(require,module,exports){"use strict";var asap=require("asap/raw");function noop(){}var LAST_ERROR=null;var IS_ERROR={};function getThen(obj){try{return obj.then}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallOne(fn,a){try{return fn(a)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}function tryCallTwo(fn,a,b){try{fn(a,b)}catch(ex){LAST_ERROR=ex;return IS_ERROR}}module.exports=Promise;function Promise(fn){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof fn!=="function"){throw new TypeError("not a function")}this._37=0;this._12=null;this._59=[];if(fn===noop)return;doResolve(fn,this)}Promise._99=noop;Promise.prototype.then=function(onFulfilled,onRejected){if(this.constructor!==Promise){return safeThen(this,onFulfilled,onRejected)}var res=new Promise(noop);handle(this,new Handler(onFulfilled,onRejected,res));return res};function safeThen(self,onFulfilled,onRejected){return new self.constructor(function(resolve,reject){var res=new Promise(noop);res.then(resolve,reject);handle(self,new Handler(onFulfilled,onRejected,res))})}function handle(self,deferred){while(self._37===3){self=self._12}if(self._37===0){self._59.push(deferred);return}asap(function(){var cb=self._37===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){if(self._37===1){resolve(deferred.promise,self._12)}else{reject(deferred.promise,self._12)}return}var ret=tryCallOne(cb,self._12);if(ret===IS_ERROR){reject(deferred.promise,LAST_ERROR)}else{resolve(deferred.promise,ret)}})}function resolve(self,newValue){if(newValue===self){return reject(self,new TypeError("A promise cannot be resolved with itself."))}if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=getThen(newValue);if(then===IS_ERROR){return reject(self,LAST_ERROR)}if(then===self.then&&newValue instanceof Promise){self._37=3;self._12=newValue;finale(self);return}else if(typeof then==="function"){doResolve(then.bind(newValue),self);return}}self._37=1;self._12=newValue;finale(self)}function reject(self,newValue){
self._37=2;self._12=newValue;finale(self)}function finale(self){for(var i=0;i<self._59.length;i++){handle(self,self._59[i])}self._59=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,promise){var done=false;var res=tryCallTwo(fn,function(value){if(done)return;done=true;resolve(promise,value)},function(reason){if(done)return;done=true;reject(promise,reason)});if(!done&&res===IS_ERROR){done=true;reject(promise,LAST_ERROR)}}},{"asap/raw":6}],155:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){setTimeout(function(){throw err},0)})}},{"./core.js":154}],156:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;var TRUE=valuePromise(true);var FALSE=valuePromise(false);var NULL=valuePromise(null);var UNDEFINED=valuePromise(undefined);var ZERO=valuePromise(0);var EMPTYSTRING=valuePromise("");function valuePromise(value){var p=new Promise(Promise._99);p._37=1;p._12=value;return p}Promise.resolve=function(value){if(value instanceof Promise)return value;if(value===null)return NULL;if(value===undefined)return UNDEFINED;if(value===true)return TRUE;if(value===false)return FALSE;if(value===0)return ZERO;if(value==="")return EMPTYSTRING;if(typeof value==="object"||typeof value==="function"){try{var then=value.then;if(typeof then==="function"){return new Promise(then.bind(value))}}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}}return valuePromise(value)};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){if(val&&(typeof val==="object"||typeof val==="function")){if(val instanceof Promise&&val.then===Promise.prototype.then){while(val._37===3){val=val._12}if(val._37===1)return res(i,val._12);if(val._37===2)reject(val._12);val.then(function(val){res(i,val)},reject);return}else{var then=val.then;if(typeof then==="function"){var p=new Promise(then.bind(val));p.then(function(val){res(i,val)},reject);return}}}args[i]=val;if(--remaining===0){resolve(args)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})};Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}},{"./core.js":154}],157:[function(require,module,exports){"use strict";var Promise=require("./core.js");module.exports=Promise;Promise.prototype["finally"]=function(f){return this.then(function(value){return Promise.resolve(f()).then(function(){return value})},function(err){return Promise.resolve(f()).then(function(){throw err})})}},{"./core.js":154}],158:[function(require,module,exports){"use strict";module.exports=require("./core.js");require("./done.js");require("./finally.js");require("./es6-extensions.js");require("./node-extensions.js")},{"./core.js":154,"./done.js":155,"./es6-extensions.js":156,"./finally.js":157,"./node-extensions.js":159}],159:[function(require,module,exports){"use strict";var Promise=require("./core.js");var asap=require("asap");module.exports=Promise;Promise.denodeify=function(fn,argumentCount){argumentCount=argumentCount||Infinity;return function(){var self=this;var args=Array.prototype.slice.call(arguments,0,argumentCount>0?argumentCount:0);return new Promise(function(resolve,reject){args.push(function(err,res){if(err)reject(err);else resolve(res)});var res=fn.apply(self,args);if(res&&(typeof res==="object"||typeof res==="function")&&typeof res.then==="function"){resolve(res)}})}};Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments);var callback=typeof args[args.length-1]==="function"?args.pop():null;var ctx=this;try{return fn.apply(this,arguments).nodeify(callback,ctx)}catch(ex){if(callback===null||typeof callback=="undefined"){return new Promise(function(resolve,reject){reject(ex)})}else{asap(function(){callback.call(ctx,ex)})}}}};Promise.prototype.nodeify=function(callback,ctx){if(typeof callback!="function")return this;this.then(function(value){asap(function(){callback.call(ctx,null,value)})},function(err){asap(function(){callback.call(ctx,err)})})}},{"./core.js":154,asap:5}],160:[function(require,module,exports){(function(global){(function(factory){var objectTypes={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false};var root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal}if(typeof define==="function"&&define.amd){define(["rx"],function(Rx,exports){return factory(root,exports,Rx)})}else if(typeof module==="object"&&module&&module.exports===freeExports){module.exports=factory(root,module.exports,require("./rx"))}else{root.Rx=factory(root,{},root.Rx)}}).call(this,function(root,exp,Rx,undefined){var Observable=Rx.Observable,observableProto=Observable.prototype,CompositeDisposable=Rx.CompositeDisposable,AnonymousObservable=Rx.AnonymousObservable,disposableEmpty=Rx.Disposable.empty,isEqual=Rx.internals.isEqual,helpers=Rx.helpers,not=helpers.not,defaultComparer=helpers.defaultComparer,identity=helpers.identity,defaultSubComparer=helpers.defaultSubComparer,isFunction=helpers.isFunction,isPromise=helpers.isPromise,isArrayLike=helpers.isArrayLike,isIterable=helpers.isIterable,inherits=Rx.internals.inherits,observableFromPromise=Observable.fromPromise,observableFrom=Observable.from,bindCallback=Rx.internals.bindCallback,EmptyError=Rx.EmptyError,ObservableBase=Rx.ObservableBase,ArgumentOutOfRangeError=Rx.ArgumentOutOfRangeError;var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){if(!isFunction(fn)){throw new TypeError("fn must be a function")}tryCatchTarget=fn;return tryCatcher}function thrower(e){throw e}function extremaBy(source,keySelector,comparer){return new AnonymousObservable(function(o){var hasValue=false,lastKey=null,list=[];return source.subscribe(function(x){var comparison,key;try{key=keySelector(x)}catch(ex){o.onError(ex);return}comparison=0;if(!hasValue){hasValue=true;lastKey=key}else{try{comparison=comparer(key,lastKey)}catch(ex1){o.onError(ex1);return}}if(comparison>0){lastKey=key;list=[]}if(comparison>=0){list.push(x)}},function(e){o.onError(e)},function(){o.onNext(list);o.onCompleted()})},source)}function firstOnly(x){if(x.length===0){throw new EmptyError}return x[0]}observableProto.aggregate=function(){var hasSeed=false,accumulator,seed,source=this;if(arguments.length===2){hasSeed=true;seed=arguments[0];accumulator=arguments[1]}else{accumulator=arguments[0]}return new AnonymousObservable(function(o){var hasAccumulation,accumulation,hasValue;return source.subscribe(function(x){!hasValue&&(hasValue=true);try{if(hasAccumulation){accumulation=accumulator(accumulation,x)}else{accumulation=hasSeed?accumulator(seed,x):x;hasAccumulation=true}}catch(e){return o.onError(e)}},function(e){o.onError(e)},function(){hasValue&&o.onNext(accumulation);!hasValue&&hasSeed&&o.onNext(seed);!hasValue&&!hasSeed&&o.onError(new EmptyError);o.onCompleted()})},source)};var ReduceObservable=function(__super__){inherits(ReduceObservable,__super__);function ReduceObservable(source,acc,hasSeed,seed){this.source=source;this.acc=acc;this.hasSeed=hasSeed;this.seed=seed;__super__.call(this)}ReduceObservable.prototype.subscribeCore=function(observer){return this.source.subscribe(new InnerObserver(observer,this))};function InnerObserver(o,parent){this.o=o;this.acc=parent.acc;this.hasSeed=parent.hasSeed;this.seed=parent.seed;this.hasAccumulation=false;this.result=null;this.hasValue=false;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}!this.hasValue&&(this.hasValue=true);if(this.hasAccumulation){this.result=tryCatch(this.acc)(this.result,x)}else{this.result=this.hasSeed?tryCatch(this.acc)(this.seed,x):x;this.hasAccumulation=true}if(this.result===errorObj){this.o.onError(this.result.e)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.hasValue&&this.o.onNext(this.result);!this.hasValue&&this.hasSeed&&this.o.onNext(this.seed);!this.hasValue&&!this.hasSeed&&this.o.onError(new EmptyError);this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return ReduceObservable}(ObservableBase);observableProto.reduce=function(accumulator){var hasSeed=false;if(arguments.length===2){hasSeed=true;var seed=arguments[1]}return new ReduceObservable(this,accumulator,hasSeed,seed)};observableProto.some=function(predicate,thisArg){var source=this;return predicate?source.filter(predicate,thisArg).some():new AnonymousObservable(function(observer){return source.subscribe(function(){observer.onNext(true);observer.onCompleted()},function(e){observer.onError(e)},function(){observer.onNext(false);observer.onCompleted()})},source)};observableProto.any=function(){return this.some.apply(this,arguments)};observableProto.isEmpty=function(){return this.any().map(not)};observableProto.every=function(predicate,thisArg){return this.filter(function(v){return!predicate(v)},thisArg).some().map(not)};observableProto.all=function(){return this.every.apply(this,arguments)};observableProto.includes=function(searchElement,fromIndex){var source=this;function comparer(a,b){return a===0&&b===0||(a===b||isNaN(a)&&isNaN(b))}return new AnonymousObservable(function(o){var i=0,n=+fromIndex||0;Math.abs(n)===Infinity&&(n=0);if(n<0){o.onNext(false);o.onCompleted();return disposableEmpty}return source.subscribe(function(x){if(i++>=n&&comparer(x,searchElement)){o.onNext(true);o.onCompleted()}},function(e){o.onError(e)},function(){o.onNext(false);o.onCompleted()})},this)};observableProto.contains=function(searchElement,fromIndex){observableProto.includes(searchElement,fromIndex)};observableProto.count=function(predicate,thisArg){return predicate?this.filter(predicate,thisArg).count():this.reduce(function(count){return count+1},0)};observableProto.indexOf=function(searchElement,fromIndex){var source=this;return new AnonymousObservable(function(o){var i=0,n=+fromIndex||0;Math.abs(n)===Infinity&&(n=0);if(n<0){o.onNext(-1);o.onCompleted();return disposableEmpty}return source.subscribe(function(x){if(i>=n&&x===searchElement){o.onNext(i);o.onCompleted()}i++},function(e){o.onError(e)},function(){o.onNext(-1);o.onCompleted()})},source)};observableProto.sum=function(keySelector,thisArg){return keySelector&&isFunction(keySelector)?this.map(keySelector,thisArg).sum():this.reduce(function(prev,curr){return prev+curr},0)};observableProto.minBy=function(keySelector,comparer){comparer||(comparer=defaultSubComparer);return extremaBy(this,keySelector,function(x,y){return comparer(x,y)*-1})};observableProto.min=function(comparer){return this.minBy(identity,comparer).map(function(x){return firstOnly(x)})};observableProto.maxBy=function(keySelector,comparer){comparer||(comparer=defaultSubComparer);return extremaBy(this,keySelector,comparer)};observableProto.max=function(comparer){return this.maxBy(identity,comparer).map(function(x){return firstOnly(x)})};observableProto.average=function(keySelector,thisArg){return keySelector&&isFunction(keySelector)?this.map(keySelector,thisArg).average():this.reduce(function(prev,cur){return{sum:prev.sum+cur,count:prev.count+1}},{sum:0,count:0}).map(function(s){if(s.count===0){throw new EmptyError}return s.sum/s.count})};observableProto.sequenceEqual=function(second,comparer){var first=this;comparer||(comparer=defaultComparer);return new AnonymousObservable(function(o){var donel=false,doner=false,ql=[],qr=[];var subscription1=first.subscribe(function(x){var equal,v;if(qr.length>0){v=qr.shift();try{equal=comparer(v,x)}catch(e){o.onError(e);return}if(!equal){o.onNext(false);o.onCompleted()}}else if(doner){o.onNext(false);o.onCompleted()}else{ql.push(x)}},function(e){o.onError(e)},function(){donel=true;if(ql.length===0){if(qr.length>0){o.onNext(false);o.onCompleted()}else if(doner){o.onNext(true);o.onCompleted()}}});(isArrayLike(second)||isIterable(second))&&(second=observableFrom(second));isPromise(second)&&(second=observableFromPromise(second));var subscription2=second.subscribe(function(x){var equal;if(ql.length>0){var v=ql.shift();try{equal=comparer(v,x)}catch(exception){o.onError(exception);return}if(!equal){o.onNext(false);o.onCompleted()}}else if(donel){o.onNext(false);o.onCompleted()}else{qr.push(x)}},function(e){o.onError(e)},function(){doner=true;if(qr.length===0){if(ql.length>0){o.onNext(false);o.onCompleted()}else if(donel){o.onNext(true);o.onCompleted()}}});return new CompositeDisposable(subscription1,subscription2)},first)};function elementAtOrDefault(source,index,hasDefault,defaultValue){if(index<0){throw new ArgumentOutOfRangeError}return new AnonymousObservable(function(o){var i=index;return source.subscribe(function(x){if(i--===0){o.onNext(x);o.onCompleted()}},function(e){o.onError(e)},function(){if(!hasDefault){o.onError(new ArgumentOutOfRangeError)}else{o.onNext(defaultValue);o.onCompleted()}})},source)}observableProto.elementAt=function(index){return elementAtOrDefault(this,index,false)};observableProto.elementAtOrDefault=function(index,defaultValue){return elementAtOrDefault(this,index,true,defaultValue)};function singleOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(o){var value=defaultValue,seenValue=false;return source.subscribe(function(x){if(seenValue){o.onError(new Error("Sequence contains more than one element"))}else{value=x;seenValue=true}},function(e){o.onError(e)},function(){if(!seenValue&&!hasDefault){o.onError(new EmptyError)}else{o.onNext(value);o.onCompleted()}})},source)}observableProto.single=function(predicate,thisArg){return predicate&&isFunction(predicate)?this.where(predicate,thisArg).single():singleOrDefaultAsync(this,false)};observableProto.singleOrDefault=function(predicate,defaultValue,thisArg){return predicate&&isFunction(predicate)?this.filter(predicate,thisArg).singleOrDefault(null,defaultValue):singleOrDefaultAsync(this,true,defaultValue)};function firstOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(o){return source.subscribe(function(x){o.onNext(x);o.onCompleted()},function(e){o.onError(e)},function(){if(!hasDefault){o.onError(new EmptyError)}else{o.onNext(defaultValue);o.onCompleted()}})},source)}observableProto.first=function(predicate,thisArg){return predicate?this.where(predicate,thisArg).first():firstOrDefaultAsync(this,false)};observableProto.firstOrDefault=function(predicate,defaultValue,thisArg){return predicate?this.where(predicate).firstOrDefault(null,defaultValue):firstOrDefaultAsync(this,true,defaultValue)};function lastOrDefaultAsync(source,hasDefault,defaultValue){return new AnonymousObservable(function(o){var value=defaultValue,seenValue=false;return source.subscribe(function(x){value=x;seenValue=true},function(e){o.onError(e)},function(){if(!seenValue&&!hasDefault){o.onError(new EmptyError)}else{o.onNext(value);o.onCompleted()}})},source)}observableProto.last=function(predicate,thisArg){return predicate?this.where(predicate,thisArg).last():lastOrDefaultAsync(this,false)};observableProto.lastOrDefault=function(predicate,defaultValue,thisArg){return predicate?this.where(predicate,thisArg).lastOrDefault(null,defaultValue):lastOrDefaultAsync(this,true,defaultValue)};function findValue(source,predicate,thisArg,yieldIndex){var callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){var i=0;return source.subscribe(function(x){var shouldRun;try{shouldRun=callback(x,i,source)}catch(e){o.onError(e);return}if(shouldRun){o.onNext(yieldIndex?i:x);o.onCompleted()}else{i++}},function(e){o.onError(e)},function(){o.onNext(yieldIndex?-1:undefined);o.onCompleted()})},source)}observableProto.find=function(predicate,thisArg){return findValue(this,predicate,thisArg,false)};observableProto.findIndex=function(predicate,thisArg){return findValue(this,predicate,thisArg,true)};observableProto.toSet=function(){if(typeof root.Set==="undefined"){throw new TypeError}var source=this;return new AnonymousObservable(function(o){var s=new root.Set;return source.subscribe(function(x){s.add(x)},function(e){o.onError(e)},function(){o.onNext(s);o.onCompleted()})},source)};observableProto.toMap=function(keySelector,elementSelector){if(typeof root.Map==="undefined"){throw new TypeError}var source=this;return new AnonymousObservable(function(o){var m=new root.Map;return source.subscribe(function(x){var key;try{key=keySelector(x)}catch(e){o.onError(e);return}var element=x;if(elementSelector){try{element=elementSelector(x)}catch(e){o.onError(e);return}}m.set(key,element)},function(e){o.onError(e)},function(){o.onNext(m);o.onCompleted()})},source)};return Rx})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./rx":161}],161:[function(require,module,exports){(function(process,global){(function(undefined){var objectTypes={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false};var root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal}var Rx={internals:{},config:{Promise:root.Promise},helpers:{}};var noop=Rx.helpers.noop=function(){},notDefined=Rx.helpers.notDefined=function(x){return typeof x==="undefined"},identity=Rx.helpers.identity=function(x){return x},pluck=Rx.helpers.pluck=function(property){return function(x){return x[property]}},just=Rx.helpers.just=function(value){return function(){return value}},defaultNow=Rx.helpers.defaultNow=Date.now,defaultComparer=Rx.helpers.defaultComparer=function(x,y){return isEqual(x,y)},defaultSubComparer=Rx.helpers.defaultSubComparer=function(x,y){return x>y?1:x<y?-1:0},defaultKeySerializer=Rx.helpers.defaultKeySerializer=function(x){return x.toString()},defaultError=Rx.helpers.defaultError=function(err){throw err},isPromise=Rx.helpers.isPromise=function(p){return!!p&&typeof p.subscribe!=="function"&&typeof p.then==="function"},asArray=Rx.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},not=Rx.helpers.not=function(a){return!a},isFunction=Rx.helpers.isFunction=function(){var isFn=function(value){return typeof value=="function"||false};if(isFn(/x/)){isFn=function(value){return typeof value=="function"&&toString.call(value)=="[object Function]"}}return isFn}();function cloneArray(arr){for(var a=[],i=0,len=arr.length;i<len;i++){a.push(arr[i])}return a}Rx.config.longStackSupport=false;var hasStacks=false;try{throw new Error}catch(e){hasStacks=!!e.stack}var rStartingLine=captureLine(),rFileName;var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,observable){if(hasStacks&&observable.stack&&typeof error==="object"&&error!==null&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){var stacks=[];for(var o=observable;!!o;o=o.source){if(o.stack){stacks.unshift(o.stack)}}stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){var lines=stackString.split("\n"),desiredLines=[];for(var i=0,len=lines.length;i<len;i++){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line)}}return desiredLines.join("\n")}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false}var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===rFileName&&lineNumber>=rStartingLine&&lineNumber<=rEndingLine}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function captureLine(){if(!hasStacks){return}try{throw new Error}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return}rFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1]}}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])]}var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])]}var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])]}}var EmptyError=Rx.EmptyError=function(){this.message="Sequence contains no elements.";Error.call(this)};EmptyError.prototype=Error.prototype;var ObjectDisposedError=Rx.ObjectDisposedError=function(){this.message="Object has been disposed";Error.call(this)};ObjectDisposedError.prototype=Error.prototype;var ArgumentOutOfRangeError=Rx.ArgumentOutOfRangeError=function(){this.message="Argument out of range";Error.call(this)};ArgumentOutOfRangeError.prototype=Error.prototype;var NotSupportedError=Rx.NotSupportedError=function(message){this.message=message||"This operation is not supported";Error.call(this)};NotSupportedError.prototype=Error.prototype;var NotImplementedError=Rx.NotImplementedError=function(message){this.message=message||"This operation is not implemented";Error.call(this)};NotImplementedError.prototype=Error.prototype;var notImplemented=Rx.helpers.notImplemented=function(){throw new NotImplementedError};var notSupported=Rx.helpers.notSupported=function(){throw new NotSupportedError};var $iterator$=typeof Symbol==="function"&&Symbol.iterator||"_es6shim_iterator_";if(root.Set&&typeof(new root.Set)["@@iterator"]==="function"){$iterator$="@@iterator"}var doneEnumerator=Rx.doneEnumerator={done:true,value:undefined};var isIterable=Rx.helpers.isIterable=function(o){return o[$iterator$]!==undefined};var isArrayLike=Rx.helpers.isArrayLike=function(o){return o&&o.length!==undefined};Rx.helpers.iterator=$iterator$;var bindCallback=Rx.internals.bindCallback=function(func,thisArg,argCount){if(typeof thisArg==="undefined"){return func}switch(argCount){case 0:return function(){return func.call(thisArg)};case 1:return function(arg){return func.call(thisArg,arg)};case 2:return function(value,index){return func.call(thisArg,value,index)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)}}return function(){return func.apply(thisArg,arguments)}};var dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;var argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",errorClass="[object Error]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]";var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,supportsArgsClass=toString.call(arguments)==argsClass,supportNodeClass,errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype,propertyIsEnumerable=objectProto.propertyIsEnumerable;try{supportNodeClass=!(toString.call(document)==objectClass&&!({toString:0}+""))}catch(e){supportNodeClass=true}var nonEnumProps={};nonEnumProps[arrayClass]=nonEnumProps[dateClass]=nonEnumProps[numberClass]={constructor:true,toLocaleString:true,toString:true,valueOf:true};nonEnumProps[boolClass]=nonEnumProps[stringClass]={constructor:true,toString:true,valueOf:true};nonEnumProps[errorClass]=nonEnumProps[funcClass]=nonEnumProps[regexpClass]={constructor:true,toString:true};nonEnumProps[objectClass]={constructor:true};var support={};(function(){var ctor=function(){this.x=1},props=[];ctor.prototype={valueOf:1,y:1};for(var key in new ctor){props.push(key)}for(key in arguments){}support.enumErrorProps=propertyIsEnumerable.call(errorProto,"message")||propertyIsEnumerable.call(errorProto,"name");support.enumPrototypes=propertyIsEnumerable.call(ctor,"prototype");support.nonEnumArgs=key!=0;support.nonEnumShadows=!/valueOf/.test(props)})(1);var isObject=Rx.internals.isObject=function(value){var type=typeof value;return value&&(type=="function"||type=="object")||false};function keysIn(object){var result=[];if(!isObject(object)){return result}if(support.nonEnumArgs&&object.length&&isArguments(object)){object=slice.call(object)}var skipProto=support.enumPrototypes&&typeof object=="function",skipErrorProps=support.enumErrorProps&&(object===errorProto||object instanceof Error);for(var key in object){if(!(skipProto&&key=="prototype")&&!(skipErrorProps&&(key=="message"||key=="name"))){result.push(key)}}if(support.nonEnumShadows&&object!==objectProto){var ctor=object.constructor,index=-1,length=dontEnumsLength;if(object===(ctor&&ctor.prototype)){var className=object===stringProto?stringClass:object===errorProto?errorClass:toString.call(object),nonEnum=nonEnumProps[className]}while(++index<length){key=dontEnums[index];if(!(nonEnum&&nonEnum[key])&&hasOwnProperty.call(object,key)){result.push(key)}}}return result}function internalFor(object,callback,keysFunc){var index=-1,props=keysFunc(object),length=props.length;while(++index<length){var key=props[index];if(callback(object[key],key,object)===false){break}}return object}function internalForIn(object,callback){return internalFor(object,callback,keysIn)}function isNode(value){return typeof value.toString!="function"&&typeof(value+"")=="string"}var isArguments=function(value){return value&&typeof value=="object"?toString.call(value)==argsClass:false};if(!supportsArgsClass){isArguments=function(value){return value&&typeof value=="object"?hasOwnProperty.call(value,"callee"):false}}var isEqual=Rx.internals.isEqual=function(x,y){return deepEquals(x,y,[],[])};function deepEquals(a,b,stackA,stackB){if(a===b){return a!==0||1/a==1/b}var type=typeof a,otherType=typeof b;if(a===a&&(a==null||b==null||type!="function"&&type!="object"&&otherType!="function"&&otherType!="object")){return false}var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass}if(otherClass==argsClass){otherClass=objectClass}if(className!=otherClass){return false}switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){if(className!=objectClass||!support.nodeClass&&(isNode(a)||isNode(b))){return false}var ctorA=!support.argsObject&&isArguments(a)?Object:a.constructor,ctorB=!support.argsObject&&isArguments(b)?Object:b.constructor;if(ctorA!=ctorB&&!(hasOwnProperty.call(a,"constructor")&&hasOwnProperty.call(b,"constructor"))&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&("constructor"in a&&"constructor"in b)){return false}}var initedStack=!stackA;stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b}}var size=0;var result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==length;if(result){while(size--){var index=length,value=b[size];if(!(result=deepEquals(a[size],value,stackA,stackB))){break}}}}else{internalForIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return result=hasOwnProperty.call(a,key)&&deepEquals(a[key],value,stackA,stackB)}});if(result){internalForIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return result=--size>-1}})}}stackA.pop();stackB.pop();return result}var hasProp={}.hasOwnProperty,slice=Array.prototype.slice;var inherits=this.inherits=Rx.internals.inherits=function(child,parent){function __(){this.constructor=child}__.prototype=parent.prototype;child.prototype=new __};var addProperties=Rx.internals.addProperties=function(obj){for(var sources=[],i=1,len=arguments.length;i<len;i++){sources.push(arguments[i])}for(var idx=0,ln=sources.length;idx<ln;idx++){var source=sources[idx];for(var prop in source){obj[prop]=source[prop]}}};var addRef=Rx.internals.addRef=function(xs,r){return new AnonymousObservable(function(observer){return new CompositeDisposable(r.getDisposable(),xs.subscribe(observer))})};function arrayInitialize(count,factory){var a=new Array(count);for(var i=0;i<count;i++){a[i]=factory()}return a}var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){if(!isFunction(fn)){throw new TypeError("fn must be a function")}tryCatchTarget=fn;return tryCatcher}function thrower(e){throw e}function IndexedItem(id,value){this.id=id;this.value=value}IndexedItem.prototype.compareTo=function(other){var c=this.value.compareTo(other.value);c===0&&(c=this.id-other.id);return c};var PriorityQueue=Rx.internals.PriorityQueue=function(capacity){this.items=new Array(capacity);this.length=0};var priorityProto=PriorityQueue.prototype;priorityProto.isHigherPriority=function(left,right){return this.items[left].compareTo(this.items[right])<0};priorityProto.percolate=function(index){if(index>=this.length||index<0){return}var parent=index-1>>1;if(parent<0||parent===index){return}if(this.isHigherPriority(index,parent)){var temp=this.items[index];this.items[index]=this.items[parent];this.items[parent]=temp;this.percolate(parent)}};priorityProto.heapify=function(index){+index||(index=0);if(index>=this.length||index<0){return}var left=2*index+1,right=2*index+2,first=index;if(left<this.length&&this.isHigherPriority(left,first)){first=left}if(right<this.length&&this.isHigherPriority(right,first)){first=right}if(first!==index){var temp=this.items[index];this.items[index]=this.items[first];this.items[first]=temp;this.heapify(first)}};priorityProto.peek=function(){return this.items[0].value};priorityProto.removeAt=function(index){this.items[index]=this.items[--this.length];this.items[this.length]=undefined;this.heapify()};priorityProto.dequeue=function(){var result=this.peek();this.removeAt(0);return result};priorityProto.enqueue=function(item){var index=this.length++;this.items[index]=new IndexedItem(PriorityQueue.count++,item);this.percolate(index)};priorityProto.remove=function(item){for(var i=0;i<this.length;i++){if(this.items[i].value===item){this.removeAt(i);return true}}return false};PriorityQueue.count=0;var CompositeDisposable=Rx.CompositeDisposable=function(){var args=[],i,len;if(Array.isArray(arguments[0])){args=arguments[0];len=args.length}else{len=arguments.length;args=new Array(len);for(i=0;i<len;i++){args[i]=arguments[i]}}for(i=0;i<len;i++){if(!isDisposable(args[i])){throw new TypeError("Not a disposable");
}}this.disposables=args;this.isDisposed=false;this.length=args.length};var CompositeDisposablePrototype=CompositeDisposable.prototype;CompositeDisposablePrototype.add=function(item){if(this.isDisposed){item.dispose()}else{this.disposables.push(item);this.length++}};CompositeDisposablePrototype.remove=function(item){var shouldDispose=false;if(!this.isDisposed){var idx=this.disposables.indexOf(item);if(idx!==-1){shouldDispose=true;this.disposables.splice(idx,1);this.length--;item.dispose()}}return shouldDispose};CompositeDisposablePrototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var len=this.disposables.length,currentDisposables=new Array(len);for(var i=0;i<len;i++){currentDisposables[i]=this.disposables[i]}this.disposables=[];this.length=0;for(i=0;i<len;i++){currentDisposables[i].dispose()}}};var Disposable=Rx.Disposable=function(action){this.isDisposed=false;this.action=action||noop};Disposable.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true}};var disposableCreate=Disposable.create=function(action){return new Disposable(action)};var disposableEmpty=Disposable.empty={dispose:noop};var isDisposable=Disposable.isDisposable=function(d){return d&&isFunction(d.dispose)};var checkDisposed=Disposable.checkDisposed=function(disposable){if(disposable.isDisposed){throw new ObjectDisposedError}};var SingleAssignmentDisposable=Rx.SingleAssignmentDisposable=function(){this.isDisposed=false;this.current=null};SingleAssignmentDisposable.prototype.getDisposable=function(){return this.current};SingleAssignmentDisposable.prototype.setDisposable=function(value){if(this.current){throw new Error("Disposable has already been assigned")}var shouldDispose=this.isDisposed;!shouldDispose&&(this.current=value);shouldDispose&&value&&value.dispose()};SingleAssignmentDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=null}old&&old.dispose()};var SerialDisposable=Rx.SerialDisposable=function(){this.isDisposed=false;this.current=null};SerialDisposable.prototype.getDisposable=function(){return this.current};SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed;if(!shouldDispose){var old=this.current;this.current=value}old&&old.dispose();shouldDispose&&value&&value.dispose()};SerialDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=null}old&&old.dispose()};var RefCountDisposable=Rx.RefCountDisposable=function(){function InnerDisposable(disposable){this.disposable=disposable;this.disposable.count++;this.isInnerDisposed=false}InnerDisposable.prototype.dispose=function(){if(!this.disposable.isDisposed&&!this.isInnerDisposed){this.isInnerDisposed=true;this.disposable.count--;if(this.disposable.count===0&&this.disposable.isPrimaryDisposed){this.disposable.isDisposed=true;this.disposable.underlyingDisposable.dispose()}}};function RefCountDisposable(disposable){this.underlyingDisposable=disposable;this.isDisposed=false;this.isPrimaryDisposed=false;this.count=0}RefCountDisposable.prototype.dispose=function(){if(!this.isDisposed&&!this.isPrimaryDisposed){this.isPrimaryDisposed=true;if(this.count===0){this.isDisposed=true;this.underlyingDisposable.dispose()}}};RefCountDisposable.prototype.getDisposable=function(){return this.isDisposed?disposableEmpty:new InnerDisposable(this)};return RefCountDisposable}();function ScheduledDisposable(scheduler,disposable){this.scheduler=scheduler;this.disposable=disposable;this.isDisposed=false}function scheduleItem(s,self){if(!self.isDisposed){self.isDisposed=true;self.disposable.dispose()}}ScheduledDisposable.prototype.dispose=function(){this.scheduler.scheduleWithState(this,scheduleItem)};var ScheduledItem=Rx.internals.ScheduledItem=function(scheduler,state,action,dueTime,comparer){this.scheduler=scheduler;this.state=state;this.action=action;this.dueTime=dueTime;this.comparer=comparer||defaultSubComparer;this.disposable=new SingleAssignmentDisposable};ScheduledItem.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())};ScheduledItem.prototype.compareTo=function(other){return this.comparer(this.dueTime,other.dueTime)};ScheduledItem.prototype.isCancelled=function(){return this.disposable.isDisposed};ScheduledItem.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var Scheduler=Rx.Scheduler=function(){function Scheduler(now,schedule,scheduleRelative,scheduleAbsolute){this.now=now;this._schedule=schedule;this._scheduleRelative=scheduleRelative;this._scheduleAbsolute=scheduleAbsolute}Scheduler.isScheduler=function(s){return s instanceof Scheduler};function invokeAction(scheduler,action){action();return disposableEmpty}var schedulerProto=Scheduler.prototype;schedulerProto.schedule=function(action){return this._schedule(action,invokeAction)};schedulerProto.scheduleWithState=function(state,action){return this._schedule(state,action)};schedulerProto.scheduleWithRelative=function(dueTime,action){return this._scheduleRelative(action,dueTime,invokeAction)};schedulerProto.scheduleWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative(state,dueTime,action)};schedulerProto.scheduleWithAbsolute=function(dueTime,action){return this._scheduleAbsolute(action,dueTime,invokeAction)};schedulerProto.scheduleWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute(state,dueTime,action)};Scheduler.now=defaultNow;Scheduler.normalize=function(timeSpan){timeSpan<0&&(timeSpan=0);return timeSpan};return Scheduler}();var normalizeTime=Scheduler.normalize,isScheduler=Scheduler.isScheduler;(function(schedulerProto){function invokeRecImmediate(scheduler,pair){var state=pair[0],action=pair[1],group=new CompositeDisposable;function recursiveAction(state1){action(state1,function(state2){var isAdded=false,isDone=false,d=scheduler.scheduleWithState(state2,function(scheduler1,state3){if(isAdded){group.remove(d)}else{isDone=true}recursiveAction(state3);return disposableEmpty});if(!isDone){group.add(d);isAdded=true}})}recursiveAction(state);return group}function invokeRecDate(scheduler,pair,method){var state=pair[0],action=pair[1],group=new CompositeDisposable;function recursiveAction(state1){action(state1,function(state2,dueTime1){var isAdded=false,isDone=false,d=scheduler[method](state2,dueTime1,function(scheduler1,state3){if(isAdded){group.remove(d)}else{isDone=true}recursiveAction(state3);return disposableEmpty});if(!isDone){group.add(d);isAdded=true}})}recursiveAction(state);return group}function scheduleInnerRecursive(action,self){action(function(dt){self(action,dt)})}schedulerProto.scheduleRecursive=function(action){return this.scheduleRecursiveWithState(action,scheduleInnerRecursive)};schedulerProto.scheduleRecursiveWithState=function(state,action){return this.scheduleWithState([state,action],invokeRecImmediate)};schedulerProto.scheduleRecursiveWithRelative=function(dueTime,action){return this.scheduleRecursiveWithRelativeAndState(action,dueTime,scheduleInnerRecursive)};schedulerProto.scheduleRecursiveWithRelativeAndState=function(state,dueTime,action){return this._scheduleRelative([state,action],dueTime,function(s,p){return invokeRecDate(s,p,"scheduleWithRelativeAndState")})};schedulerProto.scheduleRecursiveWithAbsolute=function(dueTime,action){return this.scheduleRecursiveWithAbsoluteAndState(action,dueTime,scheduleInnerRecursive)};schedulerProto.scheduleRecursiveWithAbsoluteAndState=function(state,dueTime,action){return this._scheduleAbsolute([state,action],dueTime,function(s,p){return invokeRecDate(s,p,"scheduleWithAbsoluteAndState")})}})(Scheduler.prototype);(function(schedulerProto){Scheduler.prototype.schedulePeriodic=function(period,action){return this.schedulePeriodicWithState(null,period,action)};Scheduler.prototype.schedulePeriodicWithState=function(state,period,action){if(typeof root.setInterval==="undefined"){throw new NotSupportedError}period=normalizeTime(period);var s=state,id=root.setInterval(function(){s=action(s)},period);return disposableCreate(function(){root.clearInterval(id)})}})(Scheduler.prototype);(function(schedulerProto){schedulerProto.catchError=schedulerProto["catch"]=function(handler){return new CatchScheduler(this,handler)}})(Scheduler.prototype);var SchedulePeriodicRecursive=Rx.internals.SchedulePeriodicRecursive=function(){function tick(command,recurse){recurse(0,this._period);try{this._state=this._action(this._state)}catch(e){this._cancel.dispose();throw e}}function SchedulePeriodicRecursive(scheduler,state,period,action){this._scheduler=scheduler;this._state=state;this._period=period;this._action=action}SchedulePeriodicRecursive.prototype.start=function(){var d=new SingleAssignmentDisposable;this._cancel=d;d.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,tick.bind(this)));return d};return SchedulePeriodicRecursive}();var immediateScheduler=Scheduler.immediate=function(){function scheduleNow(state,action){return action(this,state)}return new Scheduler(defaultNow,scheduleNow,notSupported,notSupported)}();var currentThreadScheduler=Scheduler.currentThread=function(){var queue;function runTrampoline(){while(queue.length>0){var item=queue.dequeue();!item.isCancelled()&&item.invoke()}}function scheduleNow(state,action){var si=new ScheduledItem(this,state,action,this.now());if(!queue){queue=new PriorityQueue(4);queue.enqueue(si);var result=tryCatch(runTrampoline)();queue=null;if(result===errorObj){return thrower(result.e)}}else{queue.enqueue(si)}return si.disposable}var currentScheduler=new Scheduler(defaultNow,scheduleNow,notSupported,notSupported);currentScheduler.scheduleRequired=function(){return!queue};return currentScheduler}();var scheduleMethod,clearMethod;var localTimer=function(){var localSetTimeout,localClearTimeout=noop;if(!!root.setTimeout){localSetTimeout=root.setTimeout;localClearTimeout=root.clearTimeout}else if(!!root.WScript){localSetTimeout=function(fn,time){root.WScript.Sleep(time);fn()}}else{throw new NotSupportedError}return{setTimeout:localSetTimeout,clearTimeout:localClearTimeout}}();var localSetTimeout=localTimer.setTimeout,localClearTimeout=localTimer.clearTimeout;(function(){var nextHandle=1,tasksByHandle={},currentlyRunning=false;clearMethod=function(handle){delete tasksByHandle[handle]};function runTask(handle){if(currentlyRunning){localSetTimeout(function(){runTask(handle)},0)}else{var task=tasksByHandle[handle];if(task){currentlyRunning=true;var result=tryCatch(task)();clearMethod(handle);currentlyRunning=false;if(result===errorObj){return thrower(result.e)}}}}var reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var setImmediate=typeof(setImmediate=freeGlobal&&moduleExports&&freeGlobal.setImmediate)=="function"&&!reNative.test(setImmediate)&&setImmediate;function postMessageSupported(){if(!root.postMessage||root.importScripts){return false}var isAsync=false,oldHandler=root.onmessage;root.onmessage=function(){isAsync=true};root.postMessage("","*");root.onmessage=oldHandler;return isAsync}if(isFunction(setImmediate)){scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;setImmediate(function(){runTask(id)});return id}}else if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;process.nextTick(function(){runTask(id)});return id}}else if(postMessageSupported()){var MSG_PREFIX="ms.rx.schedule"+Math.random();function onGlobalPostMessage(event){if(typeof event.data==="string"&&event.data.substring(0,MSG_PREFIX.length)===MSG_PREFIX){runTask(event.data.substring(MSG_PREFIX.length))}}if(root.addEventListener){root.addEventListener("message",onGlobalPostMessage,false)}else if(root.attachEvent){root.attachEvent("onmessage",onGlobalPostMessage)}else{root.onmessage=onGlobalPostMessage}scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;root.postMessage(MSG_PREFIX+currentId,"*");return id}}else if(!!root.MessageChannel){var channel=new root.MessageChannel;channel.port1.onmessage=function(e){runTask(e.data)};scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;channel.port2.postMessage(id);return id}}else if("document"in root&&"onreadystatechange"in root.document.createElement("script")){scheduleMethod=function(action){var scriptElement=root.document.createElement("script");var id=nextHandle++;tasksByHandle[id]=action;scriptElement.onreadystatechange=function(){runTask(id);scriptElement.onreadystatechange=null;scriptElement.parentNode.removeChild(scriptElement);scriptElement=null};root.document.documentElement.appendChild(scriptElement);return id}}else{scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;localSetTimeout(function(){runTask(id)},0);return id}}})();var timeoutScheduler=Scheduler.timeout=Scheduler["default"]=function(){function scheduleNow(state,action){var scheduler=this,disposable=new SingleAssignmentDisposable;var id=scheduleMethod(function(){!disposable.isDisposed&&disposable.setDisposable(action(scheduler,state))});return new CompositeDisposable(disposable,disposableCreate(function(){clearMethod(id)}))}function scheduleRelative(state,dueTime,action){var scheduler=this,dt=Scheduler.normalize(dueTime),disposable=new SingleAssignmentDisposable;if(dt===0){return scheduler.scheduleWithState(state,action)}var id=localSetTimeout(function(){!disposable.isDisposed&&disposable.setDisposable(action(scheduler,state))},dt);return new CompositeDisposable(disposable,disposableCreate(function(){localClearTimeout(id)}))}function scheduleAbsolute(state,dueTime,action){return this.scheduleWithRelativeAndState(state,dueTime-this.now(),action)}return new Scheduler(defaultNow,scheduleNow,scheduleRelative,scheduleAbsolute)}();var CatchScheduler=function(__super__){function scheduleNow(state,action){return this._scheduler.scheduleWithState(state,this._wrap(action))}function scheduleRelative(state,dueTime,action){return this._scheduler.scheduleWithRelativeAndState(state,dueTime,this._wrap(action))}function scheduleAbsolute(state,dueTime,action){return this._scheduler.scheduleWithAbsoluteAndState(state,dueTime,this._wrap(action))}inherits(CatchScheduler,__super__);function CatchScheduler(scheduler,handler){this._scheduler=scheduler;this._handler=handler;this._recursiveOriginal=null;this._recursiveWrapper=null;__super__.call(this,this._scheduler.now.bind(this._scheduler),scheduleNow,scheduleRelative,scheduleAbsolute)}CatchScheduler.prototype._clone=function(scheduler){return new CatchScheduler(scheduler,this._handler)};CatchScheduler.prototype._wrap=function(action){var parent=this;return function(self,state){try{return action(parent._getRecursiveWrapper(self),state)}catch(e){if(!parent._handler(e)){throw e}return disposableEmpty}}};CatchScheduler.prototype._getRecursiveWrapper=function(scheduler){if(this._recursiveOriginal!==scheduler){this._recursiveOriginal=scheduler;var wrapper=this._clone(scheduler);wrapper._recursiveOriginal=scheduler;wrapper._recursiveWrapper=wrapper;this._recursiveWrapper=wrapper}return this._recursiveWrapper};CatchScheduler.prototype.schedulePeriodicWithState=function(state,period,action){var self=this,failed=false,d=new SingleAssignmentDisposable;d.setDisposable(this._scheduler.schedulePeriodicWithState(state,period,function(state1){if(failed){return null}try{return action(state1)}catch(e){failed=true;if(!self._handler(e)){throw e}d.dispose();return null}}));return d};return CatchScheduler}(Scheduler);var Notification=Rx.Notification=function(){function Notification(kind,value,exception,accept,acceptObservable,toString){this.kind=kind;this.value=value;this.exception=exception;this._accept=accept;this._acceptObservable=acceptObservable;this.toString=toString}Notification.prototype.accept=function(observerOrOnNext,onError,onCompleted){return observerOrOnNext&&typeof observerOrOnNext==="object"?this._acceptObservable(observerOrOnNext):this._accept(observerOrOnNext,onError,onCompleted)};Notification.prototype.toObservable=function(scheduler){var self=this;isScheduler(scheduler)||(scheduler=immediateScheduler);return new AnonymousObservable(function(observer){return scheduler.scheduleWithState(self,function(_,notification){notification._acceptObservable(observer);notification.kind==="N"&&observer.onCompleted()})})};return Notification}();var notificationCreateOnNext=Notification.createOnNext=function(){function _accept(onNext){return onNext(this.value)}function _acceptObservable(observer){return observer.onNext(this.value)}function toString(){return"OnNext("+this.value+")"}return function(value){return new Notification("N",value,null,_accept,_acceptObservable,toString)}}();var notificationCreateOnError=Notification.createOnError=function(){function _accept(onNext,onError){return onError(this.exception)}function _acceptObservable(observer){return observer.onError(this.exception)}function toString(){return"OnError("+this.exception+")"}return function(e){return new Notification("E",null,e,_accept,_acceptObservable,toString)}}();var notificationCreateOnCompleted=Notification.createOnCompleted=function(){function _accept(onNext,onError,onCompleted){return onCompleted()}function _acceptObservable(observer){return observer.onCompleted()}function toString(){return"OnCompleted()"}return function(){return new Notification("C",null,null,_accept,_acceptObservable,toString)}}();var Observer=Rx.Observer=function(){};Observer.prototype.toNotifier=function(){var observer=this;return function(n){return n.accept(observer)}};Observer.prototype.asObserver=function(){return new AnonymousObserver(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))};Observer.prototype.checked=function(){return new CheckedObserver(this)};var observerCreate=Observer.create=function(onNext,onError,onCompleted){onNext||(onNext=noop);onError||(onError=defaultError);onCompleted||(onCompleted=noop);return new AnonymousObserver(onNext,onError,onCompleted)};Observer.fromNotifier=function(handler,thisArg){return new AnonymousObserver(function(x){return handler.call(thisArg,notificationCreateOnNext(x))},function(e){return handler.call(thisArg,notificationCreateOnError(e))},function(){return handler.call(thisArg,notificationCreateOnCompleted())})};Observer.prototype.notifyOn=function(scheduler){return new ObserveOnObserver(scheduler,this)};Observer.prototype.makeSafe=function(disposable){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,disposable)};var AbstractObserver=Rx.internals.AbstractObserver=function(__super__){inherits(AbstractObserver,__super__);function AbstractObserver(){this.isStopped=false;__super__.call(this)}AbstractObserver.prototype.next=notImplemented;AbstractObserver.prototype.error=notImplemented;AbstractObserver.prototype.completed=notImplemented;AbstractObserver.prototype.onNext=function(value){if(!this.isStopped){this.next(value)}};AbstractObserver.prototype.onError=function(error){if(!this.isStopped){this.isStopped=true;this.error(error)}};AbstractObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.completed()}};AbstractObserver.prototype.dispose=function(){this.isStopped=true};AbstractObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.error(e);return true}return false};return AbstractObserver}(Observer);var AnonymousObserver=Rx.AnonymousObserver=function(__super__){inherits(AnonymousObserver,__super__);function AnonymousObserver(onNext,onError,onCompleted){__super__.call(this);this._onNext=onNext;this._onError=onError;this._onCompleted=onCompleted}AnonymousObserver.prototype.next=function(value){this._onNext(value)};AnonymousObserver.prototype.error=function(error){this._onError(error)};AnonymousObserver.prototype.completed=function(){this._onCompleted()};return AnonymousObserver}(AbstractObserver);var CheckedObserver=function(__super__){inherits(CheckedObserver,__super__);function CheckedObserver(observer){__super__.call(this);this._observer=observer;this._state=0}var CheckedObserverPrototype=CheckedObserver.prototype;CheckedObserverPrototype.onNext=function(value){this.checkAccess();var res=tryCatch(this._observer.onNext).call(this._observer,value);this._state=0;res===errorObj&&thrower(res.e)};CheckedObserverPrototype.onError=function(err){this.checkAccess();var res=tryCatch(this._observer.onError).call(this._observer,err);this._state=2;res===errorObj&&thrower(res.e)};CheckedObserverPrototype.onCompleted=function(){this.checkAccess();var res=tryCatch(this._observer.onCompleted).call(this._observer);this._state=2;res===errorObj&&thrower(res.e)};CheckedObserverPrototype.checkAccess=function(){if(this._state===1){throw new Error("Re-entrancy detected")}if(this._state===2){throw new Error("Observer completed")}if(this._state===0){this._state=1}};return CheckedObserver}(Observer);var ScheduledObserver=Rx.internals.ScheduledObserver=function(__super__){inherits(ScheduledObserver,__super__);function ScheduledObserver(scheduler,observer){__super__.call(this);this.scheduler=scheduler;this.observer=observer;this.isAcquired=false;this.hasFaulted=false;this.queue=[];this.disposable=new SerialDisposable}ScheduledObserver.prototype.next=function(value){var self=this;this.queue.push(function(){self.observer.onNext(value)})};ScheduledObserver.prototype.error=function(e){var self=this;this.queue.push(function(){self.observer.onError(e)})};ScheduledObserver.prototype.completed=function(){var self=this;this.queue.push(function(){self.observer.onCompleted()})};ScheduledObserver.prototype.ensureActive=function(){var isOwner=false,parent=this;if(!this.hasFaulted&&this.queue.length>0){isOwner=!this.isAcquired;this.isAcquired=true}if(isOwner){this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(self){var work;if(parent.queue.length>0){work=parent.queue.shift()}else{parent.isAcquired=false;return}try{work()}catch(ex){parent.queue=[];parent.hasFaulted=true;throw ex}self()}))}};ScheduledObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this);this.disposable.dispose()};return ScheduledObserver}(AbstractObserver);var ObserveOnObserver=function(__super__){inherits(ObserveOnObserver,__super__);function ObserveOnObserver(scheduler,observer,cancel){__super__.call(this,scheduler,observer);this._cancel=cancel}ObserveOnObserver.prototype.next=function(value){__super__.prototype.next.call(this,value);this.ensureActive()};ObserveOnObserver.prototype.error=function(e){__super__.prototype.error.call(this,e);this.ensureActive()};ObserveOnObserver.prototype.completed=function(){__super__.prototype.completed.call(this);this.ensureActive()};ObserveOnObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this);this._cancel&&this._cancel.dispose();this._cancel=null};return ObserveOnObserver}(ScheduledObserver);var observableProto;var Observable=Rx.Observable=function(){function Observable(subscribe){if(Rx.config.longStackSupport&&hasStacks){try{throw new Error}catch(e){this.stack=e.stack.substring(e.stack.indexOf("\n")+1)}var self=this;this._subscribe=function(observer){var oldOnError=observer.onError.bind(observer);observer.onError=function(err){makeStackTraceLong(err,self);oldOnError(err)};return subscribe.call(self,observer)}}else{this._subscribe=subscribe}}observableProto=Observable.prototype;observableProto.subscribe=observableProto.forEach=function(observerOrOnNext,onError,onCompleted){return this._subscribe(typeof observerOrOnNext==="object"?observerOrOnNext:observerCreate(observerOrOnNext,onError,onCompleted))};observableProto.subscribeOnNext=function(onNext,thisArg){return this._subscribe(observerCreate(typeof thisArg!=="undefined"?function(x){onNext.call(thisArg,x)}:onNext))};observableProto.subscribeOnError=function(onError,thisArg){return this._subscribe(observerCreate(null,typeof thisArg!=="undefined"?function(e){onError.call(thisArg,e)}:onError))};observableProto.subscribeOnCompleted=function(onCompleted,thisArg){return this._subscribe(observerCreate(null,null,typeof thisArg!=="undefined"?function(){onCompleted.call(thisArg)}:onCompleted))};return Observable}();var ObservableBase=Rx.ObservableBase=function(__super__){inherits(ObservableBase,__super__);function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],self=state[1];var sub=tryCatch(self.subscribeCore).call(self,ado);if(sub===errorObj){if(!ado.fail(errorObj.e)){return thrower(errorObj.e)}}ado.setDisposable(fixSubscriber(sub))}function subscribe(observer){var ado=new AutoDetachObserver(observer),state=[ado,this];if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.scheduleWithState(state,setDisposable)}else{setDisposable(null,state)}return ado}function ObservableBase(){__super__.call(this,subscribe)}ObservableBase.prototype.subscribeCore=notImplemented;return ObservableBase}(Observable);var Enumerable=Rx.internals.Enumerable=function(){};var ConcatEnumerableObservable=function(__super__){inherits(ConcatEnumerableObservable,__super__);function ConcatEnumerableObservable(sources){this.sources=sources;__super__.call(this)}ConcatEnumerableObservable.prototype.subscribeCore=function(o){var isDisposed,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursiveWithState(this.sources[$iterator$](),function(e,self){if(isDisposed){return}var currentItem=tryCatch(e.next).call(e);if(currentItem===errorObj){return o.onError(currentItem.e)}if(currentItem.done){return o.onCompleted()}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(new InnerObserver(o,self,e)))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))};function InnerObserver(o,s,e){this.o=o;this.s=s;this.e=e;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.o.onNext(x)}};InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.s(this.e)}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err);return true}return false};return ConcatEnumerableObservable}(ObservableBase);Enumerable.prototype.concat=function(){return new ConcatEnumerableObservable(this)};var CatchErrorObservable=function(__super__){inherits(CatchErrorObservable,__super__);function CatchErrorObservable(sources){this.sources=sources;__super__.call(this)}CatchErrorObservable.prototype.subscribeCore=function(o){var e=this.sources[$iterator$]();var isDisposed,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursiveWithState(null,function(lastException,self){if(isDisposed){return}var currentItem=tryCatch(e.next).call(e);if(currentItem===errorObj){return o.onError(currentItem.e)}if(currentItem.done){return lastException!==null?o.onError(lastException):o.onCompleted()}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},self,function(){o.onCompleted()}))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))};return CatchErrorObservable}(ObservableBase);Enumerable.prototype.catchError=function(){return new CatchErrorObservable(this)};Enumerable.prototype.catchErrorWhen=function(notificationHandler){var sources=this;return new AnonymousObservable(function(o){var exceptions=new Subject,notifier=new Subject,handled=notificationHandler(exceptions),notificationDisposable=handled.subscribe(notifier);var e=sources[$iterator$]();var isDisposed,lastException,subscription=new SerialDisposable;var cancelable=immediateScheduler.scheduleRecursive(function(self){if(isDisposed){return}var currentItem=tryCatch(e.next).call(e);if(currentItem===errorObj){return o.onError(currentItem.e)}if(currentItem.done){if(lastException){o.onError(lastException)}else{o.onCompleted()}return}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var outer=new SingleAssignmentDisposable;var inner=new SingleAssignmentDisposable;subscription.setDisposable(new CompositeDisposable(inner,outer));outer.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(exn){inner.setDisposable(notifier.subscribe(self,function(ex){o.onError(ex)},function(){o.onCompleted()}));exceptions.onNext(exn)},function(){o.onCompleted()}))});return new CompositeDisposable(notificationDisposable,subscription,cancelable,disposableCreate(function(){isDisposed=true}))})};var RepeatEnumerable=function(__super__){inherits(RepeatEnumerable,__super__);function RepeatEnumerable(v,c){this.v=v;this.c=c==null?-1:c}RepeatEnumerable.prototype[$iterator$]=function(){return new RepeatEnumerator(this)};function RepeatEnumerator(p){this.v=p.v;this.l=p.c}RepeatEnumerator.prototype.next=function(){if(this.l===0){return doneEnumerator}if(this.l>0){this.l--}return{done:false,value:this.v}};return RepeatEnumerable}(Enumerable);var enumerableRepeat=Enumerable.repeat=function(value,repeatCount){return new RepeatEnumerable(value,repeatCount)};var OfEnumerable=function(__super__){inherits(OfEnumerable,__super__);function OfEnumerable(s,fn,thisArg){this.s=s;this.fn=fn?bindCallback(fn,thisArg,3):null}OfEnumerable.prototype[$iterator$]=function(){return new OfEnumerator(this)};function OfEnumerator(p){this.i=-1;this.s=p.s;this.l=this.s.length;this.fn=p.fn}OfEnumerator.prototype.next=function(){return++this.i<this.l?{done:false,value:!this.fn?this.s[this.i]:this.fn(this.s[this.i],this.i,this.s)}:doneEnumerator};return OfEnumerable}(Enumerable);var enumerableOf=Enumerable.of=function(source,selector,thisArg){return new OfEnumerable(source,selector,thisArg)};observableProto.observeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(new ObserveOnObserver(scheduler,observer))},source)};observableProto.subscribeOn=function(scheduler){var source=this;return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable,d=new SerialDisposable;d.setDisposable(m);m.setDisposable(scheduler.schedule(function(){d.setDisposable(new ScheduledDisposable(scheduler,source.subscribe(observer)))}));return d},source)};var FromPromiseObservable=function(__super__){inherits(FromPromiseObservable,__super__);function FromPromiseObservable(p){this.p=p;__super__.call(this)}FromPromiseObservable.prototype.subscribeCore=function(o){this.p.then(function(data){o.onNext(data);o.onCompleted()},function(err){o.onError(err)});return disposableEmpty};return FromPromiseObservable}(ObservableBase);var observableFromPromise=Observable.fromPromise=function(promise){return new FromPromiseObservable(promise)};observableProto.toPromise=function(promiseCtor){promiseCtor||(promiseCtor=Rx.config.Promise);if(!promiseCtor){throw new NotSupportedError("Promise type not provided nor in Rx.config.Promise")}var source=this;return new promiseCtor(function(resolve,reject){var value,hasValue=false;source.subscribe(function(v){value=v;hasValue=true},reject,function(){hasValue&&resolve(value)})})};var ToArrayObservable=function(__super__){inherits(ToArrayObservable,__super__);function ToArrayObservable(source){this.source=source;__super__.call(this)}ToArrayObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o));
};function InnerObserver(o){this.o=o;this.a=[];this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.a.push(x)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onNext(this.a);this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return ToArrayObservable}(ObservableBase);observableProto.toArray=function(){return new ToArrayObservable(this)};Observable.create=Observable.createWithDisposable=function(subscribe,parent){return new AnonymousObservable(subscribe,parent)};var observableDefer=Observable.defer=function(observableFactory){return new AnonymousObservable(function(observer){var result;try{result=observableFactory()}catch(e){return observableThrow(e).subscribe(observer)}isPromise(result)&&(result=observableFromPromise(result));return result.subscribe(observer)})};var EmptyObservable=function(__super__){inherits(EmptyObservable,__super__);function EmptyObservable(scheduler){this.scheduler=scheduler;__super__.call(this)}EmptyObservable.prototype.subscribeCore=function(observer){var sink=new EmptySink(observer,this);return sink.run()};function EmptySink(observer,parent){this.observer=observer;this.parent=parent}function scheduleItem(s,state){state.onCompleted()}EmptySink.prototype.run=function(){return this.parent.scheduler.scheduleWithState(this.observer,scheduleItem)};return EmptyObservable}(ObservableBase);var observableEmpty=Observable.empty=function(scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new EmptyObservable(scheduler)};var FromObservable=function(__super__){inherits(FromObservable,__super__);function FromObservable(iterable,mapper,scheduler){this.iterable=iterable;this.mapper=mapper;this.scheduler=scheduler;__super__.call(this)}FromObservable.prototype.subscribeCore=function(observer){var sink=new FromSink(observer,this);return sink.run()};return FromObservable}(ObservableBase);var FromSink=function(){function FromSink(observer,parent){this.observer=observer;this.parent=parent}FromSink.prototype.run=function(){var list=Object(this.parent.iterable),it=getIterable(list),observer=this.observer,mapper=this.parent.mapper;function loopRecursive(i,recurse){try{var next=it.next()}catch(e){return observer.onError(e)}if(next.done){return observer.onCompleted()}var result=next.value;if(mapper){try{result=mapper(result,i)}catch(e){return observer.onError(e)}}observer.onNext(result);recurse(i+1)}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};return FromSink}();var maxSafeInteger=Math.pow(2,53)-1;function StringIterable(str){this._s=s}StringIterable.prototype[$iterator$]=function(){return new StringIterator(this._s)};function StringIterator(str){this._s=s;this._l=s.length;this._i=0}StringIterator.prototype[$iterator$]=function(){return this};StringIterator.prototype.next=function(){return this._i<this._l?{done:false,value:this._s.charAt(this._i++)}:doneEnumerator};function ArrayIterable(a){this._a=a}ArrayIterable.prototype[$iterator$]=function(){return new ArrayIterator(this._a)};function ArrayIterator(a){this._a=a;this._l=toLength(a);this._i=0}ArrayIterator.prototype[$iterator$]=function(){return this};ArrayIterator.prototype.next=function(){return this._i<this._l?{done:false,value:this._a[this._i++]}:doneEnumerator};function numberIsFinite(value){return typeof value==="number"&&root.isFinite(value)}function isNan(n){return n!==n}function getIterable(o){var i=o[$iterator$],it;if(!i&&typeof o==="string"){it=new StringIterable(o);return it[$iterator$]()}if(!i&&o.length!==undefined){it=new ArrayIterable(o);return it[$iterator$]()}if(!i){throw new TypeError("Object is not iterable")}return o[$iterator$]()}function sign(value){var number=+value;if(number===0){return number}if(isNaN(number)){return number}return number<0?-1:1}function toLength(o){var len=+o.length;if(isNaN(len)){return 0}if(len===0||!numberIsFinite(len)){return len}len=sign(len)*Math.floor(Math.abs(len));if(len<=0){return 0}if(len>maxSafeInteger){return maxSafeInteger}return len}var observableFrom=Observable.from=function(iterable,mapFn,thisArg,scheduler){if(iterable==null){throw new Error("iterable cannot be null.")}if(mapFn&&!isFunction(mapFn)){throw new Error("mapFn when provided must be a function")}if(mapFn){var mapper=bindCallback(mapFn,thisArg,2)}isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromObservable(iterable,mapper,scheduler)};var FromArrayObservable=function(__super__){inherits(FromArrayObservable,__super__);function FromArrayObservable(args,scheduler){this.args=args;this.scheduler=scheduler;__super__.call(this)}FromArrayObservable.prototype.subscribeCore=function(observer){var sink=new FromArraySink(observer,this);return sink.run()};return FromArrayObservable}(ObservableBase);function FromArraySink(observer,parent){this.observer=observer;this.parent=parent}FromArraySink.prototype.run=function(){var observer=this.observer,args=this.parent.args,len=args.length;function loopRecursive(i,recurse){if(i<len){observer.onNext(args[i]);recurse(i+1)}else{observer.onCompleted()}}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};var observableFromArray=Observable.fromArray=function(array,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromArrayObservable(array,scheduler)};Observable.generate=function(initialState,condition,iterate,resultSelector,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new AnonymousObservable(function(o){var first=true;return scheduler.scheduleRecursiveWithState(initialState,function(state,self){var hasResult,result;try{if(first){first=false}else{state=iterate(state)}hasResult=condition(state);hasResult&&(result=resultSelector(state))}catch(e){return o.onError(e)}if(hasResult){o.onNext(result);self(state)}else{o.onCompleted()}})})};var NeverObservable=function(__super__){inherits(NeverObservable,__super__);function NeverObservable(){__super__.call(this)}NeverObservable.prototype.subscribeCore=function(observer){return disposableEmpty};return NeverObservable}(ObservableBase);var observableNever=Observable.never=function(){return new NeverObservable};function observableOf(scheduler,array){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromArrayObservable(array,scheduler)}Observable.of=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return new FromArrayObservable(args,currentThreadScheduler)};Observable.ofWithScheduler=function(scheduler){var len=arguments.length,args=new Array(len-1);for(var i=1;i<len;i++){args[i-1]=arguments[i]}return new FromArrayObservable(args,scheduler)};var PairsObservable=function(__super__){inherits(PairsObservable,__super__);function PairsObservable(obj,scheduler){this.obj=obj;this.keys=Object.keys(obj);this.scheduler=scheduler;__super__.call(this)}PairsObservable.prototype.subscribeCore=function(observer){var sink=new PairsSink(observer,this);return sink.run()};return PairsObservable}(ObservableBase);function PairsSink(observer,parent){this.observer=observer;this.parent=parent}PairsSink.prototype.run=function(){var observer=this.observer,obj=this.parent.obj,keys=this.parent.keys,len=keys.length;function loopRecursive(i,recurse){if(i<len){var key=keys[i];observer.onNext([key,obj[key]]);recurse(i+1)}else{observer.onCompleted()}}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};Observable.pairs=function(obj,scheduler){scheduler||(scheduler=currentThreadScheduler);return new PairsObservable(obj,scheduler)};var RangeObservable=function(__super__){inherits(RangeObservable,__super__);function RangeObservable(start,count,scheduler){this.start=start;this.rangeCount=count;this.scheduler=scheduler;__super__.call(this)}RangeObservable.prototype.subscribeCore=function(observer){var sink=new RangeSink(observer,this);return sink.run()};return RangeObservable}(ObservableBase);var RangeSink=function(){function RangeSink(observer,parent){this.observer=observer;this.parent=parent}RangeSink.prototype.run=function(){var start=this.parent.start,count=this.parent.rangeCount,observer=this.observer;function loopRecursive(i,recurse){if(i<count){observer.onNext(start+i);recurse(i+1)}else{observer.onCompleted()}}return this.parent.scheduler.scheduleRecursiveWithState(0,loopRecursive)};return RangeSink}();Observable.range=function(start,count,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new RangeObservable(start,count,scheduler)};var RepeatObservable=function(__super__){inherits(RepeatObservable,__super__);function RepeatObservable(value,repeatCount,scheduler){this.value=value;this.repeatCount=repeatCount==null?-1:repeatCount;this.scheduler=scheduler;__super__.call(this)}RepeatObservable.prototype.subscribeCore=function(observer){var sink=new RepeatSink(observer,this);return sink.run()};return RepeatObservable}(ObservableBase);function RepeatSink(observer,parent){this.observer=observer;this.parent=parent}RepeatSink.prototype.run=function(){var observer=this.observer,value=this.parent.value;function loopRecursive(i,recurse){if(i===-1||i>0){observer.onNext(value);i>0&&i--}if(i===0){return observer.onCompleted()}recurse(i)}return this.parent.scheduler.scheduleRecursiveWithState(this.parent.repeatCount,loopRecursive)};Observable.repeat=function(value,repeatCount,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new RepeatObservable(value,repeatCount,scheduler)};var JustObservable=function(__super__){inherits(JustObservable,__super__);function JustObservable(value,scheduler){this.value=value;this.scheduler=scheduler;__super__.call(this)}JustObservable.prototype.subscribeCore=function(observer){var sink=new JustSink(observer,this);return sink.run()};function JustSink(observer,parent){this.observer=observer;this.parent=parent}function scheduleItem(s,state){var value=state[0],observer=state[1];observer.onNext(value);observer.onCompleted()}JustSink.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.value,this.observer],scheduleItem)};return JustObservable}(ObservableBase);var observableReturn=Observable["return"]=Observable.just=Observable.returnValue=function(value,scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new JustObservable(value,scheduler)};var ThrowObservable=function(__super__){inherits(ThrowObservable,__super__);function ThrowObservable(error,scheduler){this.error=error;this.scheduler=scheduler;__super__.call(this)}ThrowObservable.prototype.subscribeCore=function(o){var sink=new ThrowSink(o,this);return sink.run()};function ThrowSink(o,p){this.o=o;this.p=p}function scheduleItem(s,state){var e=state[0],o=state[1];o.onError(e)}ThrowSink.prototype.run=function(){return this.p.scheduler.scheduleWithState([this.p.error,this.o],scheduleItem)};return ThrowObservable}(ObservableBase);var observableThrow=Observable["throw"]=Observable.throwError=Observable.throwException=function(error,scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new ThrowObservable(error,scheduler)};Observable.using=function(resourceFactory,observableFactory){return new AnonymousObservable(function(observer){var disposable=disposableEmpty,resource,source;try{resource=resourceFactory();resource&&(disposable=resource);source=observableFactory(resource)}catch(exception){return new CompositeDisposable(observableThrow(exception).subscribe(observer),disposable)}return new CompositeDisposable(source.subscribe(observer),disposable)})};observableProto.amb=function(rightSource){var leftSource=this;return new AnonymousObservable(function(observer){var choice,leftChoice="L",rightChoice="R",leftSubscription=new SingleAssignmentDisposable,rightSubscription=new SingleAssignmentDisposable;isPromise(rightSource)&&(rightSource=observableFromPromise(rightSource));function choiceL(){if(!choice){choice=leftChoice;rightSubscription.dispose()}}function choiceR(){if(!choice){choice=rightChoice;leftSubscription.dispose()}}leftSubscription.setDisposable(leftSource.subscribe(function(left){choiceL();choice===leftChoice&&observer.onNext(left)},function(err){choiceL();choice===leftChoice&&observer.onError(err)},function(){choiceL();choice===leftChoice&&observer.onCompleted()}));rightSubscription.setDisposable(rightSource.subscribe(function(right){choiceR();choice===rightChoice&&observer.onNext(right)},function(err){choiceR();choice===rightChoice&&observer.onError(err)},function(){choiceR();choice===rightChoice&&observer.onCompleted()}));return new CompositeDisposable(leftSubscription,rightSubscription)})};Observable.amb=function(){var acc=observableNever(),items=[];if(Array.isArray(arguments[0])){items=arguments[0]}else{for(var i=0,len=arguments.length;i<len;i++){items.push(arguments[i])}}function func(previous,current){return previous.amb(current)}for(var i=0,len=items.length;i<len;i++){acc=func(acc,items[i])}return acc};function observableCatchHandler(source,handler){return new AnonymousObservable(function(o){var d1=new SingleAssignmentDisposable,subscription=new SerialDisposable;subscription.setDisposable(d1);d1.setDisposable(source.subscribe(function(x){o.onNext(x)},function(e){try{var result=handler(e)}catch(ex){return o.onError(ex)}isPromise(result)&&(result=observableFromPromise(result));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(result.subscribe(o))},function(x){o.onCompleted(x)}));return subscription},source)}observableProto["catch"]=observableProto.catchError=observableProto.catchException=function(handlerOrSecond){return typeof handlerOrSecond==="function"?observableCatchHandler(this,handlerOrSecond):observableCatch([this,handlerOrSecond])};var observableCatch=Observable.catchError=Observable["catch"]=Observable.catchException=function(){var items=[];if(Array.isArray(arguments[0])){items=arguments[0]}else{for(var i=0,len=arguments.length;i<len;i++){items.push(arguments[i])}}return enumerableOf(items).catchError()};observableProto.combineLatest=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}if(Array.isArray(args[0])){args[0].unshift(this)}else{args.unshift(this)}return combineLatest.apply(this,args)};var combineLatest=Observable.combineLatest=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=args.pop();Array.isArray(args[0])&&(args=args[0]);return new AnonymousObservable(function(o){var n=args.length,falseFactory=function(){return false},hasValue=arrayInitialize(n,falseFactory),hasValueAll=false,isDone=arrayInitialize(n,falseFactory),values=new Array(n);function next(i){hasValue[i]=true;if(hasValueAll||(hasValueAll=hasValue.every(identity))){try{var res=resultSelector.apply(null,values)}catch(e){return o.onError(e)}o.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(identity)){o.onCompleted()}}function done(i){isDone[i]=true;isDone.every(identity)&&o.onCompleted()}var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){var source=args[i],sad=new SingleAssignmentDisposable;isPromise(source)&&(source=observableFromPromise(source));sad.setDisposable(source.subscribe(function(x){values[i]=x;next(i)},function(e){o.onError(e)},function(){done(i)}));subscriptions[i]=sad})(idx)}return new CompositeDisposable(subscriptions)},this)};observableProto.concat=function(){for(var args=[],i=0,len=arguments.length;i<len;i++){args.push(arguments[i])}args.unshift(this);return observableConcat.apply(null,args)};var ConcatObservable=function(__super__){inherits(ConcatObservable,__super__);function ConcatObservable(sources){this.sources=sources;__super__.call(this)}ConcatObservable.prototype.subscribeCore=function(o){var sink=new ConcatSink(this.sources,o);return sink.run()};function ConcatSink(sources,o){this.sources=sources;this.o=o}ConcatSink.prototype.run=function(){var isDisposed,subscription=new SerialDisposable,sources=this.sources,length=sources.length,o=this.o;var cancelable=immediateScheduler.scheduleRecursiveWithState(0,function(i,self){if(isDisposed){return}if(i===length){return o.onCompleted()}var currentValue=sources[i];isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(e){o.onError(e)},function(){self(i+1)}))});return new CompositeDisposable(subscription,cancelable,disposableCreate(function(){isDisposed=true}))};return ConcatObservable}(ObservableBase);var observableConcat=Observable.concat=function(){var args;if(Array.isArray(arguments[0])){args=arguments[0]}else{args=new Array(arguments.length);for(var i=0,len=arguments.length;i<len;i++){args[i]=arguments[i]}}return new ConcatObservable(args)};observableProto.concatAll=observableProto.concatObservable=function(){return this.merge(1)};var MergeObservable=function(__super__){inherits(MergeObservable,__super__);function MergeObservable(source,maxConcurrent){this.source=source;this.maxConcurrent=maxConcurrent;__super__.call(this)}MergeObservable.prototype.subscribeCore=function(observer){var g=new CompositeDisposable;g.add(this.source.subscribe(new MergeObserver(observer,this.maxConcurrent,g)));return g};return MergeObservable}(ObservableBase);var MergeObserver=function(){function MergeObserver(o,max,g){this.o=o;this.max=max;this.g=g;this.done=false;this.q=[];this.activeCount=0;this.isStopped=false}MergeObserver.prototype.handleSubscribe=function(xs){var sad=new SingleAssignmentDisposable;this.g.add(sad);isPromise(xs)&&(xs=observableFromPromise(xs));sad.setDisposable(xs.subscribe(new InnerObserver(this,sad)))};MergeObserver.prototype.onNext=function(innerSource){if(this.isStopped){return}if(this.activeCount<this.max){this.activeCount++;this.handleSubscribe(innerSource)}else{this.q.push(innerSource)}};MergeObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};MergeObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.done=true;this.activeCount===0&&this.o.onCompleted()}};MergeObserver.prototype.dispose=function(){this.isStopped=true};MergeObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};function InnerObserver(parent,sad){this.parent=parent;this.sad=sad;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.parent.o.onNext(x)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;var parent=this.parent;parent.g.remove(this.sad);if(parent.q.length>0){parent.handleSubscribe(parent.q.shift())}else{parent.activeCount--;parent.done&&parent.activeCount===0&&parent.o.onCompleted()}}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e);return true}return false};return MergeObserver}();observableProto.merge=function(maxConcurrentOrOther){return typeof maxConcurrentOrOther!=="number"?observableMerge(this,maxConcurrentOrOther):new MergeObservable(this,maxConcurrentOrOther)};var observableMerge=Observable.merge=function(){var scheduler,sources=[],i,len=arguments.length;if(!arguments[0]){scheduler=immediateScheduler;for(i=1;i<len;i++){sources.push(arguments[i])}}else if(isScheduler(arguments[0])){scheduler=arguments[0];for(i=1;i<len;i++){sources.push(arguments[i])}}else{scheduler=immediateScheduler;for(i=0;i<len;i++){sources.push(arguments[i])}}if(Array.isArray(sources[0])){sources=sources[0]}return observableOf(scheduler,sources).mergeAll()};var CompositeError=Rx.CompositeError=function(errors){this.name="NotImplementedError";this.innerErrors=errors;this.message="This contains multiple errors. Check the innerErrors";Error.call(this)};CompositeError.prototype=Error.prototype;Observable.mergeDelayError=function(){var args;if(Array.isArray(arguments[0])){args=arguments[0]}else{var len=arguments.length;args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}}var source=observableOf(null,args);return new AnonymousObservable(function(o){var group=new CompositeDisposable,m=new SingleAssignmentDisposable,isStopped=false,errors=[];function setCompletion(){if(errors.length===0){o.onCompleted()}else if(errors.length===1){o.onError(errors[0])}else{o.onError(new CompositeError(errors))}}group.add(m);m.setDisposable(source.subscribe(function(innerSource){var innerSubscription=new SingleAssignmentDisposable;group.add(innerSubscription);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));innerSubscription.setDisposable(innerSource.subscribe(function(x){o.onNext(x)},function(e){errors.push(e);group.remove(innerSubscription);isStopped&&group.length===1&&setCompletion()},function(){group.remove(innerSubscription);isStopped&&group.length===1&&setCompletion()}))},function(e){errors.push(e);isStopped=true;group.length===1&&setCompletion()},function(){isStopped=true;group.length===1&&setCompletion()}));return group})};var MergeAllObservable=function(__super__){inherits(MergeAllObservable,__super__);function MergeAllObservable(source){this.source=source;__super__.call(this)}MergeAllObservable.prototype.subscribeCore=function(observer){var g=new CompositeDisposable,m=new SingleAssignmentDisposable;g.add(m);m.setDisposable(this.source.subscribe(new MergeAllObserver(observer,g)));return g};function MergeAllObserver(o,g){this.o=o;this.g=g;this.isStopped=false;this.done=false}MergeAllObserver.prototype.onNext=function(innerSource){if(this.isStopped){return}var sad=new SingleAssignmentDisposable;this.g.add(sad);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));sad.setDisposable(innerSource.subscribe(new InnerObserver(this,this.g,sad)))};MergeAllObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};MergeAllObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.done=true;this.g.length===1&&this.o.onCompleted()}};MergeAllObserver.prototype.dispose=function(){this.isStopped=true};MergeAllObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};function InnerObserver(parent,g,sad){this.parent=parent;this.g=g;this.sad=sad;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(!this.isStopped){this.parent.o.onNext(x)}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){var parent=this.parent;this.isStopped=true;parent.g.remove(this.sad);parent.done&&parent.g.length===1&&parent.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e);return true}return false};return MergeAllObservable}(ObservableBase);observableProto.mergeAll=observableProto.mergeObservable=function(){return new MergeAllObservable(this)};observableProto.onErrorResumeNext=function(second){if(!second){throw new Error("Second observable is required")}return onErrorResumeNext([this,second])};var onErrorResumeNext=Observable.onErrorResumeNext=function(){var sources=[];if(Array.isArray(arguments[0])){sources=arguments[0]}else{for(var i=0,len=arguments.length;i<len;i++){sources.push(arguments[i])}}return new AnonymousObservable(function(observer){var pos=0,subscription=new SerialDisposable,cancelable=immediateScheduler.scheduleRecursive(function(self){var current,d;if(pos<sources.length){current=sources[pos++];isPromise(current)&&(current=observableFromPromise(current));d=new SingleAssignmentDisposable;subscription.setDisposable(d);d.setDisposable(current.subscribe(observer.onNext.bind(observer),self,self))}else{observer.onCompleted()}});return new CompositeDisposable(subscription,cancelable)})};observableProto.skipUntil=function(other){var source=this;return new AnonymousObservable(function(o){var isOpen=false;var disposables=new CompositeDisposable(source.subscribe(function(left){isOpen&&o.onNext(left)},function(e){o.onError(e)},function(){isOpen&&o.onCompleted()}));isPromise(other)&&(other=observableFromPromise(other));var rightSubscription=new SingleAssignmentDisposable;disposables.add(rightSubscription);rightSubscription.setDisposable(other.subscribe(function(){isOpen=true;rightSubscription.dispose()},function(e){o.onError(e)},function(){rightSubscription.dispose()}));return disposables},source)};var SwitchObservable=function(__super__){inherits(SwitchObservable,__super__);function SwitchObservable(source){this.source=source;__super__.call(this)}SwitchObservable.prototype.subscribeCore=function(o){var inner=new SerialDisposable,s=this.source.subscribe(new SwitchObserver(o,inner));return new CompositeDisposable(s,inner)};function SwitchObserver(o,inner){this.o=o;this.inner=inner;this.stopped=false;this.latest=0;this.hasLatest=false;this.isStopped=false}SwitchObserver.prototype.onNext=function(innerSource){if(this.isStopped){return}var d=new SingleAssignmentDisposable,id=++this.latest;this.hasLatest=true;this.inner.setDisposable(d);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));d.setDisposable(innerSource.subscribe(new InnerObserver(this,id)))};SwitchObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};SwitchObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.stopped=true;!this.hasLatest&&this.o.onCompleted()}};SwitchObserver.prototype.dispose=function(){this.isStopped=true};SwitchObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};function InnerObserver(parent,id){this.parent=parent;this.id=id;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}this.parent.latest===this.id&&this.parent.o.onNext(x)};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.parent.latest===this.id&&this.parent.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;if(this.parent.latest===this.id){this.parent.hasLatest=false;this.parent.isStopped&&this.parent.o.onCompleted()}}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.parent.o.onError(e);return true}return false};return SwitchObservable}(ObservableBase);observableProto["switch"]=observableProto.switchLatest=function(){return new SwitchObservable(this)};var TakeUntilObservable=function(__super__){inherits(TakeUntilObservable,__super__);function TakeUntilObservable(source,other){this.source=source;this.other=isPromise(other)?observableFromPromise(other):other;__super__.call(this)}TakeUntilObservable.prototype.subscribeCore=function(o){return new CompositeDisposable(this.source.subscribe(o),this.other.subscribe(new InnerObserver(o)))};function InnerObserver(o){this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}this.o.onCompleted()};InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){!this.isStopped&&(this.isStopped=true)};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return TakeUntilObservable}(ObservableBase);observableProto.takeUntil=function(other){return new TakeUntilObservable(this,other)};function falseFactory(){return false}observableProto.withLatestFrom=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=args.pop(),source=this;Array.isArray(args[0])&&(args=args[0]);return new AnonymousObservable(function(observer){var n=args.length,hasValue=arrayInitialize(n,falseFactory),hasValueAll=false,values=new Array(n);var subscriptions=new Array(n+1);for(var idx=0;idx<n;idx++){(function(i){var other=args[i],sad=new SingleAssignmentDisposable;isPromise(other)&&(other=observableFromPromise(other));sad.setDisposable(other.subscribe(function(x){values[i]=x;hasValue[i]=true;hasValueAll=hasValue.every(identity)},function(e){observer.onError(e)},noop));subscriptions[i]=sad})(idx)}var sad=new SingleAssignmentDisposable;sad.setDisposable(source.subscribe(function(x){var allValues=[x].concat(values);if(!hasValueAll){return}var res=tryCatch(resultSelector).apply(null,allValues);if(res===errorObj){return observer.onError(res.e)}observer.onNext(res)},function(e){observer.onError(e)},function(){observer.onCompleted()}));subscriptions[n]=sad;return new CompositeDisposable(subscriptions)},this)};function zipArray(second,resultSelector){var first=this;return new AnonymousObservable(function(o){var index=0,len=second.length;return first.subscribe(function(left){if(index<len){var right=second[index++],res=tryCatch(resultSelector)(left,right);if(res===errorObj){return o.onError(res.e)}o.onNext(res)}else{o.onCompleted()}},function(e){o.onError(e)},function(){o.onCompleted()})},first)}function falseFactory(){return false}function emptyArrayFactory(){return[]}observableProto.zip=function(){if(Array.isArray(arguments[0])){return zipArray.apply(this,arguments)}var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var parent=this,resultSelector=args.pop();args.unshift(parent);return new AnonymousObservable(function(o){var n=args.length,queues=arrayInitialize(n,emptyArrayFactory),isDone=arrayInitialize(n,falseFactory);var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){var source=args[i],sad=new SingleAssignmentDisposable;isPromise(source)&&(source=observableFromPromise(source));sad.setDisposable(source.subscribe(function(x){queues[i].push(x);if(queues.every(function(x){return x.length>0})){var queuedValues=queues.map(function(x){return x.shift()}),res=tryCatch(resultSelector).apply(parent,queuedValues);if(res===errorObj){return o.onError(res.e)}o.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(identity)){o.onCompleted()}},function(e){o.onError(e)},function(){isDone[i]=true;isDone.every(identity)&&o.onCompleted()}));subscriptions[i]=sad})(idx)}return new CompositeDisposable(subscriptions)},parent)};Observable.zip=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var first=args.shift();return first.zip.apply(first,args)};function falseFactory(){return false}function arrayFactory(){return[]}Observable.zipArray=function(){var sources;if(Array.isArray(arguments[0])){sources=arguments[0]}else{var len=arguments.length;sources=new Array(len);for(var i=0;i<len;i++){sources[i]=arguments[i]}}return new AnonymousObservable(function(o){var n=sources.length,queues=arrayInitialize(n,arrayFactory),isDone=arrayInitialize(n,falseFactory);var subscriptions=new Array(n);for(var idx=0;idx<n;idx++){(function(i){subscriptions[i]=new SingleAssignmentDisposable;subscriptions[i].setDisposable(sources[i].subscribe(function(x){queues[i].push(x);if(queues.every(function(x){return x.length>0})){var res=queues.map(function(x){return x.shift()});o.onNext(res)}else if(isDone.filter(function(x,j){return j!==i}).every(identity)){return o.onCompleted()}},function(e){o.onError(e)},function(){
isDone[i]=true;isDone.every(identity)&&o.onCompleted()}))})(idx)}return new CompositeDisposable(subscriptions)})};observableProto.asObservable=function(){var source=this;return new AnonymousObservable(function(o){return source.subscribe(o)},source)};observableProto.bufferWithCount=function(count,skip){if(typeof skip!=="number"){skip=count}return this.windowWithCount(count,skip).selectMany(function(x){return x.toArray()}).where(function(x){return x.length>0})};observableProto.dematerialize=function(){var source=this;return new AnonymousObservable(function(o){return source.subscribe(function(x){return x.accept(o)},function(e){o.onError(e)},function(){o.onCompleted()})},this)};observableProto.distinctUntilChanged=function(keySelector,comparer){var source=this;comparer||(comparer=defaultComparer);return new AnonymousObservable(function(o){var hasCurrentKey=false,currentKey;return source.subscribe(function(value){var key=value;if(keySelector){key=tryCatch(keySelector)(value);if(key===errorObj){return o.onError(key.e)}}if(hasCurrentKey){var comparerEquals=tryCatch(comparer)(currentKey,key);if(comparerEquals===errorObj){return o.onError(comparerEquals.e)}}if(!hasCurrentKey||!comparerEquals){hasCurrentKey=true;currentKey=key;o.onNext(value)}},function(e){o.onError(e)},function(){o.onCompleted()})},this)};var TapObservable=function(__super__){inherits(TapObservable,__super__);function TapObservable(source,observerOrOnNext,onError,onCompleted){this.source=source;this.t=!observerOrOnNext||isFunction(observerOrOnNext)?observerCreate(observerOrOnNext||noop,onError||noop,onCompleted||noop):observerOrOnNext;__super__.call(this)}TapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.t))};function InnerObserver(o,t){this.o=o;this.t=t;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}var res=tryCatch(this.t.onNext).call(this.t,x);if(res===errorObj){this.o.onError(res.e)}this.o.onNext(x)};InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;var res=tryCatch(this.t.onError).call(this.t,err);if(res===errorObj){return this.o.onError(res.e)}this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;var res=tryCatch(this.t.onCompleted).call(this.t);if(res===errorObj){return this.o.onError(res.e)}this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return TapObservable}(ObservableBase);observableProto["do"]=observableProto.tap=observableProto.doAction=function(observerOrOnNext,onError,onCompleted){return new TapObservable(this,observerOrOnNext,onError,onCompleted)};observableProto.doOnNext=observableProto.tapOnNext=function(onNext,thisArg){return this.tap(typeof thisArg!=="undefined"?function(x){onNext.call(thisArg,x)}:onNext)};observableProto.doOnError=observableProto.tapOnError=function(onError,thisArg){return this.tap(noop,typeof thisArg!=="undefined"?function(e){onError.call(thisArg,e)}:onError)};observableProto.doOnCompleted=observableProto.tapOnCompleted=function(onCompleted,thisArg){return this.tap(noop,null,typeof thisArg!=="undefined"?function(){onCompleted.call(thisArg)}:onCompleted)};observableProto["finally"]=observableProto.ensure=function(action){var source=this;return new AnonymousObservable(function(observer){var subscription;try{subscription=source.subscribe(observer)}catch(e){action();throw e}return disposableCreate(function(){try{subscription.dispose()}catch(e){throw e}finally{action()}})},this)};observableProto.finallyAction=function(action){return this.ensure(action)};var IgnoreElementsObservable=function(__super__){inherits(IgnoreElementsObservable,__super__);function IgnoreElementsObservable(source){this.source=source;__super__.call(this)}IgnoreElementsObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))};function InnerObserver(o){this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=noop;InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e);return true}return false};return IgnoreElementsObservable}(ObservableBase);observableProto.ignoreElements=function(){return new IgnoreElementsObservable(this)};observableProto.materialize=function(){var source=this;return new AnonymousObservable(function(observer){return source.subscribe(function(value){observer.onNext(notificationCreateOnNext(value))},function(e){observer.onNext(notificationCreateOnError(e));observer.onCompleted()},function(){observer.onNext(notificationCreateOnCompleted());observer.onCompleted()})},source)};observableProto.repeat=function(repeatCount){return enumerableRepeat(this,repeatCount).concat()};observableProto.retry=function(retryCount){return enumerableRepeat(this,retryCount).catchError()};observableProto.retryWhen=function(notifier){return enumerableRepeat(this).catchErrorWhen(notifier)};var ScanObservable=function(__super__){inherits(ScanObservable,__super__);function ScanObservable(source,accumulator,hasSeed,seed){this.source=source;this.accumulator=accumulator;this.hasSeed=hasSeed;this.seed=seed;__super__.call(this)}ScanObservable.prototype.subscribeCore=function(observer){return this.source.subscribe(new ScanObserver(observer,this))};return ScanObservable}(ObservableBase);function ScanObserver(observer,parent){this.observer=observer;this.accumulator=parent.accumulator;this.hasSeed=parent.hasSeed;this.seed=parent.seed;this.hasAccumulation=false;this.accumulation=null;this.hasValue=false;this.isStopped=false}ScanObserver.prototype.onNext=function(x){if(this.isStopped){return}!this.hasValue&&(this.hasValue=true);try{if(this.hasAccumulation){this.accumulation=this.accumulator(this.accumulation,x)}else{this.accumulation=this.hasSeed?this.accumulator(this.seed,x):x;this.hasAccumulation=true}}catch(e){return this.observer.onError(e)}this.observer.onNext(this.accumulation)};ScanObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e)}};ScanObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;!this.hasValue&&this.hasSeed&&this.observer.onNext(this.seed);this.observer.onCompleted()}};ScanObserver.prototype.dispose=function(){this.isStopped=true};ScanObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e);return true}return false};observableProto.scan=function(){var hasSeed=false,seed,accumulator,source=this;if(arguments.length===2){hasSeed=true;seed=arguments[0];accumulator=arguments[1]}else{accumulator=arguments[0]}return new ScanObservable(this,accumulator,hasSeed,seed)};observableProto.skipLast=function(count){if(count<0){throw new ArgumentOutOfRangeError}var source=this;return new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){q.push(x);q.length>count&&o.onNext(q.shift())},function(e){o.onError(e)},function(){o.onCompleted()})},source)};observableProto.startWith=function(){var values,scheduler,start=0;if(!!arguments.length&&isScheduler(arguments[0])){scheduler=arguments[0];start=1}else{scheduler=immediateScheduler}for(var args=[],i=start,len=arguments.length;i<len;i++){args.push(arguments[i])}return enumerableOf([observableFromArray(args,scheduler),this]).concat()};observableProto.takeLast=function(count){if(count<0){throw new ArgumentOutOfRangeError}var source=this;return new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){q.push(x);q.length>count&&q.shift()},function(e){o.onError(e)},function(){while(q.length>0){o.onNext(q.shift())}o.onCompleted()})},source)};observableProto.takeLastBuffer=function(count){var source=this;return new AnonymousObservable(function(o){var q=[];return source.subscribe(function(x){q.push(x);q.length>count&&q.shift()},function(e){o.onError(e)},function(){o.onNext(q);o.onCompleted()})},source)};observableProto.windowWithCount=function(count,skip){var source=this;+count||(count=0);Math.abs(count)===Infinity&&(count=0);if(count<=0){throw new ArgumentOutOfRangeError}skip==null&&(skip=count);+skip||(skip=0);Math.abs(skip)===Infinity&&(skip=0);if(skip<=0){throw new ArgumentOutOfRangeError}return new AnonymousObservable(function(observer){var m=new SingleAssignmentDisposable,refCountDisposable=new RefCountDisposable(m),n=0,q=[];function createWindow(){var s=new Subject;q.push(s);observer.onNext(addRef(s,refCountDisposable))}createWindow();m.setDisposable(source.subscribe(function(x){for(var i=0,len=q.length;i<len;i++){q[i].onNext(x)}var c=n-count+1;c>=0&&c%skip===0&&q.shift().onCompleted();++n%skip===0&&createWindow()},function(e){while(q.length>0){q.shift().onError(e)}observer.onError(e)},function(){while(q.length>0){q.shift().onCompleted()}observer.onCompleted()}));return refCountDisposable},source)};function concatMap(source,selector,thisArg){var selectorFunc=bindCallback(selector,thisArg,3);return source.map(function(x,i){var result=selectorFunc(x,i,source);isPromise(result)&&(result=observableFromPromise(result));(isArrayLike(result)||isIterable(result))&&(result=observableFrom(result));return result}).concatAll()}observableProto.selectConcat=observableProto.concatMap=function(selector,resultSelector,thisArg){if(isFunction(selector)&&isFunction(resultSelector)){return this.concatMap(function(x,i){var selectorResult=selector(x,i);isPromise(selectorResult)&&(selectorResult=observableFromPromise(selectorResult));(isArrayLike(selectorResult)||isIterable(selectorResult))&&(selectorResult=observableFrom(selectorResult));return selectorResult.map(function(y,i2){return resultSelector(x,y,i,i2)})})}return isFunction(selector)?concatMap(this,selector,thisArg):concatMap(this,function(){return selector})};observableProto.concatMapObserver=observableProto.selectConcatObserver=function(onNext,onError,onCompleted,thisArg){var source=this,onNextFunc=bindCallback(onNext,thisArg,2),onErrorFunc=bindCallback(onError,thisArg,1),onCompletedFunc=bindCallback(onCompleted,thisArg,0);return new AnonymousObservable(function(observer){var index=0;return source.subscribe(function(x){var result;try{result=onNextFunc(x,index++)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result)},function(err){var result;try{result=onErrorFunc(err)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()},function(){var result;try{result=onCompletedFunc()}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()})},this).concatAll()};observableProto.defaultIfEmpty=function(defaultValue){var source=this;defaultValue===undefined&&(defaultValue=null);return new AnonymousObservable(function(observer){var found=false;return source.subscribe(function(x){found=true;observer.onNext(x)},function(e){observer.onError(e)},function(){!found&&observer.onNext(defaultValue);observer.onCompleted()})},source)};function arrayIndexOfComparer(array,item,comparer){for(var i=0,len=array.length;i<len;i++){if(comparer(array[i],item)){return i}}return-1}function HashSet(comparer){this.comparer=comparer;this.set=[]}HashSet.prototype.push=function(value){var retValue=arrayIndexOfComparer(this.set,value,this.comparer)===-1;retValue&&this.set.push(value);return retValue};observableProto.distinct=function(keySelector,comparer){var source=this;comparer||(comparer=defaultComparer);return new AnonymousObservable(function(o){var hashSet=new HashSet(comparer);return source.subscribe(function(x){var key=x;if(keySelector){try{key=keySelector(x)}catch(e){o.onError(e);return}}hashSet.push(key)&&o.onNext(x)},function(e){o.onError(e)},function(){o.onCompleted()})},this)};var MapObservable=function(__super__){inherits(MapObservable,__super__);function MapObservable(source,selector,thisArg){this.source=source;this.selector=bindCallback(selector,thisArg,3);__super__.call(this)}function innerMap(selector,self){return function(x,i,o){return selector.call(this,self.selector(x,i,o),i,o)}}MapObservable.prototype.internalMap=function(selector,thisArg){return new MapObservable(this.source,innerMap(selector,this),thisArg)};MapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.selector,this))};function InnerObserver(o,selector,source){this.o=o;this.selector=selector;this.source=source;this.i=0;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}var result=tryCatch(this.selector)(x,this.i++,this.source);if(result===errorObj){return this.o.onError(result.e)}this.o.onNext(result)};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return MapObservable}(ObservableBase);observableProto.map=observableProto.select=function(selector,thisArg){var selectorFn=typeof selector==="function"?selector:function(){return selector};return this instanceof MapObservable?this.internalMap(selectorFn,thisArg):new MapObservable(this,selectorFn,thisArg)};observableProto.pluck=function(){var args=arguments,len=arguments.length;if(len===0){throw new Error("List of properties cannot be empty.")}return this.map(function(x){var currentProp=x;for(var i=0;i<len;i++){var p=currentProp[args[i]];if(typeof p!=="undefined"){currentProp=p}else{return undefined}}return currentProp})};observableProto.flatMapObserver=observableProto.selectManyObserver=function(onNext,onError,onCompleted,thisArg){var source=this;return new AnonymousObservable(function(observer){var index=0;return source.subscribe(function(x){var result;try{result=onNext.call(thisArg,x,index++)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result)},function(err){var result;try{result=onError.call(thisArg,err)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()},function(){var result;try{result=onCompleted.call(thisArg)}catch(e){observer.onError(e);return}isPromise(result)&&(result=observableFromPromise(result));observer.onNext(result);observer.onCompleted()})},source).mergeAll()};function flatMap(source,selector,thisArg){var selectorFunc=bindCallback(selector,thisArg,3);return source.map(function(x,i){var result=selectorFunc(x,i,source);isPromise(result)&&(result=observableFromPromise(result));(isArrayLike(result)||isIterable(result))&&(result=observableFrom(result));return result}).mergeAll()}observableProto.selectMany=observableProto.flatMap=function(selector,resultSelector,thisArg){if(isFunction(selector)&&isFunction(resultSelector)){return this.flatMap(function(x,i){var selectorResult=selector(x,i);isPromise(selectorResult)&&(selectorResult=observableFromPromise(selectorResult));(isArrayLike(selectorResult)||isIterable(selectorResult))&&(selectorResult=observableFrom(selectorResult));return selectorResult.map(function(y,i2){return resultSelector(x,y,i,i2)})},thisArg)}return isFunction(selector)?flatMap(this,selector,thisArg):flatMap(this,function(){return selector})};observableProto.selectSwitch=observableProto.flatMapLatest=observableProto.switchMap=function(selector,thisArg){return this.select(selector,thisArg).switchLatest()};var SkipObservable=function(__super__){inherits(SkipObservable,__super__);function SkipObservable(source,count){this.source=source;this.skipCount=count;__super__.call(this)}SkipObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.skipCount))};function InnerObserver(o,c){this.c=c;this.r=c;this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}if(this.r<=0){this.o.onNext(x)}else{this.r--}};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return SkipObservable}(ObservableBase);observableProto.skip=function(count){if(count<0){throw new ArgumentOutOfRangeError}return new SkipObservable(this,count)};observableProto.skipWhile=function(predicate,thisArg){var source=this,callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){var i=0,running=false;return source.subscribe(function(x){if(!running){try{running=!callback(x,i++,source)}catch(e){o.onError(e);return}}running&&o.onNext(x)},function(e){o.onError(e)},function(){o.onCompleted()})},source)};observableProto.take=function(count,scheduler){if(count<0){throw new ArgumentOutOfRangeError}if(count===0){return observableEmpty(scheduler)}var source=this;return new AnonymousObservable(function(o){var remaining=count;return source.subscribe(function(x){if(remaining-- >0){o.onNext(x);remaining<=0&&o.onCompleted()}},function(e){o.onError(e)},function(){o.onCompleted()})},source)};observableProto.takeWhile=function(predicate,thisArg){var source=this,callback=bindCallback(predicate,thisArg,3);return new AnonymousObservable(function(o){var i=0,running=true;return source.subscribe(function(x){if(running){try{running=callback(x,i++,source)}catch(e){o.onError(e);return}if(running){o.onNext(x)}else{o.onCompleted()}}},function(e){o.onError(e)},function(){o.onCompleted()})},source)};var FilterObservable=function(__super__){inherits(FilterObservable,__super__);function FilterObservable(source,predicate,thisArg){this.source=source;this.predicate=bindCallback(predicate,thisArg,3);__super__.call(this)}FilterObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.predicate,this))};function innerPredicate(predicate,self){return function(x,i,o){return self.predicate(x,i,o)&&predicate.call(this,x,i,o)}}FilterObservable.prototype.internalFilter=function(predicate,thisArg){return new FilterObservable(this.source,innerPredicate(predicate,this),thisArg)};function InnerObserver(o,predicate,source){this.o=o;this.predicate=predicate;this.source=source;this.i=0;this.isStopped=false}InnerObserver.prototype.onNext=function(x){if(this.isStopped){return}var shouldYield=tryCatch(this.predicate)(x,this.i++,this.source);if(shouldYield===errorObj){return this.o.onError(shouldYield.e)}shouldYield&&this.o.onNext(x)};InnerObserver.prototype.onError=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.o.onError(e);return true}return false};return FilterObservable}(ObservableBase);observableProto.filter=observableProto.where=function(predicate,thisArg){return this instanceof FilterObservable?this.internalFilter(predicate,thisArg):new FilterObservable(this,predicate,thisArg)};observableProto.transduce=function(transducer){var source=this;function transformForObserver(o){return{"@@transducer/init":function(){return o},"@@transducer/step":function(obs,input){return obs.onNext(input)},"@@transducer/result":function(obs){return obs.onCompleted()}}}return new AnonymousObservable(function(o){var xform=transducer(transformForObserver(o));return source.subscribe(function(v){try{xform["@@transducer/step"](o,v)}catch(e){o.onError(e)}},function(e){o.onError(e)},function(){xform["@@transducer/result"](o)})},source)};var AnonymousObservable=Rx.AnonymousObservable=function(__super__){inherits(AnonymousObservable,__super__);function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],subscribe=state[1];var sub=tryCatch(subscribe)(ado);if(sub===errorObj){if(!ado.fail(errorObj.e)){return thrower(errorObj.e)}}ado.setDisposable(fixSubscriber(sub))}function AnonymousObservable(subscribe,parent){this.source=parent;function s(observer){var ado=new AutoDetachObserver(observer),state=[ado,subscribe];if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.scheduleWithState(state,setDisposable)}else{setDisposable(null,state)}return ado}__super__.call(this,s)}return AnonymousObservable}(Observable);var AutoDetachObserver=function(__super__){inherits(AutoDetachObserver,__super__);function AutoDetachObserver(observer){__super__.call(this);this.observer=observer;this.m=new SingleAssignmentDisposable}var AutoDetachObserverPrototype=AutoDetachObserver.prototype;AutoDetachObserverPrototype.next=function(value){var result=tryCatch(this.observer.onNext).call(this.observer,value);if(result===errorObj){this.dispose();thrower(result.e)}};AutoDetachObserverPrototype.error=function(err){var result=tryCatch(this.observer.onError).call(this.observer,err);this.dispose();result===errorObj&&thrower(result.e)};AutoDetachObserverPrototype.completed=function(){var result=tryCatch(this.observer.onCompleted).call(this.observer);this.dispose();result===errorObj&&thrower(result.e)};AutoDetachObserverPrototype.setDisposable=function(value){this.m.setDisposable(value)};AutoDetachObserverPrototype.getDisposable=function(){return this.m.getDisposable()};AutoDetachObserverPrototype.dispose=function(){__super__.prototype.dispose.call(this);this.m.dispose()};return AutoDetachObserver}(AbstractObserver);var InnerSubscription=function(subject,observer){this.subject=subject;this.observer=observer};InnerSubscription.prototype.dispose=function(){if(!this.subject.isDisposed&&this.observer!==null){var idx=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(idx,1);this.observer=null}};var Subject=Rx.Subject=function(__super__){function subscribe(observer){checkDisposed(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer)}if(this.hasError){observer.onError(this.error);return disposableEmpty}observer.onCompleted();return disposableEmpty}inherits(Subject,__super__);function Subject(){__super__.call(this,subscribe);this.isDisposed=false,this.isStopped=false,this.observers=[];this.hasError=false}addProperties(Subject.prototype,Observer.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){checkDisposed(this);if(!this.isStopped){this.isStopped=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onCompleted()}this.observers.length=0}},onError:function(error){checkDisposed(this);if(!this.isStopped){this.isStopped=true;this.error=error;this.hasError=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0}},onNext:function(value){checkDisposed(this);if(!this.isStopped){for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onNext(value)}}},dispose:function(){this.isDisposed=true;this.observers=null}});Subject.create=function(observer,observable){return new AnonymousSubject(observer,observable)};return Subject}(Observable);var AsyncSubject=Rx.AsyncSubject=function(__super__){function subscribe(observer){checkDisposed(this);if(!this.isStopped){this.observers.push(observer);return new InnerSubscription(this,observer)}if(this.hasError){observer.onError(this.error)}else if(this.hasValue){observer.onNext(this.value);observer.onCompleted()}else{observer.onCompleted()}return disposableEmpty}inherits(AsyncSubject,__super__);function AsyncSubject(){__super__.call(this,subscribe);this.isDisposed=false;this.isStopped=false;this.hasValue=false;this.observers=[];this.hasError=false}addProperties(AsyncSubject.prototype,Observer,{hasObservers:function(){checkDisposed(this);return this.observers.length>0},onCompleted:function(){var i,len;checkDisposed(this);if(!this.isStopped){this.isStopped=true;var os=cloneArray(this.observers),len=os.length;if(this.hasValue){for(i=0;i<len;i++){var o=os[i];o.onNext(this.value);o.onCompleted()}}else{for(i=0;i<len;i++){os[i].onCompleted()}}this.observers.length=0}},onError:function(error){checkDisposed(this);if(!this.isStopped){this.isStopped=true;this.hasError=true;this.error=error;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0}},onNext:function(value){checkDisposed(this);if(this.isStopped){return}this.value=value;this.hasValue=true},dispose:function(){this.isDisposed=true;this.observers=null;this.exception=null;this.value=null}});return AsyncSubject}(Observable);var AnonymousSubject=Rx.AnonymousSubject=function(__super__){inherits(AnonymousSubject,__super__);function subscribe(observer){return this.observable.subscribe(observer)}function AnonymousSubject(observer,observable){this.observer=observer;this.observable=observable;__super__.call(this,subscribe)}addProperties(AnonymousSubject.prototype,Observer.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(error){this.observer.onError(error)},onNext:function(value){this.observer.onNext(value)}});return AnonymousSubject}(Observable);if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root.Rx=Rx;define(function(){return Rx})}else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=Rx).Rx=Rx}else{freeExports.Rx=Rx}}else{root.Rx=Rx}var rEndingLine=captureLine()}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:152}]},{},[2])(2)});
